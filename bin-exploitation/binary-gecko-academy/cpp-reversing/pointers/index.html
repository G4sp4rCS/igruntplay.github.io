
<!doctype html>
<html lang="es" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Grunt's Blog">
      
      
      
        <link rel="canonical" href="https://igruntplay.github.io/bin-exploitation/binary-gecko-academy/cpp-reversing/pointers/">
      
      
      
      
        
      
      
      <link rel="icon" href="../../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.1">
    
    
      
        <title>Punteros en C++: Guía Completa de Reversing - Grunt's Personal Wiki</title>
      
    
    
      <link rel="stylesheet" href="../../../../assets/stylesheets/main.484c7ddc.min.css">
      
        
        <link rel="stylesheet" href="../../../../assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Inter:300,300i,400,400i,700,700i%7CFira+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Inter";--md-code-font:"Fira Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="slate" data-md-color-primary="lime" data-md-color-accent="teal">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#punteros-en-c-guia-completa-de-reversing" class="md-skip">
          Saltar a contenido
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Cabecera">
    <a href="../../../.." title="Grunt&#39;s Personal Wiki" class="md-header__button md-logo" aria-label="Grunt's Personal Wiki" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Grunt's Personal Wiki
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Punteros en C++: Guía Completa de Reversing
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="lime" data-md-color-accent="teal"  aria-label="Cambiar a modo claro"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Cambiar a modo claro" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5s-1.65.15-2.39.42zM3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29zm.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14zM20.65 7l-1.77 3.79a7.02 7.02 0 0 0-2.38-4.15zm-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29zM12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="teal" data-md-color-accent="lime"  aria-label="Cambiar a modo oscuro"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Cambiar a modo oscuro" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3zm3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95zm-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Búsqueda" placeholder="Búsqueda" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Buscar">
        
        <button type="reset" class="md-search__icon md-icon" title="Limpiar" aria-label="Limpiar" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Inicializando búsqueda
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/G4sp4rCS/igruntplay.github.io" title="Ir al repositorio" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    G4sp4rCS/igruntplay.github.io
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



  

<nav class="md-nav md-nav--primary md-nav--integrated" aria-label="Navegación" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../../.." title="Grunt&#39;s Personal Wiki" class="md-nav__button md-logo" aria-label="Grunt's Personal Wiki" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Grunt's Personal Wiki
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/G4sp4rCS/igruntplay.github.io" title="Ir al repositorio" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    G4sp4rCS/igruntplay.github.io
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Inicio
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    Ofensiva
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Ofensiva
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../bin-exploitation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Fundamentos de explotación
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../OSCP/OSCP/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    OSCP Preparation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../WindowsHacking/windowsHackingIndex/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Windows Hacking
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../privilege-escalation-linux-assistance/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    PrivEsc Cheatsheet
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../HavocC2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Havoc C2 101
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../scripts/scripts/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Scripts & Exploits
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../dnsSpoofing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    DNS Spoofing
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../subdomain-enumeration/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Subdomain Enumeration
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    Cloud & AppSec
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Cloud & AppSec
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../CloudHacking/cloudHacking/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Cloud Hacking
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../CloudHacking/AWS-enumeration/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    AWS Enumeration
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../CloudHacking/AWS-Attacking/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    AWS Attacking
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../AppSecKPI/AppSecKPI/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    AppSec KPI & Metrics
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../bug-bounty-resources/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Bug Bounty Resources
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../corsPOC/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    CORS PoC
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    Certificaciones
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    Certificaciones
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../BSCP/BSCP/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    BSCP Preparation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../BSCP/practicioner-labs-notes/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    BSCP Practitioner Labs
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../BSCP/OAuth-account-hijacking-via-redirect_uri/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    OAuth Hijacking Notes
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../ejpt/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    eJPT Notes
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    Programación & AI
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    Programación & AI
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../Rust/rust/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Rust Programming
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../Rust/closures-rust/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Rust: Closures
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../Rust/smart-pointers-rust/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Rust: Smart Pointers
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../AI/AI/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    AI for Red Teaming
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../AI/fundamentals/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    AI Fundamentals
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../AI/DecisionTrees/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Decision Trees
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../AI/NaiveBayes/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Naive Bayes
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../university/university/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Apuntes universitarios
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    Miscelánea
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            
  
    Miscelánea
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../android-pentesting/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Android Pentesting Setup
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../BurpSuite-regex/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    BurpSuite Regex Cheatsheet
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../jobs/jobs/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Jobs Interview Tips
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../gaming/gaming/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Gaming Settings
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../xss/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    XSS Payloads
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  


  
    <a href="https://github.com/G4sp4rCS/igruntplay.github.io/edit/master/docs/bin-exploitation/binary-gecko-academy/cpp-reversing/pointers.md" title="Editar esta página" class="md-content__button md-icon" rel="edit">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M10 20H6V4h7v5h5v3.1l2-2V8l-6-6H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h4zm10.2-7c.1 0 .3.1.4.2l1.3 1.3c.2.2.2.6 0 .8l-1 1-2.1-2.1 1-1c.1-.1.2-.2.4-.2m0 3.9L14.1 23H12v-2.1l6.1-6.1z"/></svg>
    </a>
  
  


<h1 id="punteros-en-c-guia-completa-de-reversing">Punteros en C++: Guía Completa de Reversing<a class="headerlink" href="#punteros-en-c-guia-completa-de-reversing" title="Permanent link">&para;</a></h1>
<h2 id="indice">Índice<a class="headerlink" href="#indice" title="Permanent link">&para;</a></h2>
<ul>
<li><a href="#introducción">Introducción</a></li>
<li><a href="#parte-1-concepto-fundamental-de-punteros">Parte 1: Concepto Fundamental de Punteros</a></li>
<li><a href="#parte-2-declaración-y-tipado-de-punteros">Parte 2: Declaración y Tipado de Punteros</a></li>
<li><a href="#parte-3-punteros-en-ensamblador-x64-windows">Parte 3: Punteros en Ensamblador (x64 Windows)</a></li>
<li><a href="#parte-4-ejemplo-del-curso---análisis-detallado">Parte 4: Ejemplo del Curso - Análisis Detallado</a></li>
<li><a href="#parte-5-punteros-a-estructuras">Parte 5: Punteros a Estructuras</a></li>
<li><a href="#parte-6-punteros-y-funciones">Parte 6: Punteros y Funciones</a></li>
<li><a href="#parte-7-aritmética-de-punteros">Parte 7: Aritmética de Punteros</a></li>
<li><a href="#parte-75-punteros-genéricos-void">Parte 7.5: Punteros Genéricos (void*)</a></li>
<li><a href="#parte-8-puntero-a-puntero-double-pointer">Parte 8: Puntero a Puntero (double pointer)</a></li>
<li><a href="#parte-9-punteros-y-arrays">Parte 9: Punteros y Arrays</a></li>
<li><a href="#parte-95-array-bidimensional-vs-array-de-punteros">Parte 9.5: Array Bidimensional vs Array de Punteros</a></li>
<li><a href="#parte-10-reconocimiento-de-punteros-en-ida-pro-sin-símbolos">Parte 10: Reconocimiento de Punteros en IDA Pro (Sin Símbolos)</a></li>
<li><a href="#parte-11-importancia-de-punteros-en-reversing">Parte 11: Importancia de Punteros en Reversing</a></li>
<li><a href="#parte-12-stack-frame-con-punteros">Parte 12: Stack Frame con Punteros</a></li>
<li><a href="#parte-13-errores-comunes-con-punteros">Parte 13: Errores Comunes con Punteros</a></li>
<li><a href="#parte-14-comparación-directa-con-ensamblador-del-video">Parte 14: Comparación Directa con Ensamblador del Video</a></li>
<li><a href="#resumen-lo-más-importante">Resumen: Lo Más Importante</a></li>
<li><a href="#parte-15-punteros-en-el-heap">Parte 15: Punteros en el Heap</a></li>
<li><a href="#apéndice-a-smart-pointers-punteros-inteligentes">Apéndice A: Smart Pointers (Punteros Inteligentes)</a></li>
</ul>
<h2 id="introduccion">Introducción<a class="headerlink" href="#introduccion" title="Permanent link">&para;</a></h2>
<p>Los <strong>punteros</strong> son uno de los conceptos más importantes (y temidos) en C++. Sin embargo, son fundamentales para entender:</p>
<ul>
<li>Cómo se pasan estructuras grandes a funciones sin copiarlas completamente</li>
<li>Cómo funcionan los arrays dinámicos</li>
<li>Cómo se manipulan objetos complejos en ensamblador</li>
<li>Cómo se realizan operaciones en memoria</li>
</ul>
<p><strong>Objetivo:</strong> Desmitificar los punteros y aprender a reconocerlos en ensamblador.</p>
<hr />
<h2 id="parte-1-concepto-fundamental-de-punteros">Parte 1: Concepto Fundamental de Punteros<a class="headerlink" href="#parte-1-concepto-fundamental-de-punteros" title="Permanent link">&para;</a></h2>
<h3 id="que-es-un-puntero">¿Qué es un Puntero?<a class="headerlink" href="#que-es-un-puntero" title="Permanent link">&para;</a></h3>
<p>Un <strong>puntero</strong> es una variable que <strong>almacena la dirección de memoria de otra variable</strong>.</p>
<p><strong>Conceptualmente:</strong></p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a>Variable normal:
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>    Nombre: a
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>    Valor: 5
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>    Dirección: 0x1000
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a>Puntero a a:
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a>    Nombre: pa
</span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a>    Valor: 0x1000  (dirección de a)
</span><span id="__span-0-9"><a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a>    Dirección: 0x2000
</span></code></pre></div>
<p><strong>En el código:</strong></p>
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="kt">int</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">5</span><span class="p">;</span><span class="w">           </span><span class="c1">// Variable normal</span>
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a><span class="kt">int</span><span class="o">*</span><span class="w"> </span><span class="n">pa</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="n">a</span><span class="p">;</span><span class="w">        </span><span class="c1">// Puntero a a (almacena dirección de a)</span>
</span></code></pre></div>
<h3 id="diferencia-variable-vs-puntero">Diferencia: Variable vs Puntero<a class="headerlink" href="#diferencia-variable-vs-puntero" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Característica</th>
<th>Variable Normal</th>
<th>Puntero</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Almacena</strong></td>
<td>Valor</td>
<td>Dirección de memoria</td>
</tr>
<tr>
<td><strong>Tamaño</strong></td>
<td>Depende del tipo (4, 8 bytes, etc.)</td>
<td>Siempre 8 bytes en x64</td>
</tr>
<tr>
<td><strong>Declaración</strong></td>
<td><code>int a;</code></td>
<td><code>int* pa;</code></td>
</tr>
<tr>
<td><strong>Inicialización</strong></td>
<td><code>a = 5;</code></td>
<td><code>pa = &amp;a;</code> (operador &amp;)</td>
</tr>
<tr>
<td><strong>Acceso al valor</strong></td>
<td><code>a</code></td>
<td><code>*pa</code> (operador *)</td>
</tr>
</tbody>
</table>
<h3 id="operadores-clave">Operadores Clave<a class="headerlink" href="#operadores-clave" title="Permanent link">&para;</a></h3>
<h4 id="operador-direccion-de-address-of">Operador <code>&amp;</code> (Dirección de - Address-of)<a class="headerlink" href="#operador-direccion-de-address-of" title="Permanent link">&para;</a></h4>
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="kt">int</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">5</span><span class="p">;</span>
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a><span class="kt">int</span><span class="o">*</span><span class="w"> </span><span class="n">pa</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="n">a</span><span class="p">;</span><span class="w">       </span><span class="c1">// pa almacena la dirección de a</span>
</span></code></pre></div>
<p><strong>En ensamblador:</strong></p>
<div class="language-asm highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="nf">lea</span><span class="w"> </span><span class="no">rax</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="no">rsp</span><span class="err">+</span><span class="mi">20</span><span class="p">]</span><span class="w">   </span><span class="c1">; Obtener dirección de a</span>
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a><span class="nf">mov</span><span class="w"> </span><span class="p">[</span><span class="no">rsp</span><span class="err">+</span><span class="mi">28</span><span class="p">],</span><span class="w"> </span><span class="no">rax</span><span class="w">   </span><span class="c1">; Guardar en pa</span>
</span></code></pre></div>
<p><strong>Nota:</strong> <code>lea</code> (Load Effective Address) obtiene la dirección sin desreferenciar.</p>
<h4 id="operador-desreferenciacion-dereference">Operador <code>*</code> (Desreferenciación - Dereference)<a class="headerlink" href="#operador-desreferenciacion-dereference" title="Permanent link">&para;</a></h4>
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="kt">int</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">5</span><span class="p">;</span>
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a><span class="kt">int</span><span class="o">*</span><span class="w"> </span><span class="n">pa</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="n">a</span><span class="p">;</span>
</span><span id="__span-4-3"><a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a><span class="kt">int</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">*</span><span class="n">pa</span><span class="p">;</span><span class="w">        </span><span class="c1">// b = 5 (obtener valor de a a través del puntero)</span>
</span></code></pre></div>
<p><strong>En ensamblador:</strong></p>
<div class="language-asm highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="nf">mov</span><span class="w"> </span><span class="no">rax</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="no">rsp</span><span class="err">+</span><span class="mi">28</span><span class="p">]</span><span class="w">   </span><span class="c1">; RAX = dirección de a (valor de pa)</span>
</span><span id="__span-5-2"><a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a><span class="nf">mov</span><span class="w"> </span><span class="no">ebx</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="no">rax</span><span class="p">]</span><span class="w">      </span><span class="c1">; EBX = valor en esa dirección (5)</span>
</span></code></pre></div>
<p><strong>Nota:</strong> <code>mov ebx, [rax]</code> desreferencia el puntero.</p>
<h4 id="operador-flecha-arrow-para-punteros-a-estructuras">Operador <code>-&gt;</code> (Flecha - Arrow, para punteros a estructuras)<a class="headerlink" href="#operador-flecha-arrow-para-punteros-a-estructuras" title="Permanent link">&para;</a></h4>
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="k">struct</span><span class="w"> </span><span class="nc">Persona</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">edad</span><span class="p">;</span>
</span><span id="__span-6-3"><a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a><span class="p">};</span>
</span><span id="__span-6-4"><a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a>
</span><span id="__span-6-5"><a id="__codelineno-6-5" name="__codelineno-6-5" href="#__codelineno-6-5"></a><span class="n">Persona</span><span class="w"> </span><span class="n">p</span><span class="p">;</span>
</span><span id="__span-6-6"><a id="__codelineno-6-6" name="__codelineno-6-6" href="#__codelineno-6-6"></a><span class="n">Persona</span><span class="o">*</span><span class="w"> </span><span class="n">pp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="n">p</span><span class="p">;</span>
</span><span id="__span-6-7"><a id="__codelineno-6-7" name="__codelineno-6-7" href="#__codelineno-6-7"></a>
</span><span id="__span-6-8"><a id="__codelineno-6-8" name="__codelineno-6-8" href="#__codelineno-6-8"></a><span class="n">p</span><span class="p">.</span><span class="n">edad</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">30</span><span class="p">;</span><span class="w">        </span><span class="c1">// Acceso directo</span>
</span><span id="__span-6-9"><a id="__codelineno-6-9" name="__codelineno-6-9" href="#__codelineno-6-9"></a><span class="n">pp</span><span class="o">-&gt;</span><span class="n">edad</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">30</span><span class="p">;</span><span class="w">      </span><span class="c1">// Acceso a través de puntero (equivalente)</span>
</span></code></pre></div>
<hr />
<h2 id="parte-2-declaracion-y-tipado-de-punteros">Parte 2: Declaración y Tipado de Punteros<a class="headerlink" href="#parte-2-declaracion-y-tipado-de-punteros" title="Permanent link">&para;</a></h2>
<h3 id="sintaxis-de-declaracion">Sintaxis de Declaración<a class="headerlink" href="#sintaxis-de-declaracion" title="Permanent link">&para;</a></h3>
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a><span class="kt">int</span><span class="o">*</span><span class="w"> </span><span class="n">p_int</span><span class="p">;</span><span class="w">         </span><span class="c1">// Puntero a int</span>
</span><span id="__span-7-2"><a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">p_char</span><span class="p">;</span><span class="w">       </span><span class="c1">// Puntero a char</span>
</span><span id="__span-7-3"><a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a><span class="kt">float</span><span class="o">*</span><span class="w"> </span><span class="n">p_float</span><span class="p">;</span><span class="w">     </span><span class="c1">// Puntero a float</span>
</span><span id="__span-7-4"><a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a><span class="n">Persona</span><span class="o">*</span><span class="w"> </span><span class="n">p_persona</span><span class="p">;</span><span class="w"> </span><span class="c1">// Puntero a estructura Persona</span>
</span></code></pre></div>
<p><strong>Nota:</strong> El <code>*</code> está asociado al tipo, no a la variable:</p>
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a><span class="c1">// Estos son equivalentes:</span>
</span><span id="__span-8-2"><a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a><span class="kt">int</span><span class="o">*</span><span class="w"> </span><span class="n">p1</span><span class="p">;</span>
</span><span id="__span-8-3"><a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a><span class="kt">int</span><span class="w"> </span><span class="o">*</span><span class="n">p1</span><span class="p">;</span>
</span><span id="__span-8-4"><a id="__codelineno-8-4" name="__codelineno-8-4" href="#__codelineno-8-4"></a>
</span><span id="__span-8-5"><a id="__codelineno-8-5" name="__codelineno-8-5" href="#__codelineno-8-5"></a><span class="c1">// Pero estos NO son equivalentes:</span>
</span><span id="__span-8-6"><a id="__codelineno-8-6" name="__codelineno-8-6" href="#__codelineno-8-6"></a><span class="kt">int</span><span class="o">*</span><span class="w"> </span><span class="n">p1</span><span class="p">,</span><span class="w"> </span><span class="n">p2</span><span class="p">;</span><span class="w">        </span><span class="c1">// p1 es puntero, p2 es int (confuso)</span>
</span><span id="__span-8-7"><a id="__codelineno-8-7" name="__codelineno-8-7" href="#__codelineno-8-7"></a><span class="kt">int</span><span class="w"> </span><span class="o">*</span><span class="n">p1</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="n">p2</span><span class="p">;</span><span class="w">       </span><span class="c1">// Ambos son punteros (más claro)</span>
</span></code></pre></div>
<h3 id="tipado-de-punteros">Tipado de Punteros<a class="headerlink" href="#tipado-de-punteros" title="Permanent link">&para;</a></h3>
<p><strong>Un puntero solo puede apuntar a su tipo específico:</strong></p>
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a><span class="kt">int</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">5</span><span class="p">;</span>
</span><span id="__span-9-2"><a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a><span class="kt">char</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="sc">&#39;A&#39;</span><span class="p">;</span>
</span><span id="__span-9-3"><a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a>
</span><span id="__span-9-4"><a id="__codelineno-9-4" name="__codelineno-9-4" href="#__codelineno-9-4"></a><span class="kt">int</span><span class="o">*</span><span class="w"> </span><span class="n">p_int</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="n">a</span><span class="p">;</span><span class="w">     </span><span class="c1">// Correcto</span>
</span><span id="__span-9-5"><a id="__codelineno-9-5" name="__codelineno-9-5" href="#__codelineno-9-5"></a><span class="kt">int</span><span class="o">*</span><span class="w"> </span><span class="n">p_int</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="n">c</span><span class="p">;</span><span class="w">     </span><span class="c1">// Error de compilación</span>
</span><span id="__span-9-6"><a id="__codelineno-9-6" name="__codelineno-9-6" href="#__codelineno-9-6"></a><span class="kt">int</span><span class="o">*</span><span class="w"> </span><span class="n">p_int</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">c</span><span class="p">;</span><span class="w"> </span><span class="c1">// Correcto (con cast)</span>
</span></code></pre></div>
<p><strong>En reversing:</strong> Si ves un puntero que apunta a un tipo incorrecto, probablemente hay:</p>
<ul>
<li>Un cast</li>
<li>Un error del compilador</li>
<li>Código intencional para eludir protecciones</li>
</ul>
<h3 id="puntero-nulo">Puntero Nulo<a class="headerlink" href="#puntero-nulo" title="Permanent link">&para;</a></h3>
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a><span class="kt">int</span><span class="o">*</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">;</span><span class="w">   </span><span class="c1">// Puntero sin dirección asignada</span>
</span><span id="__span-10-2"><a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a><span class="kt">int</span><span class="o">*</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">NULL</span><span class="p">;</span><span class="w">      </span><span class="c1">// Equivalente (C++03)</span>
</span><span id="__span-10-3"><a id="__codelineno-10-3" name="__codelineno-10-3" href="#__codelineno-10-3"></a><span class="kt">int</span><span class="o">*</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w">         </span><span class="c1">// También equivalente</span>
</span></code></pre></div>
<p><strong>En ensamblador:</strong></p>
<div class="language-asm highlight"><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a><span class="nf">mov</span><span class="w"> </span><span class="no">rax</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="w">          </span><span class="c1">; RAX = nullptr</span>
</span><span id="__span-11-2"><a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a><span class="nf">mov</span><span class="w"> </span><span class="p">[</span><span class="no">rsp</span><span class="err">+</span><span class="mi">28</span><span class="p">],</span><span class="w"> </span><span class="no">rax</span><span class="w">   </span><span class="c1">; p = nullptr</span>
</span></code></pre></div>
<p><strong>Acceder a un puntero nulo causa crash:</strong></p>
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-12-1"><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a><span class="kt">int</span><span class="o">*</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">;</span>
</span><span id="__span-12-2"><a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">*</span><span class="n">p</span><span class="p">;</span><span class="w">         </span><span class="c1">// Crash (Segmentation fault)</span>
</span></code></pre></div>
<hr />
<h2 id="parte-3-punteros-en-ensamblador-x64-windows">Parte 3: Punteros en Ensamblador (x64 Windows)<a class="headerlink" href="#parte-3-punteros-en-ensamblador-x64-windows" title="Permanent link">&para;</a></h2>
<h3 id="asignacion-obtener-direccion">Asignación: Obtener Dirección<a class="headerlink" href="#asignacion-obtener-direccion" title="Permanent link">&para;</a></h3>
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-13-1"><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a><span class="kt">int</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">5</span><span class="p">;</span>
</span><span id="__span-13-2"><a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a><span class="kt">int</span><span class="o">*</span><span class="w"> </span><span class="n">pa</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="n">a</span><span class="p">;</span>
</span></code></pre></div>
<p><strong>En ensamblador:</strong></p>
<div class="language-asm highlight"><pre><span></span><code><span id="__span-14-1"><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a><span class="nf">lea</span><span class="w"> </span><span class="no">rax</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="no">rsp</span><span class="err">+</span><span class="mi">20</span><span class="p">]</span><span class="w">   </span><span class="c1">; LEA = Load Effective Address</span>
</span><span id="__span-14-2"><a id="__codelineno-14-2" name="__codelineno-14-2" href="#__codelineno-14-2"></a><span class="w">                    </span><span class="c1">; Obtiene la dirección de a sin desreferenciar</span>
</span><span id="__span-14-3"><a id="__codelineno-14-3" name="__codelineno-14-3" href="#__codelineno-14-3"></a><span class="nf">mov</span><span class="w"> </span><span class="p">[</span><span class="no">rsp</span><span class="err">+</span><span class="mi">28</span><span class="p">],</span><span class="w"> </span><span class="no">rax</span><span class="w">   </span><span class="c1">; pa = dirección de a (8 bytes en x64)</span>
</span></code></pre></div>
<p><strong>Notas clave:</strong></p>
<ul>
<li><code>lea</code> obtiene la dirección (sin acceder a memoria)</li>
<li><code>mov [dirección], valor</code> almacena el valor en esa dirección</li>
</ul>
<h3 id="desreferenciacion-acceder-al-valor">Desreferenciación: Acceder al Valor<a class="headerlink" href="#desreferenciacion-acceder-al-valor" title="Permanent link">&para;</a></h3>
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-15-1"><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a><span class="kt">int</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">5</span><span class="p">;</span>
</span><span id="__span-15-2"><a id="__codelineno-15-2" name="__codelineno-15-2" href="#__codelineno-15-2"></a><span class="kt">int</span><span class="o">*</span><span class="w"> </span><span class="n">pa</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="n">a</span><span class="p">;</span>
</span><span id="__span-15-3"><a id="__codelineno-15-3" name="__codelineno-15-3" href="#__codelineno-15-3"></a><span class="kt">int</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">*</span><span class="n">pa</span><span class="p">;</span><span class="w">        </span><span class="c1">// Leer valor de a a través de pa</span>
</span><span id="__span-15-4"><a id="__codelineno-15-4" name="__codelineno-15-4" href="#__codelineno-15-4"></a><span class="o">*</span><span class="n">pa</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">10</span><span class="p">;</span><span class="w">           </span><span class="c1">// Escribir 10 en a a través de pa</span>
</span></code></pre></div>
<h4 id="aclaracion-critica-pa-vs-pa">ACLARACIÓN CRÍTICA: <code>*pa</code> vs <code>pa</code><a class="headerlink" href="#aclaracion-critica-pa-vs-pa" title="Permanent link">&para;</a></h4>
<p><strong>Esta es la confusión más común. Veamos qué contiene cada cosa:</strong></p>
<p><strong>Memoria (ejemplo):</strong></p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-16-1"><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a>Dirección    Contenido              Variable
</span><span id="__span-16-2"><a id="__codelineno-16-2" name="__codelineno-16-2" href="#__codelineno-16-2"></a>0x1000       5                      ← a (el valor)
</span><span id="__span-16-3"><a id="__codelineno-16-3" name="__codelineno-16-3" href="#__codelineno-16-3"></a>0x2000       0x1000                 ← pa (la DIRECCIÓN de a)
</span><span id="__span-16-4"><a id="__codelineno-16-4" name="__codelineno-16-4" href="#__codelineno-16-4"></a>0x3000       5                      ← b (el valor que asignamos)
</span></code></pre></div>
<p><strong>En el código:</strong></p>
<ul>
<li><code>pa</code> contiene <code>0x1000</code> (la dirección de a)</li>
<li><code>*pa</code> accede a lo que hay EN esa dirección, que es <code>5</code> (el valor de a)</li>
<li><code>b = *pa</code> asigna el <strong>valor</strong> <code>5</code> a b, NO la dirección</li>
</ul>
<p><strong>Comparación:</strong></p>
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-17-1"><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a><span class="kt">int</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pa</span><span class="p">;</span><span class="w">    </span><span class="c1">// INCORRECTO: b sería 0x1000 (tipo incorrecto)</span>
</span><span id="__span-17-2"><a id="__codelineno-17-2" name="__codelineno-17-2" href="#__codelineno-17-2"></a><span class="kt">int</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">*</span><span class="n">pa</span><span class="p">;</span><span class="w">   </span><span class="c1">// CORRECTO: b es 5 (el valor)</span>
</span></code></pre></div>
<p><strong>En ensamblador, verás la diferencia:</strong></p>
<div class="language-asm highlight"><pre><span></span><code><span id="__span-18-1"><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a><span class="c1">; Si fuera int b = pa (INCORRECTO):</span>
</span><span id="__span-18-2"><a id="__codelineno-18-2" name="__codelineno-18-2" href="#__codelineno-18-2"></a><span class="nf">mov</span><span class="w"> </span><span class="no">rax</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="no">rsp</span><span class="err">+</span><span class="mi">28</span><span class="p">]</span><span class="w">           </span><span class="c1">; RAX = 0x1000 (la dirección, valor de pa)</span>
</span><span id="__span-18-3"><a id="__codelineno-18-3" name="__codelineno-18-3" href="#__codelineno-18-3"></a><span class="nf">mov</span><span class="w"> </span><span class="p">[</span><span class="no">rsp</span><span class="err">+</span><span class="mi">24</span><span class="p">],</span><span class="w"> </span><span class="no">rax</span><span class="w">           </span><span class="c1">; b = 0x1000 (la dirección)</span>
</span><span id="__span-18-4"><a id="__codelineno-18-4" name="__codelineno-18-4" href="#__codelineno-18-4"></a><span class="c1">; Problema: estamos asignando dirección a un int</span>
</span><span id="__span-18-5"><a id="__codelineno-18-5" name="__codelineno-18-5" href="#__codelineno-18-5"></a>
</span><span id="__span-18-6"><a id="__codelineno-18-6" name="__codelineno-18-6" href="#__codelineno-18-6"></a><span class="c1">; Correcto: int b = *pa</span>
</span><span id="__span-18-7"><a id="__codelineno-18-7" name="__codelineno-18-7" href="#__codelineno-18-7"></a><span class="nf">mov</span><span class="w"> </span><span class="no">rax</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="no">rsp</span><span class="err">+</span><span class="mi">28</span><span class="p">]</span><span class="w">           </span><span class="c1">; RAX = 0x1000 (la dirección)</span>
</span><span id="__span-18-8"><a id="__codelineno-18-8" name="__codelineno-18-8" href="#__codelineno-18-8"></a><span class="nf">mov</span><span class="w"> </span><span class="no">edx</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="no">rax</span><span class="p">]</span><span class="w">              </span><span class="c1">; EDX = [0x1000] = 5 (DESREFERENCIA)</span>
</span><span id="__span-18-9"><a id="__codelineno-18-9" name="__codelineno-18-9" href="#__codelineno-18-9"></a><span class="nf">mov</span><span class="w"> </span><span class="p">[</span><span class="no">rsp</span><span class="err">+</span><span class="mi">24</span><span class="p">],</span><span class="w"> </span><span class="no">edx</span><span class="w">           </span><span class="c1">; b = 5 (el valor)</span>
</span></code></pre></div>
<p><strong>La clave del segundo <code>mov</code>:</strong></p>
<p>En <code>mov edx, [rax]</code>, los corchetes <code>[]</code> significan "accede a la dirección en RAX". Esto desreferencia el puntero.</p>
<p>Sin los corchetes sería diferente:</p>
<div class="language-asm highlight"><pre><span></span><code><span id="__span-19-1"><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a><span class="nf">mov</span><span class="w"> </span><span class="no">edx</span><span class="p">,</span><span class="w"> </span><span class="no">rax</span><span class="w">                </span><span class="c1">; EDX = 0x1000 (la dirección)</span>
</span><span id="__span-19-2"><a id="__codelineno-19-2" name="__codelineno-19-2" href="#__codelineno-19-2"></a><span class="nf">mov</span><span class="w"> </span><span class="no">edx</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="no">rax</span><span class="p">]</span><span class="w">              </span><span class="c1">; EDX = 5 (el valor en esa dirección)</span>
</span></code></pre></div>
<p><strong>Resumen con símbolos:</strong></p>
<table>
<thead>
<tr>
<th>Operación</th>
<th>Significado</th>
<th>Valor</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>pa</code></td>
<td>El puntero mismo (contiene dirección)</td>
<td><code>0x1000</code></td>
</tr>
<tr>
<td><code>*pa</code></td>
<td>Lo que apunta el puntero</td>
<td><code>5</code></td>
</tr>
<tr>
<td><code>&amp;a</code></td>
<td>La dirección de a</td>
<td><code>0x1000</code></td>
</tr>
</tbody>
</table>
<p><strong>Por eso <code>*pa</code> es equivalente a <code>&amp;a</code> → ambos acceden al mismo lugar</strong></p>
<hr />
<p><strong>Lectura:</strong></p>
<div class="language-asm highlight"><pre><span></span><code><span id="__span-20-1"><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a><span class="nf">mov</span><span class="w"> </span><span class="no">rax</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="no">rsp</span><span class="err">+</span><span class="mi">28</span><span class="p">]</span><span class="w">   </span><span class="c1">; RAX = dirección de a (valor de pa)</span>
</span><span id="__span-20-2"><a id="__codelineno-20-2" name="__codelineno-20-2" href="#__codelineno-20-2"></a><span class="nf">mov</span><span class="w"> </span><span class="no">ebx</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="no">rax</span><span class="p">]</span><span class="w">      </span><span class="c1">; EBX = valor en [RAX] (5)</span>
</span></code></pre></div>
<p><strong>Escritura:</strong></p>
<div class="language-asm highlight"><pre><span></span><code><span id="__span-21-1"><a id="__codelineno-21-1" name="__codelineno-21-1" href="#__codelineno-21-1"></a><span class="nf">mov</span><span class="w"> </span><span class="no">rax</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="no">rsp</span><span class="err">+</span><span class="mi">28</span><span class="p">]</span><span class="w">   </span><span class="c1">; RAX = dirección de a</span>
</span><span id="__span-21-2"><a id="__codelineno-21-2" name="__codelineno-21-2" href="#__codelineno-21-2"></a><span class="nf">mov</span><span class="w"> </span><span class="no">dword</span><span class="w"> </span><span class="no">ptr</span><span class="w"> </span><span class="p">[</span><span class="no">rax</span><span class="p">],</span><span class="w"> </span><span class="mi">10</span><span class="w"> </span><span class="c1">; Escribir 10 en la dirección de a</span>
</span></code></pre></div>
<h3 id="operaciones-comunes">Operaciones Comunes<a class="headerlink" href="#operaciones-comunes" title="Permanent link">&para;</a></h3>
<h4 id="lectura-simple">Lectura Simple<a class="headerlink" href="#lectura-simple" title="Permanent link">&para;</a></h4>
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-22-1"><a id="__codelineno-22-1" name="__codelineno-22-1" href="#__codelineno-22-1"></a><span class="kt">int</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">5</span><span class="p">;</span>
</span><span id="__span-22-2"><a id="__codelineno-22-2" name="__codelineno-22-2" href="#__codelineno-22-2"></a><span class="kt">int</span><span class="o">*</span><span class="w"> </span><span class="n">pa</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="n">a</span><span class="p">;</span>
</span><span id="__span-22-3"><a id="__codelineno-22-3" name="__codelineno-22-3" href="#__codelineno-22-3"></a><span class="kt">int</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">*</span><span class="n">pa</span><span class="p">;</span><span class="w">        </span><span class="c1">// b = 5</span>
</span></code></pre></div>
<div class="language-asm highlight"><pre><span></span><code><span id="__span-23-1"><a id="__codelineno-23-1" name="__codelineno-23-1" href="#__codelineno-23-1"></a><span class="nf">mov</span><span class="w"> </span><span class="no">rax</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="no">rsp</span><span class="err">+</span><span class="mi">28</span><span class="p">]</span><span class="w">       </span><span class="c1">; RAX = pa (dirección de a)</span>
</span><span id="__span-23-2"><a id="__codelineno-23-2" name="__codelineno-23-2" href="#__codelineno-23-2"></a><span class="nf">mov</span><span class="w"> </span><span class="no">ebx</span><span class="p">,</span><span class="w"> </span><span class="no">dword</span><span class="w"> </span><span class="no">ptr</span><span class="w"> </span><span class="p">[</span><span class="no">rax</span><span class="p">]</span><span class="c1">; EBX = *pa (valor 5)</span>
</span><span id="__span-23-3"><a id="__codelineno-23-3" name="__codelineno-23-3" href="#__codelineno-23-3"></a><span class="nf">mov</span><span class="w"> </span><span class="p">[</span><span class="no">rsp</span><span class="err">+</span><span class="mi">32</span><span class="p">],</span><span class="w"> </span><span class="no">ebx</span><span class="w">       </span><span class="c1">; b = 5</span>
</span></code></pre></div>
<h4 id="asignacion-a-traves-de-puntero">Asignación a través de Puntero<a class="headerlink" href="#asignacion-a-traves-de-puntero" title="Permanent link">&para;</a></h4>
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-24-1"><a id="__codelineno-24-1" name="__codelineno-24-1" href="#__codelineno-24-1"></a><span class="kt">int</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">5</span><span class="p">;</span>
</span><span id="__span-24-2"><a id="__codelineno-24-2" name="__codelineno-24-2" href="#__codelineno-24-2"></a><span class="kt">int</span><span class="o">*</span><span class="w"> </span><span class="n">pa</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="n">a</span><span class="p">;</span>
</span><span id="__span-24-3"><a id="__codelineno-24-3" name="__codelineno-24-3" href="#__codelineno-24-3"></a><span class="o">*</span><span class="n">pa</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">10</span><span class="p">;</span><span class="w">           </span><span class="c1">// a ahora vale 10</span>
</span></code></pre></div>
<div class="language-asm highlight"><pre><span></span><code><span id="__span-25-1"><a id="__codelineno-25-1" name="__codelineno-25-1" href="#__codelineno-25-1"></a><span class="nf">mov</span><span class="w"> </span><span class="no">rax</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="no">rsp</span><span class="err">+</span><span class="mi">28</span><span class="p">]</span><span class="w">           </span><span class="c1">; RAX = pa (dirección de a)</span>
</span><span id="__span-25-2"><a id="__codelineno-25-2" name="__codelineno-25-2" href="#__codelineno-25-2"></a><span class="nf">mov</span><span class="w"> </span><span class="no">dword</span><span class="w"> </span><span class="no">ptr</span><span class="w"> </span><span class="p">[</span><span class="no">rax</span><span class="p">],</span><span class="w"> </span><span class="mi">10</span><span class="w">     </span><span class="c1">; *pa = 10</span>
</span></code></pre></div>
<h4 id="cadena-de-lectura">Cadena de Lectura<a class="headerlink" href="#cadena-de-lectura" title="Permanent link">&para;</a></h4>
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-26-1"><a id="__codelineno-26-1" name="__codelineno-26-1" href="#__codelineno-26-1"></a><span class="kt">int</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">5</span><span class="p">;</span>
</span><span id="__span-26-2"><a id="__codelineno-26-2" name="__codelineno-26-2" href="#__codelineno-26-2"></a><span class="kt">int</span><span class="o">*</span><span class="w"> </span><span class="n">pa</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="n">a</span><span class="p">;</span>
</span><span id="__span-26-3"><a id="__codelineno-26-3" name="__codelineno-26-3" href="#__codelineno-26-3"></a><span class="kt">int</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">*</span><span class="n">pa</span><span class="p">;</span><span class="w">        </span><span class="c1">// b = 5</span>
</span><span id="__span-26-4"><a id="__codelineno-26-4" name="__codelineno-26-4" href="#__codelineno-26-4"></a><span class="kt">int</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w">      </span><span class="c1">// c = 6</span>
</span></code></pre></div>
<div class="language-asm highlight"><pre><span></span><code><span id="__span-27-1"><a id="__codelineno-27-1" name="__codelineno-27-1" href="#__codelineno-27-1"></a><span class="nf">mov</span><span class="w"> </span><span class="no">rax</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="no">rsp</span><span class="err">+</span><span class="mi">28</span><span class="p">]</span><span class="w">           </span><span class="c1">; RAX = pa</span>
</span><span id="__span-27-2"><a id="__codelineno-27-2" name="__codelineno-27-2" href="#__codelineno-27-2"></a><span class="nf">mov</span><span class="w"> </span><span class="no">ebx</span><span class="p">,</span><span class="w"> </span><span class="no">dword</span><span class="w"> </span><span class="no">ptr</span><span class="w"> </span><span class="p">[</span><span class="no">rax</span><span class="p">]</span><span class="w">    </span><span class="c1">; EBX = *pa = 5</span>
</span><span id="__span-27-3"><a id="__codelineno-27-3" name="__codelineno-27-3" href="#__codelineno-27-3"></a><span class="nf">mov</span><span class="w"> </span><span class="no">ecx</span><span class="p">,</span><span class="w"> </span><span class="no">ebx</span><span class="w">                </span><span class="c1">; ECX = 5</span>
</span><span id="__span-27-4"><a id="__codelineno-27-4" name="__codelineno-27-4" href="#__codelineno-27-4"></a><span class="nf">add</span><span class="w"> </span><span class="no">ecx</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="w">                  </span><span class="c1">; ECX = 6</span>
</span><span id="__span-27-5"><a id="__codelineno-27-5" name="__codelineno-27-5" href="#__codelineno-27-5"></a><span class="nf">mov</span><span class="w"> </span><span class="p">[</span><span class="no">rsp</span><span class="err">+</span><span class="mi">36</span><span class="p">],</span><span class="w"> </span><span class="no">ecx</span><span class="w">           </span><span class="c1">; c = 6</span>
</span></code></pre></div>
<hr />
<h2 id="parte-4-ejemplo-del-curso-analisis-detallado">Parte 4: Ejemplo del Curso - Análisis Detallado<a class="headerlink" href="#parte-4-ejemplo-del-curso-analisis-detallado" title="Permanent link">&para;</a></h2>
<h3 id="codigo-fuente">Código Fuente<a class="headerlink" href="#codigo-fuente" title="Permanent link">&para;</a></h3>
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-28-1"><a id="__codelineno-28-1" name="__codelineno-28-1" href="#__codelineno-28-1"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span>
</span><span id="__span-28-2"><a id="__codelineno-28-2" name="__codelineno-28-2" href="#__codelineno-28-2"></a><span class="k">using</span><span class="w"> </span><span class="k">namespace</span><span class="w"> </span><span class="nn">std</span><span class="p">;</span>
</span><span id="__span-28-3"><a id="__codelineno-28-3" name="__codelineno-28-3" href="#__codelineno-28-3"></a>
</span><span id="__span-28-4"><a id="__codelineno-28-4" name="__codelineno-28-4" href="#__codelineno-28-4"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-28-5"><a id="__codelineno-28-5" name="__codelineno-28-5" href="#__codelineno-28-5"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">a</span><span class="p">;</span><span class="w">              </span><span class="c1">// Variable a (tipo int)</span>
</span><span id="__span-28-6"><a id="__codelineno-28-6" name="__codelineno-28-6" href="#__codelineno-28-6"></a><span class="w">    </span><span class="kt">int</span><span class="o">*</span><span class="w"> </span><span class="n">pa</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="n">a</span><span class="p">;</span><span class="w">       </span><span class="c1">// Puntero pa que apunta a a</span>
</span><span id="__span-28-7"><a id="__codelineno-28-7" name="__codelineno-28-7" href="#__codelineno-28-7"></a>
</span><span id="__span-28-8"><a id="__codelineno-28-8" name="__codelineno-28-8" href="#__codelineno-28-8"></a><span class="w">    </span><span class="o">*</span><span class="n">pa</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">5</span><span class="p">;</span><span class="w">            </span><span class="c1">// Asignar 5 a a a través del puntero</span>
</span><span id="__span-28-9"><a id="__codelineno-28-9" name="__codelineno-28-9" href="#__codelineno-28-9"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">*</span><span class="n">pa</span><span class="p">;</span><span class="w">        </span><span class="c1">// Leer valor de a a través del puntero</span>
</span><span id="__span-28-10"><a id="__codelineno-28-10" name="__codelineno-28-10" href="#__codelineno-28-10"></a><span class="w">    </span><span class="o">*</span><span class="n">pa</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">10</span><span class="p">;</span><span class="w">           </span><span class="c1">// Asignar 10 a a a través del puntero</span>
</span><span id="__span-28-11"><a id="__codelineno-28-11" name="__codelineno-28-11" href="#__codelineno-28-11"></a>
</span><span id="__span-28-12"><a id="__codelineno-28-12" name="__codelineno-28-12" href="#__codelineno-28-12"></a><span class="w">    </span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;a = &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;, b = &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">endl</span><span class="p">;</span>
</span><span id="__span-28-13"><a id="__codelineno-28-13" name="__codelineno-28-13" href="#__codelineno-28-13"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
</span><span id="__span-28-14"><a id="__codelineno-28-14" name="__codelineno-28-14" href="#__codelineno-28-14"></a><span class="p">}</span>
</span></code></pre></div>
<p><strong>Valores finales:</strong></p>
<ul>
<li><code>a = 10</code> (fue modificado a través de pa)</li>
<li><code>b = 5</code> (se asignó antes de que a cambiara a 10)</li>
</ul>
<h3 id="ensamblador-anotado-x64-windows-con-simbolos">Ensamblador Anotado (x64 Windows, con símbolos)<a class="headerlink" href="#ensamblador-anotado-x64-windows-con-simbolos" title="Permanent link">&para;</a></h3>
<h4 id="prologo">Prólogo<a class="headerlink" href="#prologo" title="Permanent link">&para;</a></h4>
<div class="language-asm highlight"><pre><span></span><code><span id="__span-29-1"><a id="__codelineno-29-1" name="__codelineno-29-1" href="#__codelineno-29-1"></a><span class="err">00401000:</span><span class="w"> </span><span class="nf">push</span><span class="w">    </span><span class="no">rbp</span>
</span><span id="__span-29-2"><a id="__codelineno-29-2" name="__codelineno-29-2" href="#__codelineno-29-2"></a><span class="err">00401001:</span><span class="w"> </span><span class="nf">mov</span><span class="w">     </span><span class="no">rbp</span><span class="p">,</span><span class="w"> </span><span class="no">rsp</span>
</span><span id="__span-29-3"><a id="__codelineno-29-3" name="__codelineno-29-3" href="#__codelineno-29-3"></a><span class="err">00401004:</span><span class="w"> </span><span class="nf">sub</span><span class="w">     </span><span class="no">rsp</span><span class="p">,</span><span class="w"> </span><span class="mi">40</span><span class="no">h</span><span class="w">        </span><span class="c1">; Reservar 64 bytes en el stack</span>
</span><span id="__span-29-4"><a id="__codelineno-29-4" name="__codelineno-29-4" href="#__codelineno-29-4"></a><span class="err">00401008:</span><span class="w"> </span><span class="nf">mov</span><span class="w">     </span><span class="no">rax</span><span class="p">,</span><span class="w"> </span><span class="no">fs</span><span class="p">:[</span><span class="mi">28</span><span class="no">h</span><span class="p">]</span><span class="w">   </span><span class="c1">; Security Cookie</span>
</span><span id="__span-29-5"><a id="__codelineno-29-5" name="__codelineno-29-5" href="#__codelineno-29-5"></a><span class="err">0040100</span><span class="nl">F:</span><span class="w"> </span><span class="nf">mov</span><span class="w">     </span><span class="p">[</span><span class="no">rsp</span><span class="err">+</span><span class="mi">38</span><span class="no">h</span><span class="p">],</span><span class="w"> </span><span class="no">rax</span><span class="w">  </span><span class="c1">; Guardar cookie</span>
</span></code></pre></div>
<p><strong>Stack layout:</strong></p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-30-1"><a id="__codelineno-30-1" name="__codelineno-30-1" href="#__codelineno-30-1"></a>RSP+0x00:  Shadow Space (32 bytes)
</span><span id="__span-30-2"><a id="__codelineno-30-2" name="__codelineno-30-2" href="#__codelineno-30-2"></a>RSP+0x20:  a (int, 4 bytes)
</span><span id="__span-30-3"><a id="__codelineno-30-3" name="__codelineno-30-3" href="#__codelineno-30-3"></a>RSP+0x24:  [padding, 4 bytes]
</span><span id="__span-30-4"><a id="__codelineno-30-4" name="__codelineno-30-4" href="#__codelineno-30-4"></a>RSP+0x28:  pa (puntero, 8 bytes)
</span><span id="__span-30-5"><a id="__codelineno-30-5" name="__codelineno-30-5" href="#__codelineno-30-5"></a>RSP+0x30:  [padding, 8 bytes]
</span><span id="__span-30-6"><a id="__codelineno-30-6" name="__codelineno-30-6" href="#__codelineno-30-6"></a>RSP+0x38:  Security Cookie (8 bytes)
</span><span id="__span-30-7"><a id="__codelineno-30-7" name="__codelineno-30-7" href="#__codelineno-30-7"></a>RSP+0x40:  RBP y return address
</span></code></pre></div>
<h4 id="asignacion-pa-a">Asignación: pa = &amp;a<a class="headerlink" href="#asignacion-pa-a" title="Permanent link">&para;</a></h4>
<div class="language-asm highlight"><pre><span></span><code><span id="__span-31-1"><a id="__codelineno-31-1" name="__codelineno-31-1" href="#__codelineno-31-1"></a><span class="err">00401018:</span><span class="w"> </span><span class="nf">lea</span><span class="w">     </span><span class="no">rax</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="no">rsp</span><span class="err">+</span><span class="mi">20</span><span class="no">h</span><span class="p">]</span><span class="w">  </span><span class="c1">; RAX = dirección de a</span>
</span><span id="__span-31-2"><a id="__codelineno-31-2" name="__codelineno-31-2" href="#__codelineno-31-2"></a><span class="w">                                   </span><span class="c1">; [rsp+20h] es donde está a</span>
</span><span id="__span-31-3"><a id="__codelineno-31-3" name="__codelineno-31-3" href="#__codelineno-31-3"></a><span class="w">                                   </span><span class="c1">; lea obtiene esta dirección</span>
</span><span id="__span-31-4"><a id="__codelineno-31-4" name="__codelineno-31-4" href="#__codelineno-31-4"></a><span class="err">00401020:</span><span class="w"> </span><span class="nf">mov</span><span class="w">     </span><span class="p">[</span><span class="no">rsp</span><span class="err">+</span><span class="mi">28</span><span class="no">h</span><span class="p">],</span><span class="w"> </span><span class="no">rax</span><span class="w">   </span><span class="c1">; [rsp+28h] = pa</span>
</span><span id="__span-31-5"><a id="__codelineno-31-5" name="__codelineno-31-5" href="#__codelineno-31-5"></a><span class="w">                                   </span><span class="c1">; pa ahora contiene dirección de a</span>
</span></code></pre></div>
<p><strong>Resultado:</strong></p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-32-1"><a id="__codelineno-32-1" name="__codelineno-32-1" href="#__codelineno-32-1"></a>pa = 0x...RSP+0x20  (dirección de a)
</span><span id="__span-32-2"><a id="__codelineno-32-2" name="__codelineno-32-2" href="#__codelineno-32-2"></a>a  = ? (aún no inicializado)
</span></code></pre></div>
<h4 id="lectura-simple-de-pa">Lectura Simple de pa<a class="headerlink" href="#lectura-simple-de-pa" title="Permanent link">&para;</a></h4>
<div class="language-asm highlight"><pre><span></span><code><span id="__span-33-1"><a id="__codelineno-33-1" name="__codelineno-33-1" href="#__codelineno-33-1"></a><span class="err">00401024:</span><span class="w"> </span><span class="nf">mov</span><span class="w">     </span><span class="no">rax</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="no">rsp</span><span class="err">+</span><span class="mi">28</span><span class="no">h</span><span class="p">]</span><span class="w">  </span><span class="c1">; RAX = pa (dirección de a)</span>
</span><span id="__span-33-2"><a id="__codelineno-33-2" name="__codelineno-33-2" href="#__codelineno-33-2"></a><span class="w">                                   </span><span class="c1">; RAX contiene la dirección</span>
</span></code></pre></div>
<p><strong>Registro RAX después:</strong></p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-34-1"><a id="__codelineno-34-1" name="__codelineno-34-1" href="#__codelineno-34-1"></a>RAX = 0x...RSP+0x20 (la dirección de a)
</span></code></pre></div>
<h4 id="asignacion-a-traves-del-puntero-pa-5">Asignación a través del Puntero: *pa = 5<a class="headerlink" href="#asignacion-a-traves-del-puntero-pa-5" title="Permanent link">&para;</a></h4>
<div class="language-asm highlight"><pre><span></span><code><span id="__span-35-1"><a id="__codelineno-35-1" name="__codelineno-35-1" href="#__codelineno-35-1"></a><span class="err">00401028:</span><span class="w"> </span><span class="nf">mov</span><span class="w">     </span><span class="no">dword</span><span class="w"> </span><span class="no">ptr</span><span class="w"> </span><span class="p">[</span><span class="no">rax</span><span class="p">],</span><span class="w"> </span><span class="mi">5</span><span class="w">  </span><span class="c1">; Escribir 5 en [RAX]</span>
</span><span id="__span-35-2"><a id="__codelineno-35-2" name="__codelineno-35-2" href="#__codelineno-35-2"></a><span class="w">                                       </span><span class="c1">; [RAX] = [dirección de a] = 5</span>
</span></code></pre></div>
<p><strong>Resultado en memoria:</strong></p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-36-1"><a id="__codelineno-36-1" name="__codelineno-36-1" href="#__codelineno-36-1"></a>[RSP+0x20] = 5  (a ahora vale 5)
</span></code></pre></div>
<h4 id="lectura-a-traves-del-puntero-pa">Lectura a través del Puntero: *pa<a class="headerlink" href="#lectura-a-traves-del-puntero-pa" title="Permanent link">&para;</a></h4>
<div class="language-asm highlight"><pre><span></span><code><span id="__span-37-1"><a id="__codelineno-37-1" name="__codelineno-37-1" href="#__codelineno-37-1"></a><span class="err">00401030:</span><span class="w"> </span><span class="nf">mov</span><span class="w">     </span><span class="no">rax</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="no">rsp</span><span class="err">+</span><span class="mi">28</span><span class="no">h</span><span class="p">]</span><span class="w">      </span><span class="c1">; RAX = pa (dirección de a)</span>
</span><span id="__span-37-2"><a id="__codelineno-37-2" name="__codelineno-37-2" href="#__codelineno-37-2"></a><span class="err">00401034:</span><span class="w"> </span><span class="nf">mov</span><span class="w">     </span><span class="no">edx</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="no">rax</span><span class="p">]</span><span class="w">          </span><span class="c1">; EDX = *pa = 5 (valor de a)</span>
</span></code></pre></div>
<h4 id="asignacion-a-b-pa">Asignación a b = *pa<a class="headerlink" href="#asignacion-a-b-pa" title="Permanent link">&para;</a></h4>
<div class="language-asm highlight"><pre><span></span><code><span id="__span-38-1"><a id="__codelineno-38-1" name="__codelineno-38-1" href="#__codelineno-38-1"></a><span class="err">00401036:</span><span class="w"> </span><span class="nf">mov</span><span class="w">     </span><span class="p">[</span><span class="no">rsp</span><span class="err">+</span><span class="mi">24</span><span class="no">h</span><span class="p">],</span><span class="w"> </span><span class="no">edx</span><span class="w">      </span><span class="c1">; [rsp+24h] = b</span>
</span><span id="__span-38-2"><a id="__codelineno-38-2" name="__codelineno-38-2" href="#__codelineno-38-2"></a><span class="w">                                       </span><span class="c1">; b ahora vale 5</span>
</span></code></pre></div>
<p><strong>Stack ahora:</strong></p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-39-1"><a id="__codelineno-39-1" name="__codelineno-39-1" href="#__codelineno-39-1"></a>[RSP+0x20] = 5      (a = 5)
</span><span id="__span-39-2"><a id="__codelineno-39-2" name="__codelineno-39-2" href="#__codelineno-39-2"></a>[RSP+0x24] = 5      (b = 5)
</span><span id="__span-39-3"><a id="__codelineno-39-3" name="__codelineno-39-3" href="#__codelineno-39-3"></a>[RSP+0x28] = dirección de a
</span></code></pre></div>
<h4 id="segunda-asignacion-pa-10">Segunda Asignación: *pa = 10<a class="headerlink" href="#segunda-asignacion-pa-10" title="Permanent link">&para;</a></h4>
<div class="language-asm highlight"><pre><span></span><code><span id="__span-40-1"><a id="__codelineno-40-1" name="__codelineno-40-1" href="#__codelineno-40-1"></a><span class="err">0040103</span><span class="nl">A:</span><span class="w"> </span><span class="nf">mov</span><span class="w">     </span><span class="no">rax</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="no">rsp</span><span class="err">+</span><span class="mi">28</span><span class="no">h</span><span class="p">]</span><span class="w">      </span><span class="c1">; RAX = pa (dirección de a)</span>
</span><span id="__span-40-2"><a id="__codelineno-40-2" name="__codelineno-40-2" href="#__codelineno-40-2"></a><span class="err">00401040:</span><span class="w"> </span><span class="nf">mov</span><span class="w">     </span><span class="no">dword</span><span class="w"> </span><span class="no">ptr</span><span class="w"> </span><span class="p">[</span><span class="no">rax</span><span class="p">],</span><span class="w"> </span><span class="mi">10</span><span class="w"> </span><span class="c1">; Escribir 10 en [RAX]</span>
</span><span id="__span-40-3"><a id="__codelineno-40-3" name="__codelineno-40-3" href="#__codelineno-40-3"></a><span class="w">                                       </span><span class="c1">; a ahora vale 10</span>
</span></code></pre></div>
<p><strong>Resultado:</strong></p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-41-1"><a id="__codelineno-41-1" name="__codelineno-41-1" href="#__codelineno-41-1"></a>[RSP+0x20] = 10     (a = 10)
</span><span id="__span-41-2"><a id="__codelineno-41-2" name="__codelineno-41-2" href="#__codelineno-41-2"></a>[RSP+0x24] = 5      (b = 5, no cambió)
</span></code></pre></div>
<h4 id="impresion-y-epilogo">Impresión y Epilogo<a class="headerlink" href="#impresion-y-epilogo" title="Permanent link">&para;</a></h4>
<div class="language-asm highlight"><pre><span></span><code><span id="__span-42-1"><a id="__codelineno-42-1" name="__codelineno-42-1" href="#__codelineno-42-1"></a><span class="err">00401044:</span><span class="w"> </span><span class="nf">lea</span><span class="w">     </span><span class="no">rcx</span><span class="p">,</span><span class="w"> </span><span class="no">std</span><span class="p">::</span><span class="no">cout</span><span class="w">      </span><span class="c1">; RCX = &amp;cout</span>
</span><span id="__span-42-2"><a id="__codelineno-42-2" name="__codelineno-42-2" href="#__codelineno-42-2"></a><span class="err">00401050:</span><span class="w"> </span><span class="nf">lea</span><span class="w">     </span><span class="no">rdx</span><span class="p">,</span><span class="w"> </span><span class="no">formato</span><span class="w">        </span><span class="c1">; RDX = &quot;a = %d, b = %d&quot;</span>
</span><span id="__span-42-3"><a id="__codelineno-42-3" name="__codelineno-42-3" href="#__codelineno-42-3"></a><span class="err">00401057:</span><span class="w"> </span><span class="nf">call</span><span class="w">    </span><span class="no">std</span><span class="p">::</span><span class="no">operator</span><span class="err">&lt;&lt;</span><span class="w">     </span><span class="c1">; Imprimir</span>
</span><span id="__span-42-4"><a id="__codelineno-42-4" name="__codelineno-42-4" href="#__codelineno-42-4"></a>
</span><span id="__span-42-5"><a id="__codelineno-42-5" name="__codelineno-42-5" href="#__codelineno-42-5"></a><span class="err">00401060:</span><span class="w"> </span><span class="nf">mov</span><span class="w">     </span><span class="no">ecx</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="w">              </span><span class="c1">; return 0</span>
</span><span id="__span-42-6"><a id="__codelineno-42-6" name="__codelineno-42-6" href="#__codelineno-42-6"></a><span class="err">00401065:</span><span class="w"> </span><span class="nf">mov</span><span class="w">     </span><span class="no">rax</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="no">rsp</span><span class="err">+</span><span class="mi">38</span><span class="no">h</span><span class="p">]</span><span class="w">      </span><span class="c1">; Leer security cookie</span>
</span><span id="__span-42-7"><a id="__codelineno-42-7" name="__codelineno-42-7" href="#__codelineno-42-7"></a><span class="err">0040106</span><span class="nl">C:</span><span class="w"> </span><span class="nf">xor</span><span class="w">     </span><span class="no">rax</span><span class="p">,</span><span class="w"> </span><span class="no">fs</span><span class="p">:[</span><span class="mi">28</span><span class="no">h</span><span class="p">]</span><span class="w">       </span><span class="c1">; Verificar</span>
</span><span id="__span-42-8"><a id="__codelineno-42-8" name="__codelineno-42-8" href="#__codelineno-42-8"></a><span class="err">00401074:</span><span class="w"> </span><span class="nf">call</span><span class="w">    </span><span class="no">__security_check_cookie</span>
</span><span id="__span-42-9"><a id="__codelineno-42-9" name="__codelineno-42-9" href="#__codelineno-42-9"></a><span class="err">00401080:</span><span class="w"> </span><span class="nf">add</span><span class="w">     </span><span class="no">rsp</span><span class="p">,</span><span class="w"> </span><span class="mi">40</span><span class="no">h</span><span class="w">            </span><span class="c1">; Liberar stack</span>
</span><span id="__span-42-10"><a id="__codelineno-42-10" name="__codelineno-42-10" href="#__codelineno-42-10"></a><span class="err">00401087:</span><span class="w"> </span><span class="nf">pop</span><span class="w">     </span><span class="no">rbp</span>
</span><span id="__span-42-11"><a id="__codelineno-42-11" name="__codelineno-42-11" href="#__codelineno-42-11"></a><span class="err">00401088:</span><span class="w"> </span><span class="nf">ret</span>
</span></code></pre></div>
<h3 id="visualizacion-en-depuracion">Visualización en Depuración<a class="headerlink" href="#visualizacion-en-depuracion" title="Permanent link">&para;</a></h3>
<p><strong>Paso 1: Después de <code>lea rax, [rsp+20h]</code></strong></p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-43-1"><a id="__codelineno-43-1" name="__codelineno-43-1" href="#__codelineno-43-1"></a>RAX = 0x1000000020  (dirección de a)
</span><span id="__span-43-2"><a id="__codelineno-43-2" name="__codelineno-43-2" href="#__codelineno-43-2"></a>[RSP+0x28] = ???    (aún no asignado)
</span></code></pre></div>
<p><strong>Paso 2: Después de <code>mov [rsp+28h], rax</code></strong></p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-44-1"><a id="__codelineno-44-1" name="__codelineno-44-1" href="#__codelineno-44-1"></a>RAX = 0x1000000020
</span><span id="__span-44-2"><a id="__codelineno-44-2" name="__codelineno-44-2" href="#__codelineno-44-2"></a>[RSP+0x28] = 0x1000000020  (pa ahora apunta a a)
</span></code></pre></div>
<p><strong>Paso 3: Después de <code>mov dword ptr [rax], 5</code></strong></p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-45-1"><a id="__codelineno-45-1" name="__codelineno-45-1" href="#__codelineno-45-1"></a>RAX = 0x1000000020  (dirección de a)
</span><span id="__span-45-2"><a id="__codelineno-45-2" name="__codelineno-45-2" href="#__codelineno-45-2"></a>[RSP+0x20] = 5      (a ahora vale 5)
</span></code></pre></div>
<p><strong>Paso 4: Después de <code>mov edx, [rax]</code></strong></p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-46-1"><a id="__codelineno-46-1" name="__codelineno-46-1" href="#__codelineno-46-1"></a>RAX = 0x1000000020  (dirección de a)
</span><span id="__span-46-2"><a id="__codelineno-46-2" name="__codelineno-46-2" href="#__codelineno-46-2"></a>EDX = 5             (se leyó el valor de a)
</span></code></pre></div>
<p><strong>Paso 5: Después de <code>mov dword ptr [rax], 10</code></strong></p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-47-1"><a id="__codelineno-47-1" name="__codelineno-47-1" href="#__codelineno-47-1"></a>RAX = 0x1000000020
</span><span id="__span-47-2"><a id="__codelineno-47-2" name="__codelineno-47-2" href="#__codelineno-47-2"></a>[RSP+0x20] = 10     (a cambiado a 10)
</span><span id="__span-47-3"><a id="__codelineno-47-3" name="__codelineno-47-3" href="#__codelineno-47-3"></a>[RSP+0x24] = 5      (b se mantuvo en 5)
</span></code></pre></div>
<hr />
<h2 id="parte-5-punteros-a-estructuras">Parte 5: Punteros a Estructuras<a class="headerlink" href="#parte-5-punteros-a-estructuras" title="Permanent link">&para;</a></h2>
<h3 id="declaracion">Declaración<a class="headerlink" href="#declaracion" title="Permanent link">&para;</a></h3>
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-48-1"><a id="__codelineno-48-1" name="__codelineno-48-1" href="#__codelineno-48-1"></a><span class="k">struct</span><span class="w"> </span><span class="nc">Persona</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-48-2"><a id="__codelineno-48-2" name="__codelineno-48-2" href="#__codelineno-48-2"></a><span class="w">    </span><span class="kt">char</span><span class="w"> </span><span class="n">nombre</span><span class="p">[</span><span class="mi">65</span><span class="p">];</span>
</span><span id="__span-48-3"><a id="__codelineno-48-3" name="__codelineno-48-3" href="#__codelineno-48-3"></a><span class="w">    </span><span class="kt">char</span><span class="w"> </span><span class="n">direccion</span><span class="p">[</span><span class="mi">65</span><span class="p">];</span>
</span><span id="__span-48-4"><a id="__codelineno-48-4" name="__codelineno-48-4" href="#__codelineno-48-4"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">anio_nacimiento</span><span class="p">;</span>
</span><span id="__span-48-5"><a id="__codelineno-48-5" name="__codelineno-48-5" href="#__codelineno-48-5"></a><span class="p">};</span>
</span><span id="__span-48-6"><a id="__codelineno-48-6" name="__codelineno-48-6" href="#__codelineno-48-6"></a>
</span><span id="__span-48-7"><a id="__codelineno-48-7" name="__codelineno-48-7" href="#__codelineno-48-7"></a><span class="n">Persona</span><span class="w"> </span><span class="n">p</span><span class="p">;</span>
</span><span id="__span-48-8"><a id="__codelineno-48-8" name="__codelineno-48-8" href="#__codelineno-48-8"></a><span class="n">Persona</span><span class="o">*</span><span class="w"> </span><span class="n">pp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="n">p</span><span class="p">;</span><span class="w">       </span><span class="c1">// Puntero a estructura</span>
</span></code></pre></div>
<h3 id="acceso-a-campos">Acceso a Campos<a class="headerlink" href="#acceso-a-campos" title="Permanent link">&para;</a></h3>
<h4 id="metodo-1-acceso-directo">Método 1: Acceso Directo<a class="headerlink" href="#metodo-1-acceso-directo" title="Permanent link">&para;</a></h4>
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-49-1"><a id="__codelineno-49-1" name="__codelineno-49-1" href="#__codelineno-49-1"></a><span class="n">Persona</span><span class="w"> </span><span class="n">p</span><span class="p">;</span>
</span><span id="__span-49-2"><a id="__codelineno-49-2" name="__codelineno-49-2" href="#__codelineno-49-2"></a><span class="n">p</span><span class="p">.</span><span class="n">nombre</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="sc">&#39;J&#39;</span><span class="p">;</span>
</span><span id="__span-49-3"><a id="__codelineno-49-3" name="__codelineno-49-3" href="#__codelineno-49-3"></a><span class="n">p</span><span class="p">.</span><span class="n">anio_nacimiento</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1990</span><span class="p">;</span>
</span></code></pre></div>
<h4 id="metodo-2-acceso-a-traves-de-puntero">Método 2: Acceso a través de Puntero<a class="headerlink" href="#metodo-2-acceso-a-traves-de-puntero" title="Permanent link">&para;</a></h4>
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-50-1"><a id="__codelineno-50-1" name="__codelineno-50-1" href="#__codelineno-50-1"></a><span class="n">Persona</span><span class="w"> </span><span class="n">p</span><span class="p">;</span>
</span><span id="__span-50-2"><a id="__codelineno-50-2" name="__codelineno-50-2" href="#__codelineno-50-2"></a><span class="n">Persona</span><span class="o">*</span><span class="w"> </span><span class="n">pp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="n">p</span><span class="p">;</span>
</span><span id="__span-50-3"><a id="__codelineno-50-3" name="__codelineno-50-3" href="#__codelineno-50-3"></a>
</span><span id="__span-50-4"><a id="__codelineno-50-4" name="__codelineno-50-4" href="#__codelineno-50-4"></a><span class="n">pp</span><span class="o">-&gt;</span><span class="n">nombre</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="sc">&#39;J&#39;</span><span class="p">;</span><span class="w">           </span><span class="c1">// Equivalente a p.nombre[0]</span>
</span><span id="__span-50-5"><a id="__codelineno-50-5" name="__codelineno-50-5" href="#__codelineno-50-5"></a><span class="n">pp</span><span class="o">-&gt;</span><span class="n">anio_nacimiento</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1990</span><span class="p">;</span><span class="w">    </span><span class="c1">// Equivalente a p.anio_nacimiento</span>
</span></code></pre></div>
<h3 id="en-ensamblador">En Ensamblador<a class="headerlink" href="#en-ensamblador" title="Permanent link">&para;</a></h3>
<div class="language-asm highlight"><pre><span></span><code><span id="__span-51-1"><a id="__codelineno-51-1" name="__codelineno-51-1" href="#__codelineno-51-1"></a><span class="c1">; pp = &amp;p</span>
</span><span id="__span-51-2"><a id="__codelineno-51-2" name="__codelineno-51-2" href="#__codelineno-51-2"></a><span class="nf">lea</span><span class="w"> </span><span class="no">rax</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="no">rsp</span><span class="err">+</span><span class="mi">28</span><span class="p">]</span><span class="w">           </span><span class="c1">; RAX = dirección de p</span>
</span><span id="__span-51-3"><a id="__codelineno-51-3" name="__codelineno-51-3" href="#__codelineno-51-3"></a><span class="nf">mov</span><span class="w"> </span><span class="p">[</span><span class="no">rsp</span><span class="err">+</span><span class="mi">120</span><span class="p">],</span><span class="w"> </span><span class="no">rax</span><span class="w">          </span><span class="c1">; pp = RAX</span>
</span><span id="__span-51-4"><a id="__codelineno-51-4" name="__codelineno-51-4" href="#__codelineno-51-4"></a>
</span><span id="__span-51-5"><a id="__codelineno-51-5" name="__codelineno-51-5" href="#__codelineno-51-5"></a><span class="c1">; pp-&gt;anio_nacimiento = 1990</span>
</span><span id="__span-51-6"><a id="__codelineno-51-6" name="__codelineno-51-6" href="#__codelineno-51-6"></a><span class="nf">mov</span><span class="w"> </span><span class="no">rax</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="no">rsp</span><span class="err">+</span><span class="mi">120</span><span class="p">]</span><span class="w">          </span><span class="c1">; RAX = pp (dirección de p)</span>
</span><span id="__span-51-7"><a id="__codelineno-51-7" name="__codelineno-51-7" href="#__codelineno-51-7"></a><span class="nf">add</span><span class="w"> </span><span class="no">rax</span><span class="p">,</span><span class="w"> </span><span class="mi">130</span><span class="w">                </span><span class="c1">; RAX += offset de anio_nacimiento</span>
</span><span id="__span-51-8"><a id="__codelineno-51-8" name="__codelineno-51-8" href="#__codelineno-51-8"></a><span class="nf">mov</span><span class="w"> </span><span class="no">dword</span><span class="w"> </span><span class="no">ptr</span><span class="w"> </span><span class="p">[</span><span class="no">rax</span><span class="p">],</span><span class="w"> </span><span class="mi">1990</span><span class="w">   </span><span class="c1">; Escribir 1990</span>
</span><span id="__span-51-9"><a id="__codelineno-51-9" name="__codelineno-51-9" href="#__codelineno-51-9"></a>
</span><span id="__span-51-10"><a id="__codelineno-51-10" name="__codelineno-51-10" href="#__codelineno-51-10"></a><span class="c1">; int edad = pp-&gt;anio_nacimiento</span>
</span><span id="__span-51-11"><a id="__codelineno-51-11" name="__codelineno-51-11" href="#__codelineno-51-11"></a><span class="nf">mov</span><span class="w"> </span><span class="no">rax</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="no">rsp</span><span class="err">+</span><span class="mi">120</span><span class="p">]</span><span class="w">          </span><span class="c1">; RAX = pp</span>
</span><span id="__span-51-12"><a id="__codelineno-51-12" name="__codelineno-51-12" href="#__codelineno-51-12"></a><span class="nf">add</span><span class="w"> </span><span class="no">rax</span><span class="p">,</span><span class="w"> </span><span class="mi">130</span><span class="w">                </span><span class="c1">; RAX += offset</span>
</span><span id="__span-51-13"><a id="__codelineno-51-13" name="__codelineno-51-13" href="#__codelineno-51-13"></a><span class="nf">mov</span><span class="w"> </span><span class="no">edx</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="no">rax</span><span class="p">]</span><span class="w">              </span><span class="c1">; EDX = *[RAX]</span>
</span><span id="__span-51-14"><a id="__codelineno-51-14" name="__codelineno-51-14" href="#__codelineno-51-14"></a><span class="nf">mov</span><span class="w"> </span><span class="p">[</span><span class="no">rsp</span><span class="err">+</span><span class="mi">64</span><span class="p">],</span><span class="w"> </span><span class="no">edx</span><span class="w">           </span><span class="c1">; edad = EDX</span>
</span></code></pre></div>
<hr />
<h2 id="parte-6-punteros-y-funciones">Parte 6: Punteros y Funciones<a class="headerlink" href="#parte-6-punteros-y-funciones" title="Permanent link">&para;</a></h2>
<h3 id="pasar-puntero-a-funcion">Pasar Puntero a Función<a class="headerlink" href="#pasar-puntero-a-funcion" title="Permanent link">&para;</a></h3>
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-52-1"><a id="__codelineno-52-1" name="__codelineno-52-1" href="#__codelineno-52-1"></a><span class="kt">void</span><span class="w"> </span><span class="nf">modificar</span><span class="p">(</span><span class="kt">int</span><span class="o">*</span><span class="w"> </span><span class="n">ptr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-52-2"><a id="__codelineno-52-2" name="__codelineno-52-2" href="#__codelineno-52-2"></a><span class="w">    </span><span class="o">*</span><span class="n">ptr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">20</span><span class="p">;</span><span class="w">              </span><span class="c1">// Modifica el valor al que apunta</span>
</span><span id="__span-52-3"><a id="__codelineno-52-3" name="__codelineno-52-3" href="#__codelineno-52-3"></a><span class="p">}</span>
</span><span id="__span-52-4"><a id="__codelineno-52-4" name="__codelineno-52-4" href="#__codelineno-52-4"></a>
</span><span id="__span-52-5"><a id="__codelineno-52-5" name="__codelineno-52-5" href="#__codelineno-52-5"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-52-6"><a id="__codelineno-52-6" name="__codelineno-52-6" href="#__codelineno-52-6"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">10</span><span class="p">;</span>
</span><span id="__span-52-7"><a id="__codelineno-52-7" name="__codelineno-52-7" href="#__codelineno-52-7"></a><span class="w">    </span><span class="n">modificar</span><span class="p">(</span><span class="o">&amp;</span><span class="n">a</span><span class="p">);</span><span class="w">          </span><span class="c1">// Pasar puntero a a</span>
</span><span id="__span-52-8"><a id="__codelineno-52-8" name="__codelineno-52-8" href="#__codelineno-52-8"></a><span class="w">    </span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">endl</span><span class="p">;</span><span class="w">      </span><span class="c1">// Imprime 20</span>
</span><span id="__span-52-9"><a id="__codelineno-52-9" name="__codelineno-52-9" href="#__codelineno-52-9"></a><span class="p">}</span>
</span></code></pre></div>
<p><strong>Ventaja:</strong> No se copia el valor, solo se pasa la dirección (8 bytes).</p>
<h3 id="en-ensamblador_1">En Ensamblador<a class="headerlink" href="#en-ensamblador_1" title="Permanent link">&para;</a></h3>
<h4 id="llamada-a-la-funcion">Llamada a la función<a class="headerlink" href="#llamada-a-la-funcion" title="Permanent link">&para;</a></h4>
<div class="language-asm highlight"><pre><span></span><code><span id="__span-53-1"><a id="__codelineno-53-1" name="__codelineno-53-1" href="#__codelineno-53-1"></a><span class="nf">lea</span><span class="w"> </span><span class="no">rax</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="no">rsp</span><span class="err">+</span><span class="mi">20</span><span class="p">]</span><span class="w">           </span><span class="c1">; RAX = &amp;a</span>
</span><span id="__span-53-2"><a id="__codelineno-53-2" name="__codelineno-53-2" href="#__codelineno-53-2"></a><span class="nf">mov</span><span class="w"> </span><span class="no">rcx</span><span class="p">,</span><span class="w"> </span><span class="no">rax</span><span class="w">                </span><span class="c1">; RCX = puntero (primer parámetro)</span>
</span><span id="__span-53-3"><a id="__codelineno-53-3" name="__codelineno-53-3" href="#__codelineno-53-3"></a><span class="nf">call</span><span class="w"> </span><span class="no">modificar</span><span class="w">              </span><span class="c1">; Llamar</span>
</span></code></pre></div>
<p><strong>x64 FastCall:</strong> El primer parámetro va en <code>RCX</code>.</p>
<h4 id="dentro-de-modificar">Dentro de modificar()<a class="headerlink" href="#dentro-de-modificar" title="Permanent link">&para;</a></h4>
<div class="language-asm highlight"><pre><span></span><code><span id="__span-54-1"><a id="__codelineno-54-1" name="__codelineno-54-1" href="#__codelineno-54-1"></a><span class="nf">modificar</span><span class="w"> </span><span class="no">proc</span><span class="w"> </span><span class="no">near</span><span class="p">:</span>
</span><span id="__span-54-2"><a id="__codelineno-54-2" name="__codelineno-54-2" href="#__codelineno-54-2"></a><span class="w">    </span><span class="nf">mov</span><span class="w"> </span><span class="no">rcx</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="no">rbp</span><span class="err">+</span><span class="mi">16</span><span class="p">]</span><span class="w">       </span><span class="c1">; RCX = puntero pasado</span>
</span><span id="__span-54-3"><a id="__codelineno-54-3" name="__codelineno-54-3" href="#__codelineno-54-3"></a><span class="w">    </span><span class="nf">mov</span><span class="w"> </span><span class="no">dword</span><span class="w"> </span><span class="no">ptr</span><span class="w"> </span><span class="p">[</span><span class="no">rcx</span><span class="p">],</span><span class="w"> </span><span class="mi">20</span><span class="w"> </span><span class="c1">; *ptr = 20</span>
</span><span id="__span-54-4"><a id="__codelineno-54-4" name="__codelineno-54-4" href="#__codelineno-54-4"></a><span class="w">    </span><span class="nf">ret</span>
</span></code></pre></div>
<h3 id="caso-de-uso-estructuras-grandes">Caso de Uso: Estructuras Grandes<a class="headerlink" href="#caso-de-uso-estructuras-grandes" title="Permanent link">&para;</a></h3>
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-55-1"><a id="__codelineno-55-1" name="__codelineno-55-1" href="#__codelineno-55-1"></a><span class="k">struct</span><span class="w"> </span><span class="nc">DatosGrandes</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-55-2"><a id="__codelineno-55-2" name="__codelineno-55-2" href="#__codelineno-55-2"></a><span class="w">    </span><span class="kt">char</span><span class="w"> </span><span class="n">datos</span><span class="p">[</span><span class="mi">8000</span><span class="p">];</span><span class="w">       </span><span class="c1">// 8 KB</span>
</span><span id="__span-55-3"><a id="__codelineno-55-3" name="__codelineno-55-3" href="#__codelineno-55-3"></a><span class="p">};</span>
</span><span id="__span-55-4"><a id="__codelineno-55-4" name="__codelineno-55-4" href="#__codelineno-55-4"></a>
</span><span id="__span-55-5"><a id="__codelineno-55-5" name="__codelineno-55-5" href="#__codelineno-55-5"></a><span class="kt">void</span><span class="w"> </span><span class="nf">procesar</span><span class="p">(</span><span class="n">DatosGrandes</span><span class="o">*</span><span class="w"> </span><span class="n">pdatos</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">  </span><span class="c1">// Pasar puntero (8 bytes)</span>
</span><span id="__span-55-6"><a id="__codelineno-55-6" name="__codelineno-55-6" href="#__codelineno-55-6"></a><span class="w">    </span><span class="n">pdatos</span><span class="o">-&gt;</span><span class="n">datos</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="sc">&#39;A&#39;</span><span class="p">;</span>
</span><span id="__span-55-7"><a id="__codelineno-55-7" name="__codelineno-55-7" href="#__codelineno-55-7"></a><span class="p">}</span>
</span><span id="__span-55-8"><a id="__codelineno-55-8" name="__codelineno-55-8" href="#__codelineno-55-8"></a>
</span><span id="__span-55-9"><a id="__codelineno-55-9" name="__codelineno-55-9" href="#__codelineno-55-9"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-55-10"><a id="__codelineno-55-10" name="__codelineno-55-10" href="#__codelineno-55-10"></a><span class="w">    </span><span class="n">DatosGrandes</span><span class="w"> </span><span class="n">d</span><span class="p">;</span>
</span><span id="__span-55-11"><a id="__codelineno-55-11" name="__codelineno-55-11" href="#__codelineno-55-11"></a><span class="w">    </span><span class="n">procesar</span><span class="p">(</span><span class="o">&amp;</span><span class="n">d</span><span class="p">);</span><span class="w">           </span><span class="c1">// Pasar puntero, no copiar 8 KB</span>
</span><span id="__span-55-12"><a id="__codelineno-55-12" name="__codelineno-55-12" href="#__codelineno-55-12"></a><span class="p">}</span>
</span></code></pre></div>
<p><strong>Sin punteros:</strong> Sería necesario copiar 8000 bytes en el stack.<br />
<strong>Con punteros:</strong> Solo se copia una dirección (8 bytes).</p>
<hr />
<h2 id="parte-7-aritmetica-de-punteros">Parte 7: Aritmética de Punteros<a class="headerlink" href="#parte-7-aritmetica-de-punteros" title="Permanent link">&para;</a></h2>
<h3 id="el-concepto-fundamental">El Concepto Fundamental<a class="headerlink" href="#el-concepto-fundamental" title="Permanent link">&para;</a></h3>
<p>Cuando incrementamos un puntero, <strong>no sumamos 1 byte</strong>, sino que sumamos <strong>el tamaño del tipo de dato al que apunta</strong>:</p>
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-56-1"><a id="__codelineno-56-1" name="__codelineno-56-1" href="#__codelineno-56-1"></a><span class="kt">int</span><span class="w"> </span><span class="n">vector</span><span class="p">[</span><span class="mi">10</span><span class="p">];</span>
</span><span id="__span-56-2"><a id="__codelineno-56-2" name="__codelineno-56-2" href="#__codelineno-56-2"></a><span class="kt">int</span><span class="o">*</span><span class="w"> </span><span class="n">puntero</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">vector</span><span class="p">;</span><span class="w">      </span><span class="c1">// Apunta al primer elemento</span>
</span><span id="__span-56-3"><a id="__codelineno-56-3" name="__codelineno-56-3" href="#__codelineno-56-3"></a>
</span><span id="__span-56-4"><a id="__codelineno-56-4" name="__codelineno-56-4" href="#__codelineno-56-4"></a><span class="n">puntero</span><span class="o">++</span><span class="p">;</span><span class="w">                  </span><span class="c1">// A bajo nivel: suma 4 (sizeof(int))</span>
</span><span id="__span-56-5"><a id="__codelineno-56-5" name="__codelineno-56-5" href="#__codelineno-56-5"></a><span class="n">puntero</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">puntero</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">7</span><span class="p">;</span><span class="w">      </span><span class="c1">// A bajo nivel: suma 28 (7 * sizeof(int))</span>
</span></code></pre></div>
<p><strong>Regla de oro:</strong> <code>puntero + N</code> equivale a <code>puntero + (N * sizeof(tipo))</code></p>
<h3 id="suma-y-resta-de-punteros">Suma y Resta de Punteros<a class="headerlink" href="#suma-y-resta-de-punteros" title="Permanent link">&para;</a></h3>
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-57-1"><a id="__codelineno-57-1" name="__codelineno-57-1" href="#__codelineno-57-1"></a><span class="kt">int</span><span class="w"> </span><span class="n">arr</span><span class="p">[</span><span class="mi">10</span><span class="p">];</span>
</span><span id="__span-57-2"><a id="__codelineno-57-2" name="__codelineno-57-2" href="#__codelineno-57-2"></a><span class="kt">int</span><span class="o">*</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">arr</span><span class="p">;</span><span class="w">   </span><span class="c1">// p apunta al primer elemento</span>
</span><span id="__span-57-3"><a id="__codelineno-57-3" name="__codelineno-57-3" href="#__codelineno-57-3"></a>
</span><span id="__span-57-4"><a id="__codelineno-57-4" name="__codelineno-57-4" href="#__codelineno-57-4"></a><span class="n">p</span><span class="o">++</span><span class="p">;</span><span class="w">            </span><span class="c1">// p ahora apunta al segundo elemento</span>
</span><span id="__span-57-5"><a id="__codelineno-57-5" name="__codelineno-57-5" href="#__codelineno-57-5"></a><span class="n">p</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="mi">5</span><span class="p">;</span><span class="w">         </span><span class="c1">// p ahora apunta al sexto elemento</span>
</span><span id="__span-57-6"><a id="__codelineno-57-6" name="__codelineno-57-6" href="#__codelineno-57-6"></a><span class="n">p</span><span class="o">--</span><span class="p">;</span><span class="w">            </span><span class="c1">// p ahora apunta al quinto elemento</span>
</span></code></pre></div>
<p><strong>En memoria:</strong></p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-58-1"><a id="__codelineno-58-1" name="__codelineno-58-1" href="#__codelineno-58-1"></a>arr[0]  en 0x1000
</span><span id="__span-58-2"><a id="__codelineno-58-2" name="__codelineno-58-2" href="#__codelineno-58-2"></a>arr[1]  en 0x1004  (0x1000 + 4)
</span><span id="__span-58-3"><a id="__codelineno-58-3" name="__codelineno-58-3" href="#__codelineno-58-3"></a>arr[2]  en 0x1008  (0x1000 + 8)
</span><span id="__span-58-4"><a id="__codelineno-58-4" name="__codelineno-58-4" href="#__codelineno-58-4"></a>arr[5]  en 0x1014  (0x1000 + 20)
</span><span id="__span-58-5"><a id="__codelineno-58-5" name="__codelineno-58-5" href="#__codelineno-58-5"></a>
</span><span id="__span-58-6"><a id="__codelineno-58-6" name="__codelineno-58-6" href="#__codelineno-58-6"></a>p = 0x1000
</span><span id="__span-58-7"><a id="__codelineno-58-7" name="__codelineno-58-7" href="#__codelineno-58-7"></a>p++     =&gt; p = 0x1004  (suma el tamaño del tipo: 4 bytes para int)
</span><span id="__span-58-8"><a id="__codelineno-58-8" name="__codelineno-58-8" href="#__codelineno-58-8"></a>p += 5  =&gt; p = 0x1014  (suma 5 * 4 = 20 bytes)
</span></code></pre></div>
<p><strong>En ensamblador:</strong></p>
<div class="language-asm highlight"><pre><span></span><code><span id="__span-59-1"><a id="__codelineno-59-1" name="__codelineno-59-1" href="#__codelineno-59-1"></a><span class="nf">lea</span><span class="w"> </span><span class="no">rax</span><span class="p">,</span><span class="w"> </span><span class="no">arr</span><span class="w">            </span><span class="c1">; RAX = dirección de arr[0]</span>
</span><span id="__span-59-2"><a id="__codelineno-59-2" name="__codelineno-59-2" href="#__codelineno-59-2"></a><span class="nf">mov</span><span class="w"> </span><span class="no">rcx</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span>
</span><span id="__span-59-3"><a id="__codelineno-59-3" name="__codelineno-59-3" href="#__codelineno-59-3"></a><span class="nf">add</span><span class="w"> </span><span class="no">rax</span><span class="p">,</span><span class="w"> </span><span class="no">rcx</span><span class="w">            </span><span class="c1">; Esto suma 1 byte, INCORRECTO</span>
</span><span id="__span-59-4"><a id="__codelineno-59-4" name="__codelineno-59-4" href="#__codelineno-59-4"></a>
</span><span id="__span-59-5"><a id="__codelineno-59-5" name="__codelineno-59-5" href="#__codelineno-59-5"></a><span class="c1">; Correcto:</span>
</span><span id="__span-59-6"><a id="__codelineno-59-6" name="__codelineno-59-6" href="#__codelineno-59-6"></a><span class="nf">lea</span><span class="w"> </span><span class="no">rax</span><span class="p">,</span><span class="w"> </span><span class="no">arr</span>
</span><span id="__span-59-7"><a id="__codelineno-59-7" name="__codelineno-59-7" href="#__codelineno-59-7"></a><span class="nf">mov</span><span class="w"> </span><span class="no">rcx</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span>
</span><span id="__span-59-8"><a id="__codelineno-59-8" name="__codelineno-59-8" href="#__codelineno-59-8"></a><span class="nf">imul</span><span class="w"> </span><span class="no">rcx</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="w">             </span><span class="c1">; Multiplicar offset por tamaño de int</span>
</span><span id="__span-59-9"><a id="__codelineno-59-9" name="__codelineno-59-9" href="#__codelineno-59-9"></a><span class="nf">add</span><span class="w"> </span><span class="no">rax</span><span class="p">,</span><span class="w"> </span><span class="no">rcx</span><span class="w">            </span><span class="c1">; Ahora apunta a arr[1]</span>
</span><span id="__span-59-10"><a id="__codelineno-59-10" name="__codelineno-59-10" href="#__codelineno-59-10"></a>
</span><span id="__span-59-11"><a id="__codelineno-59-11" name="__codelineno-59-11" href="#__codelineno-59-11"></a><span class="c1">; O más directo:</span>
</span><span id="__span-59-12"><a id="__codelineno-59-12" name="__codelineno-59-12" href="#__codelineno-59-12"></a><span class="nf">lea</span><span class="w"> </span><span class="no">rax</span><span class="p">,</span><span class="w"> </span><span class="no">arr</span>
</span><span id="__span-59-13"><a id="__codelineno-59-13" name="__codelineno-59-13" href="#__codelineno-59-13"></a><span class="nf">add</span><span class="w"> </span><span class="no">rax</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="w">              </span><span class="c1">; Sumar directamente 4 bytes = arr[1]</span>
</span></code></pre></div>
<h3 id="diferencia-de-punteros">Diferencia de Punteros<a class="headerlink" href="#diferencia-de-punteros" title="Permanent link">&para;</a></h3>
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-60-1"><a id="__codelineno-60-1" name="__codelineno-60-1" href="#__codelineno-60-1"></a><span class="kt">int</span><span class="o">*</span><span class="w"> </span><span class="n">p1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="n">arr</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
</span><span id="__span-60-2"><a id="__codelineno-60-2" name="__codelineno-60-2" href="#__codelineno-60-2"></a><span class="kt">int</span><span class="o">*</span><span class="w"> </span><span class="n">p2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="n">arr</span><span class="p">[</span><span class="mi">5</span><span class="p">];</span>
</span><span id="__span-60-3"><a id="__codelineno-60-3" name="__codelineno-60-3" href="#__codelineno-60-3"></a>
</span><span id="__span-60-4"><a id="__codelineno-60-4" name="__codelineno-60-4" href="#__codelineno-60-4"></a><span class="kt">int</span><span class="w"> </span><span class="n">distancia</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">p2</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">p1</span><span class="p">;</span><span class="w">    </span><span class="c1">// distancia = 3</span>
</span></code></pre></div>
<p><strong>En ensamblador:</strong></p>
<div class="language-asm highlight"><pre><span></span><code><span id="__span-61-1"><a id="__codelineno-61-1" name="__codelineno-61-1" href="#__codelineno-61-1"></a><span class="nf">lea</span><span class="w"> </span><span class="no">rax</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="no">arr</span><span class="err">+</span><span class="mi">8</span><span class="p">]</span><span class="w">            </span><span class="c1">; p1 = &amp;arr[2]</span>
</span><span id="__span-61-2"><a id="__codelineno-61-2" name="__codelineno-61-2" href="#__codelineno-61-2"></a><span class="nf">lea</span><span class="w"> </span><span class="no">rbx</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="no">arr</span><span class="err">+</span><span class="mi">20</span><span class="p">]</span><span class="w">           </span><span class="c1">; p2 = &amp;arr[5]</span>
</span><span id="__span-61-3"><a id="__codelineno-61-3" name="__codelineno-61-3" href="#__codelineno-61-3"></a>
</span><span id="__span-61-4"><a id="__codelineno-61-4" name="__codelineno-61-4" href="#__codelineno-61-4"></a><span class="nf">mov</span><span class="w"> </span><span class="no">rcx</span><span class="p">,</span><span class="w"> </span><span class="no">rbx</span>
</span><span id="__span-61-5"><a id="__codelineno-61-5" name="__codelineno-61-5" href="#__codelineno-61-5"></a><span class="nf">sub</span><span class="w"> </span><span class="no">rcx</span><span class="p">,</span><span class="w"> </span><span class="no">rax</span><span class="w">                </span><span class="c1">; RCX = p2 - p1 = 12 bytes</span>
</span><span id="__span-61-6"><a id="__codelineno-61-6" name="__codelineno-61-6" href="#__codelineno-61-6"></a><span class="nf">sar</span><span class="w"> </span><span class="no">rcx</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="w">                  </span><span class="c1">; Dividir por 4 (tamaño de int)</span>
</span><span id="__span-61-7"><a id="__codelineno-61-7" name="__codelineno-61-7" href="#__codelineno-61-7"></a><span class="c1">; RCX = 3 (elementos)</span>
</span></code></pre></div>
<h3 id="aritmetica-de-punteros-con-estructuras">Aritmética de Punteros con Estructuras<a class="headerlink" href="#aritmetica-de-punteros-con-estructuras" title="Permanent link">&para;</a></h3>
<p>Cuando el puntero apunta a una <strong>estructura</strong>, el incremento suma el tamaño de toda la estructura:</p>
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-62-1"><a id="__codelineno-62-1" name="__codelineno-62-1" href="#__codelineno-62-1"></a><span class="c1">// Estructura de números complejos</span>
</span><span id="__span-62-2"><a id="__codelineno-62-2" name="__codelineno-62-2" href="#__codelineno-62-2"></a><span class="k">struct</span><span class="w"> </span><span class="nc">st_complejo</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-62-3"><a id="__codelineno-62-3" name="__codelineno-62-3" href="#__codelineno-62-3"></a><span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">real</span><span class="p">;</span><span class="w">         </span><span class="c1">// 4 bytes</span>
</span><span id="__span-62-4"><a id="__codelineno-62-4" name="__codelineno-62-4" href="#__codelineno-62-4"></a><span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">imaginario</span><span class="p">;</span><span class="w">   </span><span class="c1">// 4 bytes</span>
</span><span id="__span-62-5"><a id="__codelineno-62-5" name="__codelineno-62-5" href="#__codelineno-62-5"></a><span class="p">};</span><span class="w">                      </span><span class="c1">// Total: 8 bytes</span>
</span><span id="__span-62-6"><a id="__codelineno-62-6" name="__codelineno-62-6" href="#__codelineno-62-6"></a>
</span><span id="__span-62-7"><a id="__codelineno-62-7" name="__codelineno-62-7" href="#__codelineno-62-7"></a><span class="n">st_complejo</span><span class="w"> </span><span class="n">complejo</span><span class="p">[</span><span class="mi">10</span><span class="p">];</span><span class="w">           </span><span class="c1">// Array de 10 estructuras (global)</span>
</span><span id="__span-62-8"><a id="__codelineno-62-8" name="__codelineno-62-8" href="#__codelineno-62-8"></a><span class="n">st_complejo</span><span class="o">*</span><span class="w"> </span><span class="n">p_complejo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">complejo</span><span class="p">;</span><span class="w"> </span><span class="c1">// Puntero al inicio</span>
</span><span id="__span-62-9"><a id="__codelineno-62-9" name="__codelineno-62-9" href="#__codelineno-62-9"></a>
</span><span id="__span-62-10"><a id="__codelineno-62-10" name="__codelineno-62-10" href="#__codelineno-62-10"></a><span class="n">p_complejo</span><span class="o">++</span><span class="p">;</span><span class="w">   </span><span class="c1">// A bajo nivel: suma 8 bytes (sizeof(st_complejo))</span>
</span></code></pre></div>
<p><strong>Layout en memoria:</strong></p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-63-1"><a id="__codelineno-63-1" name="__codelineno-63-1" href="#__codelineno-63-1"></a>Dirección       Contenido
</span><span id="__span-63-2"><a id="__codelineno-63-2" name="__codelineno-63-2" href="#__codelineno-63-2"></a>0x7FF304        complejo[0].real
</span><span id="__span-63-3"><a id="__codelineno-63-3" name="__codelineno-63-3" href="#__codelineno-63-3"></a>0x7FF308        complejo[0].imaginario
</span><span id="__span-63-4"><a id="__codelineno-63-4" name="__codelineno-63-4" href="#__codelineno-63-4"></a>0x7FF30C        complejo[1].real         ← p_complejo después de ++
</span><span id="__span-63-5"><a id="__codelineno-63-5" name="__codelineno-63-5" href="#__codelineno-63-5"></a>0x7FF310        complejo[1].imaginario
</span><span id="__span-63-6"><a id="__codelineno-63-6" name="__codelineno-63-6" href="#__codelineno-63-6"></a>0x7FF314        complejo[2].real
</span><span id="__span-63-7"><a id="__codelineno-63-7" name="__codelineno-63-7" href="#__codelineno-63-7"></a>...
</span></code></pre></div>
<p><strong>En ensamblador:</strong></p>
<div class="language-asm highlight"><pre><span></span><code><span id="__span-64-1"><a id="__codelineno-64-1" name="__codelineno-64-1" href="#__codelineno-64-1"></a><span class="c1">; p_complejo = complejo</span>
</span><span id="__span-64-2"><a id="__codelineno-64-2" name="__codelineno-64-2" href="#__codelineno-64-2"></a><span class="nf">lea</span><span class="w"> </span><span class="no">rax</span><span class="p">,</span><span class="w"> </span><span class="no">complejo</span><span class="w">           </span><span class="c1">; RAX = dirección de la estructura</span>
</span><span id="__span-64-3"><a id="__codelineno-64-3" name="__codelineno-64-3" href="#__codelineno-64-3"></a><span class="nf">mov</span><span class="w"> </span><span class="p">[</span><span class="no">rsp</span><span class="err">+</span><span class="mi">28</span><span class="p">],</span><span class="w"> </span><span class="no">rax</span><span class="w">           </span><span class="c1">; Guardar en p_complejo</span>
</span><span id="__span-64-4"><a id="__codelineno-64-4" name="__codelineno-64-4" href="#__codelineno-64-4"></a>
</span><span id="__span-64-5"><a id="__codelineno-64-5" name="__codelineno-64-5" href="#__codelineno-64-5"></a><span class="c1">; p_complejo++ (incrementar por sizeof(st_complejo) = 8)</span>
</span><span id="__span-64-6"><a id="__codelineno-64-6" name="__codelineno-64-6" href="#__codelineno-64-6"></a><span class="nf">mov</span><span class="w"> </span><span class="no">rax</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="no">rsp</span><span class="err">+</span><span class="mi">28</span><span class="p">]</span><span class="w">           </span><span class="c1">; RAX = p_complejo</span>
</span><span id="__span-64-7"><a id="__codelineno-64-7" name="__codelineno-64-7" href="#__codelineno-64-7"></a><span class="nf">add</span><span class="w"> </span><span class="no">rax</span><span class="p">,</span><span class="w"> </span><span class="mi">8</span><span class="w">                  </span><span class="c1">; Sumar 8 (tamaño de la estructura)</span>
</span><span id="__span-64-8"><a id="__codelineno-64-8" name="__codelineno-64-8" href="#__codelineno-64-8"></a><span class="nf">mov</span><span class="w"> </span><span class="p">[</span><span class="no">rsp</span><span class="err">+</span><span class="mi">28</span><span class="p">],</span><span class="w"> </span><span class="no">rax</span><span class="w">           </span><span class="c1">; Guardar de vuelta</span>
</span></code></pre></div>
<p><strong>En IDA Pro:</strong></p>
<p>Cuando tenemos símbolos, IDA nos muestra en Local Types:
<div class="language-text highlight"><pre><span></span><code><span id="__span-65-1"><a id="__codelineno-65-1" name="__codelineno-65-1" href="#__codelineno-65-1"></a>st_complejo size=8
</span></code></pre></div></p>
<p>Y en el stack frame vemos:
<div class="language-text highlight"><pre><span></span><code><span id="__span-66-1"><a id="__codelineno-66-1" name="__codelineno-66-1" href="#__codelineno-66-1"></a>p_complejo: st_complejo*
</span></code></pre></div></p>
<h3 id="notaciones-equivalentes-punteros-y-arrays">Notaciones Equivalentes: Punteros y Arrays<a class="headerlink" href="#notaciones-equivalentes-punteros-y-arrays" title="Permanent link">&para;</a></h3>
<p>En C/C++, estas dos notaciones son <strong>equivalentes</strong>:</p>
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-67-1"><a id="__codelineno-67-1" name="__codelineno-67-1" href="#__codelineno-67-1"></a><span class="kt">int</span><span class="w"> </span><span class="n">arr</span><span class="p">[</span><span class="mi">10</span><span class="p">];</span>
</span><span id="__span-67-2"><a id="__codelineno-67-2" name="__codelineno-67-2" href="#__codelineno-67-2"></a><span class="kt">int</span><span class="o">*</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">arr</span><span class="p">;</span>
</span><span id="__span-67-3"><a id="__codelineno-67-3" name="__codelineno-67-3" href="#__codelineno-67-3"></a>
</span><span id="__span-67-4"><a id="__codelineno-67-4" name="__codelineno-67-4" href="#__codelineno-67-4"></a><span class="c1">// Estas dos líneas hacen lo mismo:</span>
</span><span id="__span-67-5"><a id="__codelineno-67-5" name="__codelineno-67-5" href="#__codelineno-67-5"></a><span class="o">*</span><span class="p">(</span><span class="n">p</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">7</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">5</span><span class="p">;</span><span class="w">       </span><span class="c1">// Forma con aritmética de punteros</span>
</span><span id="__span-67-6"><a id="__codelineno-67-6" name="__codelineno-67-6" href="#__codelineno-67-6"></a><span class="n">p</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">5</span><span class="p">;</span><span class="w">           </span><span class="c1">// Forma con notación de array</span>
</span></code></pre></div>
<p><strong>También funciona al revés:</strong></p>
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-68-1"><a id="__codelineno-68-1" name="__codelineno-68-1" href="#__codelineno-68-1"></a><span class="n">arr</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">5</span><span class="p">;</span><span class="w">         </span><span class="c1">// Notación de array</span>
</span><span id="__span-68-2"><a id="__codelineno-68-2" name="__codelineno-68-2" href="#__codelineno-68-2"></a><span class="o">*</span><span class="p">(</span><span class="n">arr</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">7</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">5</span><span class="p">;</span><span class="w">     </span><span class="c1">// Notación de puntero (arr se convierte a puntero)</span>
</span></code></pre></div>
<p><strong>Importante:</strong> La diferencia es que el nombre del array (<code>arr</code>) <strong>no puede reasignarse</strong>, mientras que un puntero sí:</p>
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-69-1"><a id="__codelineno-69-1" name="__codelineno-69-1" href="#__codelineno-69-1"></a><span class="kt">int</span><span class="o">*</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">arr</span><span class="p">;</span>
</span><span id="__span-69-2"><a id="__codelineno-69-2" name="__codelineno-69-2" href="#__codelineno-69-2"></a><span class="n">p</span><span class="o">++</span><span class="p">;</span><span class="w">            </span><span class="c1">// ✅ Válido: p ahora apunta a arr[1]</span>
</span><span id="__span-69-3"><a id="__codelineno-69-3" name="__codelineno-69-3" href="#__codelineno-69-3"></a>
</span><span id="__span-69-4"><a id="__codelineno-69-4" name="__codelineno-69-4" href="#__codelineno-69-4"></a><span class="n">arr</span><span class="o">++</span><span class="p">;</span><span class="w">          </span><span class="c1">// ❌ ERROR: &quot;lvalue required&quot; - arr es constante</span>
</span></code></pre></div>
<h3 id="inicializacion-de-punteros-en-posicion-arbitraria">Inicialización de Punteros en Posición Arbitraria<a class="headerlink" href="#inicializacion-de-punteros-en-posicion-arbitraria" title="Permanent link">&para;</a></h3>
<p>Un puntero puede inicializarse en <strong>cualquier posición</strong> del array:</p>
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-70-1"><a id="__codelineno-70-1" name="__codelineno-70-1" href="#__codelineno-70-1"></a><span class="kt">int</span><span class="w"> </span><span class="n">arr</span><span class="p">[</span><span class="mi">10</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="mi">6</span><span class="p">,</span><span class="w"> </span><span class="mi">7</span><span class="p">,</span><span class="w"> </span><span class="mi">8</span><span class="p">,</span><span class="w"> </span><span class="mi">9</span><span class="p">};</span>
</span><span id="__span-70-2"><a id="__codelineno-70-2" name="__codelineno-70-2" href="#__codelineno-70-2"></a><span class="kt">int</span><span class="o">*</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="n">arr</span><span class="p">[</span><span class="mi">5</span><span class="p">];</span><span class="w">       </span><span class="c1">// Iniciar en el campo 5</span>
</span><span id="__span-70-3"><a id="__codelineno-70-3" name="__codelineno-70-3" href="#__codelineno-70-3"></a>
</span><span id="__span-70-4"><a id="__codelineno-70-4" name="__codelineno-70-4" href="#__codelineno-70-4"></a><span class="c1">// Ahora los índices son relativos a esa posición:</span>
</span><span id="__span-70-5"><a id="__codelineno-70-5" name="__codelineno-70-5" href="#__codelineno-70-5"></a><span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">100</span><span class="p">;</span><span class="w">             </span><span class="c1">// Modifica arr[5]</span>
</span><span id="__span-70-6"><a id="__codelineno-70-6" name="__codelineno-70-6" href="#__codelineno-70-6"></a><span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">200</span><span class="p">;</span><span class="w">             </span><span class="c1">// Modifica arr[7]</span>
</span><span id="__span-70-7"><a id="__codelineno-70-7" name="__codelineno-70-7" href="#__codelineno-70-7"></a><span class="n">p</span><span class="p">[</span><span class="mi">-2</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">300</span><span class="p">;</span><span class="w">            </span><span class="c1">// Modifica arr[3] (índices negativos!)</span>
</span></code></pre></div>
<p><strong>En ensamblador:</strong></p>
<div class="language-asm highlight"><pre><span></span><code><span id="__span-71-1"><a id="__codelineno-71-1" name="__codelineno-71-1" href="#__codelineno-71-1"></a><span class="nf">lea</span><span class="w"> </span><span class="no">rax</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="no">arr</span><span class="err">+</span><span class="mi">20</span><span class="p">]</span><span class="w">       </span><span class="c1">; RAX = &amp;arr[5] (5 * 4 = 20)</span>
</span><span id="__span-71-2"><a id="__codelineno-71-2" name="__codelineno-71-2" href="#__codelineno-71-2"></a><span class="nf">mov</span><span class="w"> </span><span class="p">[</span><span class="no">rsp</span><span class="err">+</span><span class="mi">28</span><span class="p">],</span><span class="w"> </span><span class="no">rax</span><span class="w">       </span><span class="c1">; p = RAX</span>
</span><span id="__span-71-3"><a id="__codelineno-71-3" name="__codelineno-71-3" href="#__codelineno-71-3"></a>
</span><span id="__span-71-4"><a id="__codelineno-71-4" name="__codelineno-71-4" href="#__codelineno-71-4"></a><span class="c1">; p[-2] = 300 (equivale a arr[3])</span>
</span><span id="__span-71-5"><a id="__codelineno-71-5" name="__codelineno-71-5" href="#__codelineno-71-5"></a><span class="nf">mov</span><span class="w"> </span><span class="no">rax</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="no">rsp</span><span class="err">+</span><span class="mi">28</span><span class="p">]</span><span class="w">       </span><span class="c1">; RAX = p</span>
</span><span id="__span-71-6"><a id="__codelineno-71-6" name="__codelineno-71-6" href="#__codelineno-71-6"></a><span class="nf">sub</span><span class="w"> </span><span class="no">rax</span><span class="p">,</span><span class="w"> </span><span class="mi">8</span><span class="w">              </span><span class="c1">; RAX = p - 2 (2 * 4 = 8)</span>
</span><span id="__span-71-7"><a id="__codelineno-71-7" name="__codelineno-71-7" href="#__codelineno-71-7"></a><span class="nf">mov</span><span class="w"> </span><span class="no">dword</span><span class="w"> </span><span class="no">ptr</span><span class="w"> </span><span class="p">[</span><span class="no">rax</span><span class="p">],</span><span class="w"> </span><span class="mi">300</span>
</span></code></pre></div>
<hr />
<h2 id="parte-75-punteros-genericos-void">Parte 7.5: Punteros Genéricos (void*)<a class="headerlink" href="#parte-75-punteros-genericos-void" title="Permanent link">&para;</a></h2>
<h3 id="concepto">Concepto<a class="headerlink" href="#concepto" title="Permanent link">&para;</a></h3>
<p>Un puntero genérico no tiene un tipo asociado. Puede apuntar a <strong>cualquier cosa</strong>:</p>
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-72-1"><a id="__codelineno-72-1" name="__codelineno-72-1" href="#__codelineno-72-1"></a><span class="kt">void</span><span class="o">*</span><span class="w"> </span><span class="n">b</span><span class="p">;</span><span class="w">                </span><span class="c1">// Puntero genérico, sin tipo</span>
</span><span id="__span-72-2"><a id="__codelineno-72-2" name="__codelineno-72-2" href="#__codelineno-72-2"></a><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">cadena</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Hola&quot;</span><span class="p">;</span>
</span><span id="__span-72-3"><a id="__codelineno-72-3" name="__codelineno-72-3" href="#__codelineno-72-3"></a><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">void</span><span class="o">*</span><span class="p">)</span><span class="n">cadena</span><span class="p">;</span><span class="w">      </span><span class="c1">// Castear para asignar</span>
</span></code></pre></div>
<h3 id="limitaciones">Limitaciones<a class="headerlink" href="#limitaciones" title="Permanent link">&para;</a></h3>
<p><strong>No se puede hacer aritmética sin castear:</strong></p>
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-73-1"><a id="__codelineno-73-1" name="__codelineno-73-1" href="#__codelineno-73-1"></a><span class="kt">void</span><span class="o">*</span><span class="w"> </span><span class="n">p</span><span class="p">;</span>
</span><span id="__span-73-2"><a id="__codelineno-73-2" name="__codelineno-73-2" href="#__codelineno-73-2"></a><span class="n">p</span><span class="o">++</span><span class="p">;</span><span class="w">        </span><span class="c1">// ❌ ERROR: ¿Cuánto suma? No hay tipo.</span>
</span><span id="__span-73-3"><a id="__codelineno-73-3" name="__codelineno-73-3" href="#__codelineno-73-3"></a><span class="n">p</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="mi">5</span><span class="p">;</span><span class="w">     </span><span class="c1">// ❌ ERROR: No se puede calcular el offset.</span>
</span></code></pre></div>
<p><strong>Razón:</strong> El compilador necesita saber el tamaño del tipo para calcular el offset.</p>
<h3 id="uso-correcto">Uso Correcto<a class="headerlink" href="#uso-correcto" title="Permanent link">&para;</a></h3>
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-74-1"><a id="__codelineno-74-1" name="__codelineno-74-1" href="#__codelineno-74-1"></a><span class="kt">void</span><span class="o">*</span><span class="w"> </span><span class="n">b</span><span class="p">;</span>
</span><span id="__span-74-2"><a id="__codelineno-74-2" name="__codelineno-74-2" href="#__codelineno-74-2"></a><span class="kt">int</span><span class="o">*</span><span class="w"> </span><span class="n">enteros</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="o">*</span><span class="p">)</span><span class="n">malloc</span><span class="p">(</span><span class="mi">10</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="kt">int</span><span class="p">));</span>
</span><span id="__span-74-3"><a id="__codelineno-74-3" name="__codelineno-74-3" href="#__codelineno-74-3"></a><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">void</span><span class="o">*</span><span class="p">)</span><span class="n">enteros</span><span class="p">;</span><span class="w">         </span><span class="c1">// Guardar como genérico</span>
</span><span id="__span-74-4"><a id="__codelineno-74-4" name="__codelineno-74-4" href="#__codelineno-74-4"></a>
</span><span id="__span-74-5"><a id="__codelineno-74-5" name="__codelineno-74-5" href="#__codelineno-74-5"></a><span class="c1">// Para usar, siempre castear:</span>
</span><span id="__span-74-6"><a id="__codelineno-74-6" name="__codelineno-74-6" href="#__codelineno-74-6"></a><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">*</span><span class="p">((</span><span class="kt">int</span><span class="o">*</span><span class="p">)</span><span class="n">b</span><span class="p">);</span><span class="w">         </span><span class="c1">// Castear a int* y desreferenciar</span>
</span><span id="__span-74-7"><a id="__codelineno-74-7" name="__codelineno-74-7" href="#__codelineno-74-7"></a><span class="p">((</span><span class="kt">int</span><span class="o">*</span><span class="p">)</span><span class="n">b</span><span class="p">)[</span><span class="mi">5</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">100</span><span class="p">;</span><span class="w">         </span><span class="c1">// Castear y usar como array</span>
</span></code></pre></div>
<p><strong>En ensamblador:</strong></p>
<div class="language-asm highlight"><pre><span></span><code><span id="__span-75-1"><a id="__codelineno-75-1" name="__codelineno-75-1" href="#__codelineno-75-1"></a><span class="c1">; int x = *((int*)b)</span>
</span><span id="__span-75-2"><a id="__codelineno-75-2" name="__codelineno-75-2" href="#__codelineno-75-2"></a><span class="nf">mov</span><span class="w"> </span><span class="no">rax</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="no">rsp</span><span class="err">+</span><span class="mi">28</span><span class="p">]</span><span class="w">           </span><span class="c1">; RAX = b (dirección sin tipo)</span>
</span><span id="__span-75-3"><a id="__codelineno-75-3" name="__codelineno-75-3" href="#__codelineno-75-3"></a><span class="nf">mov</span><span class="w"> </span><span class="no">edx</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="no">rax</span><span class="p">]</span><span class="w">              </span><span class="c1">; EDX = contenido como dword (4 bytes)</span>
</span><span id="__span-75-4"><a id="__codelineno-75-4" name="__codelineno-75-4" href="#__codelineno-75-4"></a><span class="nf">mov</span><span class="w"> </span><span class="p">[</span><span class="no">rsp</span><span class="err">+</span><span class="mi">30</span><span class="p">],</span><span class="w"> </span><span class="no">edx</span><span class="w">           </span><span class="c1">; x = EDX</span>
</span></code></pre></div>
<p><strong>Para reversing:</strong> El assembly es igual, pero en el código decompilado verás muchos casts.</p>
<hr />
<h2 id="parte-8-puntero-a-puntero-double-pointer">Parte 8: Puntero a Puntero (double pointer)<a class="headerlink" href="#parte-8-puntero-a-puntero-double-pointer" title="Permanent link">&para;</a></h2>
<h3 id="concepto_1">Concepto<a class="headerlink" href="#concepto_1" title="Permanent link">&para;</a></h3>
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-76-1"><a id="__codelineno-76-1" name="__codelineno-76-1" href="#__codelineno-76-1"></a><span class="kt">int</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">5</span><span class="p">;</span>
</span><span id="__span-76-2"><a id="__codelineno-76-2" name="__codelineno-76-2" href="#__codelineno-76-2"></a><span class="kt">int</span><span class="o">*</span><span class="w"> </span><span class="n">pa</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="n">a</span><span class="p">;</span><span class="w">       </span><span class="c1">// Puntero a int</span>
</span><span id="__span-76-3"><a id="__codelineno-76-3" name="__codelineno-76-3" href="#__codelineno-76-3"></a><span class="kt">int</span><span class="o">**</span><span class="w"> </span><span class="n">ppa</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="n">pa</span><span class="p">;</span><span class="w">    </span><span class="c1">// Puntero a puntero a int</span>
</span></code></pre></div>
<p><strong>Estructura de memoria:</strong></p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-77-1"><a id="__codelineno-77-1" name="__codelineno-77-1" href="#__codelineno-77-1"></a>a       en 0x1000, valor = 5
</span><span id="__span-77-2"><a id="__codelineno-77-2" name="__codelineno-77-2" href="#__codelineno-77-2"></a>pa      en 0x2000, valor = 0x1000 (dirección de a)
</span><span id="__span-77-3"><a id="__codelineno-77-3" name="__codelineno-77-3" href="#__codelineno-77-3"></a>ppa     en 0x3000, valor = 0x2000 (dirección de pa)
</span></code></pre></div>
<h3 id="desreferenciacion">Desreferenciación<a class="headerlink" href="#desreferenciacion" title="Permanent link">&para;</a></h3>
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-78-1"><a id="__codelineno-78-1" name="__codelineno-78-1" href="#__codelineno-78-1"></a><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">**</span><span class="n">ppa</span><span class="p">;</span><span class="w">      </span><span class="c1">// x = 5</span>
</span><span id="__span-78-2"><a id="__codelineno-78-2" name="__codelineno-78-2" href="#__codelineno-78-2"></a><span class="w">                    </span><span class="c1">// *ppa = pa (dirección de a)</span>
</span><span id="__span-78-3"><a id="__codelineno-78-3" name="__codelineno-78-3" href="#__codelineno-78-3"></a><span class="w">                    </span><span class="c1">// **ppa = *pa = a = 5</span>
</span></code></pre></div>
<p><strong>En ensamblador:</strong></p>
<div class="language-asm highlight"><pre><span></span><code><span id="__span-79-1"><a id="__codelineno-79-1" name="__codelineno-79-1" href="#__codelineno-79-1"></a><span class="nf">mov</span><span class="w"> </span><span class="no">rax</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="no">rsp</span><span class="err">+</span><span class="mi">40</span><span class="p">]</span><span class="w">   </span><span class="c1">; RAX = ppa (dirección de pa)</span>
</span><span id="__span-79-2"><a id="__codelineno-79-2" name="__codelineno-79-2" href="#__codelineno-79-2"></a><span class="nf">mov</span><span class="w"> </span><span class="no">rax</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="no">rax</span><span class="p">]</span><span class="w">      </span><span class="c1">; RAX = pa (dirección de a)</span>
</span><span id="__span-79-3"><a id="__codelineno-79-3" name="__codelineno-79-3" href="#__codelineno-79-3"></a><span class="nf">mov</span><span class="w"> </span><span class="no">eax</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="no">rax</span><span class="p">]</span><span class="w">      </span><span class="c1">; EAX = a (valor 5)</span>
</span></code></pre></div>
<h3 id="asignacion">Asignación<a class="headerlink" href="#asignacion" title="Permanent link">&para;</a></h3>
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-80-1"><a id="__codelineno-80-1" name="__codelineno-80-1" href="#__codelineno-80-1"></a><span class="o">**</span><span class="n">ppa</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">10</span><span class="p">;</span><span class="w">         </span><span class="c1">// Asignar 10 a a a través de ppa</span>
</span></code></pre></div>
<p><strong>En ensamblador:</strong></p>
<div class="language-asm highlight"><pre><span></span><code><span id="__span-81-1"><a id="__codelineno-81-1" name="__codelineno-81-1" href="#__codelineno-81-1"></a><span class="nf">mov</span><span class="w"> </span><span class="no">rax</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="no">rsp</span><span class="err">+</span><span class="mi">40</span><span class="p">]</span><span class="w">           </span><span class="c1">; RAX = ppa</span>
</span><span id="__span-81-2"><a id="__codelineno-81-2" name="__codelineno-81-2" href="#__codelineno-81-2"></a><span class="nf">mov</span><span class="w"> </span><span class="no">rax</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="no">rax</span><span class="p">]</span><span class="w">              </span><span class="c1">; RAX = pa</span>
</span><span id="__span-81-3"><a id="__codelineno-81-3" name="__codelineno-81-3" href="#__codelineno-81-3"></a><span class="nf">mov</span><span class="w"> </span><span class="no">dword</span><span class="w"> </span><span class="no">ptr</span><span class="w"> </span><span class="p">[</span><span class="no">rax</span><span class="p">],</span><span class="w"> </span><span class="mi">10</span><span class="w">     </span><span class="c1">; *pa = 10</span>
</span></code></pre></div>
<hr />
<h2 id="parte-9-punteros-y-arrays">Parte 9: Punteros y Arrays<a class="headerlink" href="#parte-9-punteros-y-arrays" title="Permanent link">&para;</a></h2>
<h3 id="array-como-puntero">Array como Puntero<a class="headerlink" href="#array-como-puntero" title="Permanent link">&para;</a></h3>
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-82-1"><a id="__codelineno-82-1" name="__codelineno-82-1" href="#__codelineno-82-1"></a><span class="kt">int</span><span class="w"> </span><span class="n">arr</span><span class="p">[</span><span class="mi">10</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">};</span>
</span><span id="__span-82-2"><a id="__codelineno-82-2" name="__codelineno-82-2" href="#__codelineno-82-2"></a><span class="kt">int</span><span class="o">*</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">arr</span><span class="p">;</span><span class="w">       </span><span class="c1">// p apunta al primer elemento</span>
</span><span id="__span-82-3"><a id="__codelineno-82-3" name="__codelineno-82-3" href="#__codelineno-82-3"></a>
</span><span id="__span-82-4"><a id="__codelineno-82-4" name="__codelineno-82-4" href="#__codelineno-82-4"></a><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">endl</span><span class="p">;</span><span class="w">   </span><span class="c1">// 1</span>
</span><span id="__span-82-5"><a id="__codelineno-82-5" name="__codelineno-82-5" href="#__codelineno-82-5"></a><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">endl</span><span class="p">;</span><span class="w">   </span><span class="c1">// 2</span>
</span><span id="__span-82-6"><a id="__codelineno-82-6" name="__codelineno-82-6" href="#__codelineno-82-6"></a><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="o">*</span><span class="p">(</span><span class="n">p</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">endl</span><span class="p">;</span><span class="w"> </span><span class="c1">// 3</span>
</span></code></pre></div>
<p><strong>En ensamblador:</strong></p>
<div class="language-asm highlight"><pre><span></span><code><span id="__span-83-1"><a id="__codelineno-83-1" name="__codelineno-83-1" href="#__codelineno-83-1"></a><span class="nf">lea</span><span class="w"> </span><span class="no">rax</span><span class="p">,</span><span class="w"> </span><span class="no">arr</span><span class="w">            </span><span class="c1">; RAX = dirección de arr[0]</span>
</span><span id="__span-83-2"><a id="__codelineno-83-2" name="__codelineno-83-2" href="#__codelineno-83-2"></a>
</span><span id="__span-83-3"><a id="__codelineno-83-3" name="__codelineno-83-3" href="#__codelineno-83-3"></a><span class="nf">mov</span><span class="w"> </span><span class="no">edx</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="no">rax</span><span class="p">]</span><span class="w">          </span><span class="c1">; p[0] = EDX = 1</span>
</span><span id="__span-83-4"><a id="__codelineno-83-4" name="__codelineno-83-4" href="#__codelineno-83-4"></a><span class="nf">mov</span><span class="w"> </span><span class="no">edx</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="no">rax</span><span class="err">+</span><span class="mi">4</span><span class="p">]</span><span class="w">        </span><span class="c1">; p[1] = EDX = 2</span>
</span><span id="__span-83-5"><a id="__codelineno-83-5" name="__codelineno-83-5" href="#__codelineno-83-5"></a><span class="nf">mov</span><span class="w"> </span><span class="no">edx</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="no">rax</span><span class="err">+</span><span class="mi">8</span><span class="p">]</span><span class="w">        </span><span class="c1">; p[2] = EDX = 3</span>
</span></code></pre></div>
<h3 id="iteracion-con-punteros">Iteración con Punteros<a class="headerlink" href="#iteracion-con-punteros" title="Permanent link">&para;</a></h3>
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-84-1"><a id="__codelineno-84-1" name="__codelineno-84-1" href="#__codelineno-84-1"></a><span class="kt">int</span><span class="w"> </span><span class="n">arr</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="mi">20</span><span class="p">,</span><span class="w"> </span><span class="mi">30</span><span class="p">,</span><span class="w"> </span><span class="mi">40</span><span class="p">,</span><span class="w"> </span><span class="mi">50</span><span class="p">};</span>
</span><span id="__span-84-2"><a id="__codelineno-84-2" name="__codelineno-84-2" href="#__codelineno-84-2"></a>
</span><span id="__span-84-3"><a id="__codelineno-84-3" name="__codelineno-84-3" href="#__codelineno-84-3"></a><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="o">*</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">arr</span><span class="p">;</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">arr</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">5</span><span class="p">;</span><span class="w"> </span><span class="n">p</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-84-4"><a id="__codelineno-84-4" name="__codelineno-84-4" href="#__codelineno-84-4"></a><span class="w">    </span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="o">*</span><span class="n">p</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">endl</span><span class="p">;</span>
</span><span id="__span-84-5"><a id="__codelineno-84-5" name="__codelineno-84-5" href="#__codelineno-84-5"></a><span class="p">}</span>
</span></code></pre></div>
<p><strong>En ensamblador:</strong></p>
<div class="language-asm highlight"><pre><span></span><code><span id="__span-85-1"><a id="__codelineno-85-1" name="__codelineno-85-1" href="#__codelineno-85-1"></a><span class="nf">lea</span><span class="w"> </span><span class="no">rax</span><span class="p">,</span><span class="w"> </span><span class="no">arr</span><span class="w">                </span><span class="c1">; p = arr</span>
</span><span id="__span-85-2"><a id="__codelineno-85-2" name="__codelineno-85-2" href="#__codelineno-85-2"></a><span class="nf">lea</span><span class="w"> </span><span class="no">rbx</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="no">arr</span><span class="err">+</span><span class="mi">20</span><span class="p">]</span><span class="w">           </span><span class="c1">; rbx = arr + 5 (5 elementos * 4 bytes)</span>
</span><span id="__span-85-3"><a id="__codelineno-85-3" name="__codelineno-85-3" href="#__codelineno-85-3"></a>
</span><span id="__span-85-4"><a id="__codelineno-85-4" name="__codelineno-85-4" href="#__codelineno-85-4"></a><span class="nl">loop_start:</span>
</span><span id="__span-85-5"><a id="__codelineno-85-5" name="__codelineno-85-5" href="#__codelineno-85-5"></a><span class="w">    </span><span class="nf">cmp</span><span class="w"> </span><span class="no">rax</span><span class="p">,</span><span class="w"> </span><span class="no">rbx</span><span class="w">            </span><span class="c1">; if (p &lt; arr+5)</span>
</span><span id="__span-85-6"><a id="__codelineno-85-6" name="__codelineno-85-6" href="#__codelineno-85-6"></a><span class="w">    </span><span class="nf">jge</span><span class="w"> </span><span class="no">loop_end</span>
</span><span id="__span-85-7"><a id="__codelineno-85-7" name="__codelineno-85-7" href="#__codelineno-85-7"></a>
</span><span id="__span-85-8"><a id="__codelineno-85-8" name="__codelineno-85-8" href="#__codelineno-85-8"></a><span class="w">    </span><span class="nf">mov</span><span class="w"> </span><span class="no">edx</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="no">rax</span><span class="p">]</span><span class="w">          </span><span class="c1">; EDX = *p</span>
</span><span id="__span-85-9"><a id="__codelineno-85-9" name="__codelineno-85-9" href="#__codelineno-85-9"></a><span class="w">    </span><span class="c1">; ... usar EDX ...</span>
</span><span id="__span-85-10"><a id="__codelineno-85-10" name="__codelineno-85-10" href="#__codelineno-85-10"></a>
</span><span id="__span-85-11"><a id="__codelineno-85-11" name="__codelineno-85-11" href="#__codelineno-85-11"></a><span class="w">    </span><span class="nf">add</span><span class="w"> </span><span class="no">rax</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="w">              </span><span class="c1">; p++ (siguiente elemento)</span>
</span><span id="__span-85-12"><a id="__codelineno-85-12" name="__codelineno-85-12" href="#__codelineno-85-12"></a><span class="w">    </span><span class="nf">jmp</span><span class="w"> </span><span class="no">loop_start</span>
</span><span id="__span-85-13"><a id="__codelineno-85-13" name="__codelineno-85-13" href="#__codelineno-85-13"></a>
</span><span id="__span-85-14"><a id="__codelineno-85-14" name="__codelineno-85-14" href="#__codelineno-85-14"></a><span class="nl">loop_end:</span>
</span></code></pre></div>
<hr />
<h2 id="parte-95-array-bidimensional-vs-array-de-punteros">Parte 9.5: Array Bidimensional vs Array de Punteros<a class="headerlink" href="#parte-95-array-bidimensional-vs-array-de-punteros" title="Permanent link">&para;</a></h2>
<p>Esta es una diferencia <strong>crítica</strong> que confunde a muchos:</p>
<h3 id="el-codigo-de-ejemplo">El Código de Ejemplo<a class="headerlink" href="#el-codigo-de-ejemplo" title="Permanent link">&para;</a></h3>
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-86-1"><a id="__codelineno-86-1" name="__codelineno-86-1" href="#__codelineno-86-1"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span>
</span><span id="__span-86-2"><a id="__codelineno-86-2" name="__codelineno-86-2" href="#__codelineno-86-2"></a><span class="k">using</span><span class="w"> </span><span class="k">namespace</span><span class="w"> </span><span class="nn">std</span><span class="p">;</span>
</span><span id="__span-86-3"><a id="__codelineno-86-3" name="__codelineno-86-3" href="#__codelineno-86-3"></a>
</span><span id="__span-86-4"><a id="__codelineno-86-4" name="__codelineno-86-4" href="#__codelineno-86-4"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-86-5"><a id="__codelineno-86-5" name="__codelineno-86-5" href="#__codelineno-86-5"></a><span class="w">    </span><span class="c1">// Array BIDIMENSIONAL (todo el contenido en el stack)</span>
</span><span id="__span-86-6"><a id="__codelineno-86-6" name="__codelineno-86-6" href="#__codelineno-86-6"></a><span class="w">    </span><span class="kt">char</span><span class="w"> </span><span class="n">Mes</span><span class="p">[][</span><span class="mi">11</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="s">&quot;Enero&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Febrero&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Marzo&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Abril&quot;</span><span class="p">,</span>
</span><span id="__span-86-7"><a id="__codelineno-86-7" name="__codelineno-86-7" href="#__codelineno-86-7"></a><span class="w">       </span><span class="s">&quot;Mayo&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Junio&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Julio&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Agosto&quot;</span><span class="p">,</span>
</span><span id="__span-86-8"><a id="__codelineno-86-8" name="__codelineno-86-8" href="#__codelineno-86-8"></a><span class="w">       </span><span class="s">&quot;Septiembre&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Octubre&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Noviembre&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Diciembre&quot;</span><span class="w"> </span><span class="p">};</span>
</span><span id="__span-86-9"><a id="__codelineno-86-9" name="__codelineno-86-9" href="#__codelineno-86-9"></a>
</span><span id="__span-86-10"><a id="__codelineno-86-10" name="__codelineno-86-10" href="#__codelineno-86-10"></a><span class="w">    </span><span class="c1">// Array de PUNTEROS (solo las direcciones en el stack)</span>
</span><span id="__span-86-11"><a id="__codelineno-86-11" name="__codelineno-86-11" href="#__codelineno-86-11"></a><span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">Mes2</span><span class="p">[]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="s">&quot;Enero&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Febrero&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Marzo&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Abril&quot;</span><span class="p">,</span>
</span><span id="__span-86-12"><a id="__codelineno-86-12" name="__codelineno-86-12" href="#__codelineno-86-12"></a><span class="w">       </span><span class="s">&quot;Mayo&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Junio&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Julio&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Agosto&quot;</span><span class="p">,</span>
</span><span id="__span-86-13"><a id="__codelineno-86-13" name="__codelineno-86-13" href="#__codelineno-86-13"></a><span class="w">       </span><span class="s">&quot;Septiembre&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Octubre&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Noviembre&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Diciembre&quot;</span><span class="w"> </span><span class="p">};</span>
</span><span id="__span-86-14"><a id="__codelineno-86-14" name="__codelineno-86-14" href="#__codelineno-86-14"></a>
</span><span id="__span-86-15"><a id="__codelineno-86-15" name="__codelineno-86-15" href="#__codelineno-86-15"></a><span class="w">    </span><span class="c1">// Acceso a caracteres</span>
</span><span id="__span-86-16"><a id="__codelineno-86-16" name="__codelineno-86-16" href="#__codelineno-86-16"></a><span class="w">    </span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">Mes</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">endl</span><span class="p">;</span><span class="w">      </span><span class="c1">// &#39;E&#39; (Enero)</span>
</span><span id="__span-86-17"><a id="__codelineno-86-17" name="__codelineno-86-17" href="#__codelineno-86-17"></a><span class="w">    </span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">Mes</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">endl</span><span class="p">;</span><span class="w">      </span><span class="c1">// &#39;n&#39; (Enero)</span>
</span><span id="__span-86-18"><a id="__codelineno-86-18" name="__codelineno-86-18" href="#__codelineno-86-18"></a><span class="w">    </span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">Mes</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">endl</span><span class="p">;</span><span class="w">      </span><span class="c1">// &#39;F&#39; (Febrero)</span>
</span><span id="__span-86-19"><a id="__codelineno-86-19" name="__codelineno-86-19" href="#__codelineno-86-19"></a><span class="w">    </span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">Mes</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">endl</span><span class="p">;</span><span class="w">      </span><span class="c1">// &#39;e&#39; (Febrero)</span>
</span><span id="__span-86-20"><a id="__codelineno-86-20" name="__codelineno-86-20" href="#__codelineno-86-20"></a>
</span><span id="__span-86-21"><a id="__codelineno-86-21" name="__codelineno-86-21" href="#__codelineno-86-21"></a><span class="w">    </span><span class="c1">// Array de punteros</span>
</span><span id="__span-86-22"><a id="__codelineno-86-22" name="__codelineno-86-22" href="#__codelineno-86-22"></a><span class="w">    </span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">Mes2</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">endl</span><span class="p">;</span><span class="w">           </span><span class="c1">// Dirección del array</span>
</span><span id="__span-86-23"><a id="__codelineno-86-23" name="__codelineno-86-23" href="#__codelineno-86-23"></a><span class="w">    </span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">Mes2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">endl</span><span class="p">;</span><span class="w">        </span><span class="c1">// &quot;Enero&quot; (imprime el string)</span>
</span><span id="__span-86-24"><a id="__codelineno-86-24" name="__codelineno-86-24" href="#__codelineno-86-24"></a><span class="w">    </span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">Mes2</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">endl</span><span class="p">;</span><span class="w">        </span><span class="c1">// &quot;Febrero&quot;</span>
</span><span id="__span-86-25"><a id="__codelineno-86-25" name="__codelineno-86-25" href="#__codelineno-86-25"></a>
</span><span id="__span-86-26"><a id="__codelineno-86-26" name="__codelineno-86-26" href="#__codelineno-86-26"></a><span class="w">    </span><span class="c1">// Incrementar puntero dentro del array</span>
</span><span id="__span-86-27"><a id="__codelineno-86-27" name="__codelineno-86-27" href="#__codelineno-86-27"></a><span class="w">    </span><span class="n">Mes2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">++</span><span class="p">;</span><span class="w">                      </span><span class="c1">// Ahora apunta a &quot;nero&quot;</span>
</span><span id="__span-86-28"><a id="__codelineno-86-28" name="__codelineno-86-28" href="#__codelineno-86-28"></a><span class="w">    </span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">Mes2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">endl</span><span class="p">;</span><span class="w">        </span><span class="c1">// &quot;nero&quot;</span>
</span><span id="__span-86-29"><a id="__codelineno-86-29" name="__codelineno-86-29" href="#__codelineno-86-29"></a>
</span><span id="__span-86-30"><a id="__codelineno-86-30" name="__codelineno-86-30" href="#__codelineno-86-30"></a><span class="w">    </span><span class="c1">// Tamaños</span>
</span><span id="__span-86-31"><a id="__codelineno-86-31" name="__codelineno-86-31" href="#__codelineno-86-31"></a><span class="w">    </span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">Mes</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">endl</span><span class="p">;</span><span class="w">    </span><span class="c1">// 12 * 11 = 132</span>
</span><span id="__span-86-32"><a id="__codelineno-86-32" name="__codelineno-86-32" href="#__codelineno-86-32"></a><span class="w">    </span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">Mes2</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">endl</span><span class="p">;</span><span class="w">   </span><span class="c1">// 12 * 8 = 96 (punteros de 64 bits)</span>
</span><span id="__span-86-33"><a id="__codelineno-86-33" name="__codelineno-86-33" href="#__codelineno-86-33"></a>
</span><span id="__span-86-34"><a id="__codelineno-86-34" name="__codelineno-86-34" href="#__codelineno-86-34"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
</span><span id="__span-86-35"><a id="__codelineno-86-35" name="__codelineno-86-35" href="#__codelineno-86-35"></a><span class="p">}</span>
</span></code></pre></div>
<h3 id="diferencia-fundamental-en-memoria">Diferencia Fundamental en Memoria<a class="headerlink" href="#diferencia-fundamental-en-memoria" title="Permanent link">&para;</a></h3>
<h4 id="array-bidimensional-mes11">Array Bidimensional (<code>Mes[][11]</code>)<a class="headerlink" href="#array-bidimensional-mes11" title="Permanent link">&para;</a></h4>
<div class="language-text highlight"><pre><span></span><code><span id="__span-87-1"><a id="__codelineno-87-1" name="__codelineno-87-1" href="#__codelineno-87-1"></a>Layout en el STACK:
</span><span id="__span-87-2"><a id="__codelineno-87-2" name="__codelineno-87-2" href="#__codelineno-87-2"></a>┌────────────────────────────────────────┐
</span><span id="__span-87-3"><a id="__codelineno-87-3" name="__codelineno-87-3" href="#__codelineno-87-3"></a>│ &quot;Enero\0\0\0\0\0\0&quot;     (11 bytes)     │ ← Mes[0]
</span><span id="__span-87-4"><a id="__codelineno-87-4" name="__codelineno-87-4" href="#__codelineno-87-4"></a>├────────────────────────────────────────┤
</span><span id="__span-87-5"><a id="__codelineno-87-5" name="__codelineno-87-5" href="#__codelineno-87-5"></a>│ &quot;Febrero\0\0\0\0&quot;       (11 bytes)     │ ← Mes[1]
</span><span id="__span-87-6"><a id="__codelineno-87-6" name="__codelineno-87-6" href="#__codelineno-87-6"></a>├────────────────────────────────────────┤
</span><span id="__span-87-7"><a id="__codelineno-87-7" name="__codelineno-87-7" href="#__codelineno-87-7"></a>│ &quot;Marzo\0\0\0\0\0\0&quot;     (11 bytes)     │ ← Mes[2]
</span><span id="__span-87-8"><a id="__codelineno-87-8" name="__codelineno-87-8" href="#__codelineno-87-8"></a>├────────────────────────────────────────┤
</span><span id="__span-87-9"><a id="__codelineno-87-9" name="__codelineno-87-9" href="#__codelineno-87-9"></a>│ ...                                    │
</span><span id="__span-87-10"><a id="__codelineno-87-10" name="__codelineno-87-10" href="#__codelineno-87-10"></a>├────────────────────────────────────────┤
</span><span id="__span-87-11"><a id="__codelineno-87-11" name="__codelineno-87-11" href="#__codelineno-87-11"></a>│ &quot;Diciembre\0\0&quot;         (11 bytes)     │ ← Mes[11]
</span><span id="__span-87-12"><a id="__codelineno-87-12" name="__codelineno-87-12" href="#__codelineno-87-12"></a>└────────────────────────────────────────┘
</span><span id="__span-87-13"><a id="__codelineno-87-13" name="__codelineno-87-13" href="#__codelineno-87-13"></a>Total: 12 strings × 11 bytes = 132 bytes en stack
</span></code></pre></div>
<p><strong>Características:</strong>
- Todo el contenido está <strong>contiguo en el stack</strong>
- Cada string ocupa <strong>exactamente 11 bytes</strong> (se completa con <code>\0</code>)
- El 11 es por el string más largo: "Septiembre" (10 chars + <code>\0</code>)
- <strong>No se puede incrementar</strong> <code>Mes</code> (es una dirección fija)</p>
<h4 id="array-de-punteros-const-char-mes2">Array de Punteros (<code>const char* Mes2[]</code>)<a class="headerlink" href="#array-de-punteros-const-char-mes2" title="Permanent link">&para;</a></h4>
<div class="language-text highlight"><pre><span></span><code><span id="__span-88-1"><a id="__codelineno-88-1" name="__codelineno-88-1" href="#__codelineno-88-1"></a>Layout en el STACK (solo punteros):
</span><span id="__span-88-2"><a id="__codelineno-88-2" name="__codelineno-88-2" href="#__codelineno-88-2"></a>┌─────────────────────────────────────────────────┐
</span><span id="__span-88-3"><a id="__codelineno-88-3" name="__codelineno-88-3" href="#__codelineno-88-3"></a>│ 0x7FF...54  (puntero a &quot;Enero&quot; en .data)        │ ← Mes2[0]
</span><span id="__span-88-4"><a id="__codelineno-88-4" name="__codelineno-88-4" href="#__codelineno-88-4"></a>├─────────────────────────────────────────────────┤
</span><span id="__span-88-5"><a id="__codelineno-88-5" name="__codelineno-88-5" href="#__codelineno-88-5"></a>│ 0x7FF...5A  (puntero a &quot;Febrero&quot; en .data)      │ ← Mes2[1]
</span><span id="__span-88-6"><a id="__codelineno-88-6" name="__codelineno-88-6" href="#__codelineno-88-6"></a>├─────────────────────────────────────────────────┤
</span><span id="__span-88-7"><a id="__codelineno-88-7" name="__codelineno-88-7" href="#__codelineno-88-7"></a>│ 0x7FF...62  (puntero a &quot;Marzo&quot; en .data)        │ ← Mes2[2]
</span><span id="__span-88-8"><a id="__codelineno-88-8" name="__codelineno-88-8" href="#__codelineno-88-8"></a>├─────────────────────────────────────────────────┤
</span><span id="__span-88-9"><a id="__codelineno-88-9" name="__codelineno-88-9" href="#__codelineno-88-9"></a>│ ...                                             │
</span><span id="__span-88-10"><a id="__codelineno-88-10" name="__codelineno-88-10" href="#__codelineno-88-10"></a>└─────────────────────────────────────────────────┘
</span><span id="__span-88-11"><a id="__codelineno-88-11" name="__codelineno-88-11" href="#__codelineno-88-11"></a>Total: 12 punteros × 8 bytes = 96 bytes en stack
</span><span id="__span-88-12"><a id="__codelineno-88-12" name="__codelineno-88-12" href="#__codelineno-88-12"></a>
</span><span id="__span-88-13"><a id="__codelineno-88-13" name="__codelineno-88-13" href="#__codelineno-88-13"></a>Los STRINGS están en la sección .data:
</span><span id="__span-88-14"><a id="__codelineno-88-14" name="__codelineno-88-14" href="#__codelineno-88-14"></a>.data:
</span><span id="__span-88-15"><a id="__codelineno-88-15" name="__codelineno-88-15" href="#__codelineno-88-15"></a>0x7FF...54: &quot;Enero\0&quot;
</span><span id="__span-88-16"><a id="__codelineno-88-16" name="__codelineno-88-16" href="#__codelineno-88-16"></a>0x7FF...5A: &quot;Febrero\0&quot;
</span><span id="__span-88-17"><a id="__codelineno-88-17" name="__codelineno-88-17" href="#__codelineno-88-17"></a>0x7FF...62: &quot;Marzo\0&quot;
</span><span id="__span-88-18"><a id="__codelineno-88-18" name="__codelineno-88-18" href="#__codelineno-88-18"></a>...
</span></code></pre></div>
<p><strong>Características:</strong>
- Solo <strong>direcciones</strong> en el stack (8 bytes cada una en x64)
- Los strings reales están en la <strong>sección .data</strong>
- <strong>Sí se puede incrementar</strong> cada puntero individual
- Ocupa menos espacio en stack (96 vs 132 bytes)</p>
<h3 id="comparacion-de-tamanos">Comparación de Tamaños<a class="headerlink" href="#comparacion-de-tamanos" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Tipo</th>
<th>Cálculo</th>
<th>Tamaño Total</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>char Mes[][11]</code></td>
<td>12 strings × 11 chars</td>
<td>132 bytes</td>
</tr>
<tr>
<td><code>const char* Mes2[]</code></td>
<td>12 punteros × 8 bytes</td>
<td>96 bytes</td>
</tr>
</tbody>
</table>
<h3 id="acceso-a-caracteres-individuales">Acceso a Caracteres Individuales<a class="headerlink" href="#acceso-a-caracteres-individuales" title="Permanent link">&para;</a></h3>
<p><strong>Array bidimensional:</strong></p>
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-89-1"><a id="__codelineno-89-1" name="__codelineno-89-1" href="#__codelineno-89-1"></a><span class="n">Mes</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="w">   </span><span class="c1">// &#39;E&#39; - primer carácter de &quot;Enero&quot;</span>
</span><span id="__span-89-2"><a id="__codelineno-89-2" name="__codelineno-89-2" href="#__codelineno-89-2"></a><span class="n">Mes</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="w">   </span><span class="c1">// &#39;n&#39; - segundo carácter de &quot;Enero&quot;</span>
</span><span id="__span-89-3"><a id="__codelineno-89-3" name="__codelineno-89-3" href="#__codelineno-89-3"></a><span class="n">Mes</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="w">   </span><span class="c1">// &#39;F&#39; - primer carácter de &quot;Febrero&quot;</span>
</span></code></pre></div>
<p><strong>En ensamblador:</strong></p>
<div class="language-asm highlight"><pre><span></span><code><span id="__span-90-1"><a id="__codelineno-90-1" name="__codelineno-90-1" href="#__codelineno-90-1"></a><span class="c1">; Mes[0][0] - calcular: (0 * 11) + 0 = 0</span>
</span><span id="__span-90-2"><a id="__codelineno-90-2" name="__codelineno-90-2" href="#__codelineno-90-2"></a><span class="nf">imul</span><span class="w"> </span><span class="no">eax</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="no">Bh</span><span class="w">           </span><span class="c1">; EAX = primer_indice × 11</span>
</span><span id="__span-90-3"><a id="__codelineno-90-3" name="__codelineno-90-3" href="#__codelineno-90-3"></a><span class="nf">add</span><span class="w"> </span><span class="no">eax</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="w">              </span><span class="c1">; Sumar segundo índice</span>
</span><span id="__span-90-4"><a id="__codelineno-90-4" name="__codelineno-90-4" href="#__codelineno-90-4"></a><span class="nf">lea</span><span class="w"> </span><span class="no">rcx</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="no">rsp</span><span class="err">+</span><span class="no">Mes</span><span class="p">]</span><span class="w">      </span><span class="c1">; RCX = dirección base</span>
</span><span id="__span-90-5"><a id="__codelineno-90-5" name="__codelineno-90-5" href="#__codelineno-90-5"></a><span class="nf">movzx</span><span class="w"> </span><span class="no">edx</span><span class="p">,</span><span class="w"> </span><span class="no">byte</span><span class="w"> </span><span class="no">ptr</span><span class="w"> </span><span class="p">[</span><span class="no">rcx</span><span class="err">+</span><span class="no">rax</span><span class="p">]</span><span class="w">  </span><span class="c1">; EDX = caracter</span>
</span></code></pre></div>
<p><strong>Array de punteros:</strong></p>
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-91-1"><a id="__codelineno-91-1" name="__codelineno-91-1" href="#__codelineno-91-1"></a><span class="n">Mes2</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="w">  </span><span class="c1">// &#39;E&#39; - primer carácter del string apuntado por Mes2[0]</span>
</span><span id="__span-91-2"><a id="__codelineno-91-2" name="__codelineno-91-2" href="#__codelineno-91-2"></a><span class="n">Mes2</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="w">  </span><span class="c1">// &#39;n&#39;</span>
</span><span id="__span-91-3"><a id="__codelineno-91-3" name="__codelineno-91-3" href="#__codelineno-91-3"></a><span class="n">Mes2</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="w">  </span><span class="c1">// &#39;F&#39;</span>
</span></code></pre></div>
<p><strong>En ensamblador:</strong></p>
<div class="language-asm highlight"><pre><span></span><code><span id="__span-92-1"><a id="__codelineno-92-1" name="__codelineno-92-1" href="#__codelineno-92-1"></a><span class="c1">; Mes2[0][1] - dos desreferencias</span>
</span><span id="__span-92-2"><a id="__codelineno-92-2" name="__codelineno-92-2" href="#__codelineno-92-2"></a><span class="nf">imul</span><span class="w"> </span><span class="no">eax</span><span class="p">,</span><span class="w"> </span><span class="mi">8</span><span class="w">             </span><span class="c1">; EAX = primer_indice × 8 (tamaño de puntero)</span>
</span><span id="__span-92-3"><a id="__codelineno-92-3" name="__codelineno-92-3" href="#__codelineno-92-3"></a><span class="nf">lea</span><span class="w"> </span><span class="no">rcx</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="no">rsp</span><span class="err">+</span><span class="no">Mes2</span><span class="p">]</span><span class="w">     </span><span class="c1">; RCX = dirección base del array de punteros</span>
</span><span id="__span-92-4"><a id="__codelineno-92-4" name="__codelineno-92-4" href="#__codelineno-92-4"></a><span class="nf">mov</span><span class="w"> </span><span class="no">rax</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="no">rcx</span><span class="err">+</span><span class="no">rax</span><span class="p">]</span><span class="w">      </span><span class="c1">; RAX = Mes2[0] (el puntero al string)</span>
</span><span id="__span-92-5"><a id="__codelineno-92-5" name="__codelineno-92-5" href="#__codelineno-92-5"></a><span class="nf">movzx</span><span class="w"> </span><span class="no">edx</span><span class="p">,</span><span class="w"> </span><span class="no">byte</span><span class="w"> </span><span class="no">ptr</span><span class="w"> </span><span class="p">[</span><span class="no">rax</span><span class="err">+</span><span class="mi">1</span><span class="p">]</span><span class="w">  </span><span class="c1">; EDX = segundo carácter del string</span>
</span></code></pre></div>
<h3 id="incrementar-punteros-en-el-array">Incrementar Punteros en el Array<a class="headerlink" href="#incrementar-punteros-en-el-array" title="Permanent link">&para;</a></h3>
<p><strong>Array bidimensional (ILEGAL):</strong></p>
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-93-1"><a id="__codelineno-93-1" name="__codelineno-93-1" href="#__codelineno-93-1"></a><span class="n">Mes</span><span class="o">++</span><span class="p">;</span><span class="w">      </span><span class="c1">// ❌ ERROR: Mes es una dirección constante</span>
</span><span id="__span-93-2"><a id="__codelineno-93-2" name="__codelineno-93-2" href="#__codelineno-93-2"></a><span class="n">Mes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">++</span><span class="p">;</span><span class="w">   </span><span class="c1">// ❌ ERROR: Mes[0] tampoco se puede incrementar</span>
</span></code></pre></div>
<p><strong>Array de punteros (VÁLIDO):</strong></p>
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-94-1"><a id="__codelineno-94-1" name="__codelineno-94-1" href="#__codelineno-94-1"></a><span class="n">Mes2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">++</span><span class="p">;</span><span class="w">  </span><span class="c1">// ✅ VÁLIDO: Mes2[0] es un puntero modificable</span>
</span><span id="__span-94-2"><a id="__codelineno-94-2" name="__codelineno-94-2" href="#__codelineno-94-2"></a><span class="c1">// Antes: Mes2[0] → &quot;Enero&quot;</span>
</span><span id="__span-94-3"><a id="__codelineno-94-3" name="__codelineno-94-3" href="#__codelineno-94-3"></a><span class="c1">// Después: Mes2[0] → &quot;nero&quot;</span>
</span></code></pre></div>
<p><strong>En ensamblador (incremento de Mes2[0]):</strong></p>
<div class="language-asm highlight"><pre><span></span><code><span id="__span-95-1"><a id="__codelineno-95-1" name="__codelineno-95-1" href="#__codelineno-95-1"></a><span class="c1">; Mes2[0]++</span>
</span><span id="__span-95-2"><a id="__codelineno-95-2" name="__codelineno-95-2" href="#__codelineno-95-2"></a><span class="nf">lea</span><span class="w"> </span><span class="no">rax</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="no">rsp</span><span class="err">+</span><span class="no">Mes2</span><span class="p">]</span><span class="w">     </span><span class="c1">; RAX = dirección del array</span>
</span><span id="__span-95-3"><a id="__codelineno-95-3" name="__codelineno-95-3" href="#__codelineno-95-3"></a><span class="nf">mov</span><span class="w"> </span><span class="no">rcx</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="no">rax</span><span class="p">]</span><span class="w">          </span><span class="c1">; RCX = Mes2[0] (puntero actual a &quot;Enero&quot;)</span>
</span><span id="__span-95-4"><a id="__codelineno-95-4" name="__codelineno-95-4" href="#__codelineno-95-4"></a><span class="nf">inc</span><span class="w"> </span><span class="no">rcx</span><span class="w">                 </span><span class="c1">; RCX++ (ahora apunta a &quot;nero&quot;)</span>
</span><span id="__span-95-5"><a id="__codelineno-95-5" name="__codelineno-95-5" href="#__codelineno-95-5"></a><span class="nf">mov</span><span class="w"> </span><span class="p">[</span><span class="no">rax</span><span class="p">],</span><span class="w"> </span><span class="no">rcx</span><span class="w">          </span><span class="c1">; Guardar de vuelta en Mes2[0]</span>
</span></code></pre></div>
<h3 id="impresion-con-cout">Impresión con cout<a class="headerlink" href="#impresion-con-cout" title="Permanent link">&para;</a></h3>
<p><strong>Imprimir un puntero vs un string:</strong></p>
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-96-1"><a id="__codelineno-96-1" name="__codelineno-96-1" href="#__codelineno-96-1"></a><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">Mes2</span><span class="p">;</span><span class="w">       </span><span class="c1">// Imprime la DIRECCIÓN del array (0x7FF...)</span>
</span><span id="__span-96-2"><a id="__codelineno-96-2" name="__codelineno-96-2" href="#__codelineno-96-2"></a><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">Mes2</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span><span class="w">    </span><span class="c1">// Imprime &quot;Enero&quot; (cout detecta char* y lo imprime como string)</span>
</span></code></pre></div>
<p><strong>En ensamblador:</strong></p>
<div class="language-asm highlight"><pre><span></span><code><span id="__span-97-1"><a id="__codelineno-97-1" name="__codelineno-97-1" href="#__codelineno-97-1"></a><span class="c1">; cout &lt;&lt; Mes2 (imprimir dirección)</span>
</span><span id="__span-97-2"><a id="__codelineno-97-2" name="__codelineno-97-2" href="#__codelineno-97-2"></a><span class="nf">lea</span><span class="w"> </span><span class="no">rdx</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="no">rsp</span><span class="err">+</span><span class="no">Mes2</span><span class="p">]</span><span class="w">         </span><span class="c1">; RDX = dirección del array</span>
</span><span id="__span-97-3"><a id="__codelineno-97-3" name="__codelineno-97-3" href="#__codelineno-97-3"></a><span class="nf">call</span><span class="w"> </span><span class="no">ostream</span><span class="p">::</span><span class="no">operator</span><span class="err">&lt;&lt;</span><span class="w">    </span><span class="c1">; Sobrecarga para void*</span>
</span><span id="__span-97-4"><a id="__codelineno-97-4" name="__codelineno-97-4" href="#__codelineno-97-4"></a>
</span><span id="__span-97-5"><a id="__codelineno-97-5" name="__codelineno-97-5" href="#__codelineno-97-5"></a><span class="c1">; cout &lt;&lt; Mes2[0] (imprimir string)</span>
</span><span id="__span-97-6"><a id="__codelineno-97-6" name="__codelineno-97-6" href="#__codelineno-97-6"></a><span class="nf">mov</span><span class="w"> </span><span class="no">rdx</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="no">rsp</span><span class="err">+</span><span class="no">Mes2</span><span class="p">]</span><span class="w">         </span><span class="c1">; RDX = Mes2[0] (puntero al string)</span>
</span><span id="__span-97-7"><a id="__codelineno-97-7" name="__codelineno-97-7" href="#__codelineno-97-7"></a><span class="nf">call</span><span class="w"> </span><span class="no">ostream</span><span class="p">::</span><span class="no">operator</span><span class="err">&lt;&lt;</span><span class="w">    </span><span class="c1">; Sobrecarga para char* (imprime string)</span>
</span></code></pre></div>
<h3 id="en-ida-pro-inicializacion">En IDA Pro: Inicialización<a class="headerlink" href="#en-ida-pro-inicializacion" title="Permanent link">&para;</a></h3>
<p><strong>Array bidimensional:</strong></p>
<p>IDA muestra la copia de strings al stack con <code>rep movsb</code> o movimientos directos:</p>
<div class="language-asm highlight"><pre><span></span><code><span id="__span-98-1"><a id="__codelineno-98-1" name="__codelineno-98-1" href="#__codelineno-98-1"></a><span class="c1">; Copiar &quot;Enero&quot; al stack</span>
</span><span id="__span-98-2"><a id="__codelineno-98-2" name="__codelineno-98-2" href="#__codelineno-98-2"></a><span class="nf">lea</span><span class="w"> </span><span class="no">rdi</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="no">rsp</span><span class="err">+</span><span class="no">Mes</span><span class="p">]</span><span class="w">          </span><span class="c1">; Destino</span>
</span><span id="__span-98-3"><a id="__codelineno-98-3" name="__codelineno-98-3" href="#__codelineno-98-3"></a><span class="nf">lea</span><span class="w"> </span><span class="no">rsi</span><span class="p">,</span><span class="w"> </span><span class="no">aEnero</span><span class="w">             </span><span class="c1">; Source: &quot;Enero&quot; en .data</span>
</span><span id="__span-98-4"><a id="__codelineno-98-4" name="__codelineno-98-4" href="#__codelineno-98-4"></a><span class="nf">mov</span><span class="w"> </span><span class="no">ecx</span><span class="p">,</span><span class="w"> </span><span class="mi">6</span><span class="w">                  </span><span class="c1">; 6 bytes</span>
</span><span id="__span-98-5"><a id="__codelineno-98-5" name="__codelineno-98-5" href="#__codelineno-98-5"></a><span class="na">rep</span><span class="w"> </span><span class="nf">movsb</span><span class="w">                   </span><span class="c1">; Copiar</span>
</span><span id="__span-98-6"><a id="__codelineno-98-6" name="__codelineno-98-6" href="#__codelineno-98-6"></a>
</span><span id="__span-98-7"><a id="__codelineno-98-7" name="__codelineno-98-7" href="#__codelineno-98-7"></a><span class="c1">; Rellenar con ceros (padding hasta 11 bytes)</span>
</span><span id="__span-98-8"><a id="__codelineno-98-8" name="__codelineno-98-8" href="#__codelineno-98-8"></a><span class="nf">lea</span><span class="w"> </span><span class="no">rdi</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="no">rsp</span><span class="err">+</span><span class="no">Mes</span><span class="err">+</span><span class="mi">6</span><span class="p">]</span><span class="w">        </span><span class="c1">; Posición después de &quot;Enero&quot;</span>
</span><span id="__span-98-9"><a id="__codelineno-98-9" name="__codelineno-98-9" href="#__codelineno-98-9"></a><span class="nf">xor</span><span class="w"> </span><span class="no">eax</span><span class="p">,</span><span class="w"> </span><span class="no">eax</span>
</span><span id="__span-98-10"><a id="__codelineno-98-10" name="__codelineno-98-10" href="#__codelineno-98-10"></a><span class="nf">mov</span><span class="w"> </span><span class="no">ecx</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span>
</span><span id="__span-98-11"><a id="__codelineno-98-11" name="__codelineno-98-11" href="#__codelineno-98-11"></a><span class="na">rep</span><span class="w"> </span><span class="nf">stosb</span><span class="w">                   </span><span class="c1">; Poner 5 ceros</span>
</span></code></pre></div>
<p><strong>Array de punteros:</strong></p>
<p>IDA muestra asignación de direcciones:</p>
<div class="language-asm highlight"><pre><span></span><code><span id="__span-99-1"><a id="__codelineno-99-1" name="__codelineno-99-1" href="#__codelineno-99-1"></a><span class="c1">; Mes2[0] = &amp;&quot;Enero&quot;</span>
</span><span id="__span-99-2"><a id="__codelineno-99-2" name="__codelineno-99-2" href="#__codelineno-99-2"></a><span class="nf">lea</span><span class="w"> </span><span class="no">rax</span><span class="p">,</span><span class="w"> </span><span class="no">aEnero</span><span class="w">             </span><span class="c1">; RAX = dirección de &quot;Enero&quot; en .data</span>
</span><span id="__span-99-3"><a id="__codelineno-99-3" name="__codelineno-99-3" href="#__codelineno-99-3"></a><span class="nf">mov</span><span class="w"> </span><span class="p">[</span><span class="no">rsp</span><span class="err">+</span><span class="no">Mes2</span><span class="p">],</span><span class="w"> </span><span class="no">rax</span><span class="w">         </span><span class="c1">; Mes2[0] = RAX</span>
</span><span id="__span-99-4"><a id="__codelineno-99-4" name="__codelineno-99-4" href="#__codelineno-99-4"></a>
</span><span id="__span-99-5"><a id="__codelineno-99-5" name="__codelineno-99-5" href="#__codelineno-99-5"></a><span class="c1">; Mes2[1] = &amp;&quot;Febrero&quot;</span>
</span><span id="__span-99-6"><a id="__codelineno-99-6" name="__codelineno-99-6" href="#__codelineno-99-6"></a><span class="nf">lea</span><span class="w"> </span><span class="no">rax</span><span class="p">,</span><span class="w"> </span><span class="no">aFebrero</span><span class="w">           </span><span class="c1">; RAX = dirección de &quot;Febrero&quot;</span>
</span><span id="__span-99-7"><a id="__codelineno-99-7" name="__codelineno-99-7" href="#__codelineno-99-7"></a><span class="nf">mov</span><span class="w"> </span><span class="p">[</span><span class="no">rsp</span><span class="err">+</span><span class="no">Mes2</span><span class="err">+</span><span class="mi">8</span><span class="p">],</span><span class="w"> </span><span class="no">rax</span><span class="w">       </span><span class="c1">; Mes2[1] = RAX (8 bytes después)</span>
</span></code></pre></div>
<p><strong>Tip para reversing:</strong> Si ves muchos <code>lea</code> + <code>mov</code> asignando direcciones consecutivas (de 8 en 8), es un array de punteros. Si ves <code>rep movsb</code> copiando datos y <code>rep stosb</code> rellenando, es un array bidimensional.</p>
<h3 id="caso-especial-char-vs-char">Caso Especial: char[] vs char*<a class="headerlink" href="#caso-especial-char-vs-char" title="Permanent link">&para;</a></h3>
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-100-1"><a id="__codelineno-100-1" name="__codelineno-100-1" href="#__codelineno-100-1"></a><span class="kt">char</span><span class="w"> </span><span class="n">cadena1</span><span class="p">[]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Cadena 1&quot;</span><span class="p">;</span><span class="w">      </span><span class="c1">// Array: contenido en el stack</span>
</span><span id="__span-100-2"><a id="__codelineno-100-2" name="__codelineno-100-2" href="#__codelineno-100-2"></a><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">cadena2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Cadena 2&quot;</span><span class="p">;</span><span class="w"> </span><span class="c1">// Puntero: string en .data</span>
</span><span id="__span-100-3"><a id="__codelineno-100-3" name="__codelineno-100-3" href="#__codelineno-100-3"></a>
</span><span id="__span-100-4"><a id="__codelineno-100-4" name="__codelineno-100-4" href="#__codelineno-100-4"></a><span class="n">cadena1</span><span class="o">++</span><span class="p">;</span><span class="w">  </span><span class="c1">// ❌ ERROR: cadena1 es dirección fija</span>
</span><span id="__span-100-5"><a id="__codelineno-100-5" name="__codelineno-100-5" href="#__codelineno-100-5"></a><span class="n">cadena2</span><span class="o">++</span><span class="p">;</span><span class="w">  </span><span class="c1">// ✅ VÁLIDO: cadena2 es un puntero</span>
</span></code></pre></div>
<p><strong>Después de <code>cadena2++</code>:</strong></p>
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-101-1"><a id="__codelineno-101-1" name="__codelineno-101-1" href="#__codelineno-101-1"></a><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">cadena1</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">endl</span><span class="p">;</span><span class="w">    </span><span class="c1">// &quot;Cadena 1&quot;</span>
</span><span id="__span-101-2"><a id="__codelineno-101-2" name="__codelineno-101-2" href="#__codelineno-101-2"></a><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">cadena2</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">endl</span><span class="p">;</span><span class="w">    </span><span class="c1">// &quot;adena 2&quot; (sin la &#39;C&#39;)</span>
</span></code></pre></div>
<h3 id="subindices-relativos-a-la-posicion-actual">Subíndices Relativos a la Posición Actual<a class="headerlink" href="#subindices-relativos-a-la-posicion-actual" title="Permanent link">&para;</a></h3>
<p>Cuando usamos un puntero con notación de array, <strong>los índices son relativos a la posición actual</strong>:</p>
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-102-1"><a id="__codelineno-102-1" name="__codelineno-102-1" href="#__codelineno-102-1"></a><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Enero&quot;</span><span class="p">;</span><span class="w">    </span><span class="c1">// p[0] = &#39;E&#39;</span>
</span><span id="__span-102-2"><a id="__codelineno-102-2" name="__codelineno-102-2" href="#__codelineno-102-2"></a>
</span><span id="__span-102-3"><a id="__codelineno-102-3" name="__codelineno-102-3" href="#__codelineno-102-3"></a><span class="n">p</span><span class="o">++</span><span class="p">;</span><span class="w">                        </span><span class="c1">// Ahora p apunta a &quot;nero&quot;</span>
</span><span id="__span-102-4"><a id="__codelineno-102-4" name="__codelineno-102-4" href="#__codelineno-102-4"></a><span class="c1">// p[0] = &#39;n&#39;</span>
</span><span id="__span-102-5"><a id="__codelineno-102-5" name="__codelineno-102-5" href="#__codelineno-102-5"></a><span class="c1">// p[1] = &#39;e&#39;</span>
</span><span id="__span-102-6"><a id="__codelineno-102-6" name="__codelineno-102-6" href="#__codelineno-102-6"></a><span class="c1">// p[2] = &#39;r&#39;</span>
</span><span id="__span-102-7"><a id="__codelineno-102-7" name="__codelineno-102-7" href="#__codelineno-102-7"></a><span class="c1">// p[3] = &#39;o&#39;</span>
</span></code></pre></div>
<p><strong>Contraste con arrays fijos:</strong></p>
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-103-1"><a id="__codelineno-103-1" name="__codelineno-103-1" href="#__codelineno-103-1"></a><span class="kt">char</span><span class="w"> </span><span class="n">arr</span><span class="p">[]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;Enero&quot;</span><span class="p">;</span>
</span><span id="__span-103-2"><a id="__codelineno-103-2" name="__codelineno-103-2" href="#__codelineno-103-2"></a><span class="c1">// arr[0] = &#39;E&#39; siempre, porque arr no puede moverse</span>
</span></code></pre></div>
<hr />
<h2 id="parte-10-reconocimiento-de-punteros-en-ida-pro-sin-simbolos">Parte 10: Reconocimiento de Punteros en IDA Pro (Sin Símbolos)<a class="headerlink" href="#parte-10-reconocimiento-de-punteros-en-ida-pro-sin-simbolos" title="Permanent link">&para;</a></h2>
<h3 id="patron-1-lea-mov-asignacion-de-puntero">Patrón 1: LEA + MOV (Asignación de Puntero)<a class="headerlink" href="#patron-1-lea-mov-asignacion-de-puntero" title="Permanent link">&para;</a></h3>
<div class="language-asm highlight"><pre><span></span><code><span id="__span-104-1"><a id="__codelineno-104-1" name="__codelineno-104-1" href="#__codelineno-104-1"></a><span class="nf">lea</span><span class="w"> </span><span class="no">rax</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="no">rsp</span><span class="err">+</span><span class="mi">20</span><span class="p">]</span><span class="w">       </span><span class="c1">; Obtener dirección</span>
</span><span id="__span-104-2"><a id="__codelineno-104-2" name="__codelineno-104-2" href="#__codelineno-104-2"></a><span class="nf">mov</span><span class="w"> </span><span class="p">[</span><span class="no">rsp</span><span class="err">+</span><span class="mi">28</span><span class="p">],</span><span class="w"> </span><span class="no">rax</span><span class="w">       </span><span class="c1">; Guardar en variable (puntero)</span>
</span></code></pre></div>
<p><strong>Indicador:</strong> <code>lea</code> seguido de <code>mov</code> → Probablemente asignación de puntero.</p>
<h3 id="patron-2-mov-doble-desreferenciacion">Patrón 2: MOV Doble (Desreferenciación)<a class="headerlink" href="#patron-2-mov-doble-desreferenciacion" title="Permanent link">&para;</a></h3>
<div class="language-asm highlight"><pre><span></span><code><span id="__span-105-1"><a id="__codelineno-105-1" name="__codelineno-105-1" href="#__codelineno-105-1"></a><span class="nf">mov</span><span class="w"> </span><span class="no">rax</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="no">rsp</span><span class="err">+</span><span class="mi">28</span><span class="p">]</span><span class="w">       </span><span class="c1">; Cargar puntero</span>
</span><span id="__span-105-2"><a id="__codelineno-105-2" name="__codelineno-105-2" href="#__codelineno-105-2"></a><span class="nf">mov</span><span class="w"> </span><span class="no">edx</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="no">rax</span><span class="p">]</span><span class="w">          </span><span class="c1">; Desreferenciar puntero</span>
</span></code></pre></div>
<p><strong>Indicador:</strong> Dos <code>mov</code> sucesivos → Probablemente lectura a través de puntero.</p>
<h3 id="patron-3-escritura-a-traves-de-puntero">Patrón 3: Escritura a través de Puntero<a class="headerlink" href="#patron-3-escritura-a-traves-de-puntero" title="Permanent link">&para;</a></h3>
<div class="language-asm highlight"><pre><span></span><code><span id="__span-106-1"><a id="__codelineno-106-1" name="__codelineno-106-1" href="#__codelineno-106-1"></a><span class="nf">mov</span><span class="w"> </span><span class="no">rax</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="no">rsp</span><span class="err">+</span><span class="mi">28</span><span class="p">]</span><span class="w">           </span><span class="c1">; Cargar puntero</span>
</span><span id="__span-106-2"><a id="__codelineno-106-2" name="__codelineno-106-2" href="#__codelineno-106-2"></a><span class="nf">mov</span><span class="w"> </span><span class="no">dword</span><span class="w"> </span><span class="no">ptr</span><span class="w"> </span><span class="p">[</span><span class="no">rax</span><span class="p">],</span><span class="w"> </span><span class="mi">10</span><span class="w">     </span><span class="c1">; Escribir a través de puntero</span>
</span></code></pre></div>
<p><strong>Indicador:</strong> <code>mov dword ptr [registro], valor</code> → Escritura desreferenciada.</p>
<h3 id="patron-4-puntero-a-estructura">Patrón 4: Puntero a Estructura<a class="headerlink" href="#patron-4-puntero-a-estructura" title="Permanent link">&para;</a></h3>
<div class="language-asm highlight"><pre><span></span><code><span id="__span-107-1"><a id="__codelineno-107-1" name="__codelineno-107-1" href="#__codelineno-107-1"></a><span class="nf">lea</span><span class="w"> </span><span class="no">rax</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="no">rsp</span><span class="err">+</span><span class="mi">28</span><span class="p">]</span><span class="w">           </span><span class="c1">; RAX = dirección de estructura</span>
</span><span id="__span-107-2"><a id="__codelineno-107-2" name="__codelineno-107-2" href="#__codelineno-107-2"></a><span class="nf">mov</span><span class="w"> </span><span class="p">[</span><span class="no">rsp</span><span class="err">+</span><span class="mi">80</span><span class="p">],</span><span class="w"> </span><span class="no">rax</span><span class="w">           </span><span class="c1">; Guardar puntero</span>
</span><span id="__span-107-3"><a id="__codelineno-107-3" name="__codelineno-107-3" href="#__codelineno-107-3"></a>
</span><span id="__span-107-4"><a id="__codelineno-107-4" name="__codelineno-107-4" href="#__codelineno-107-4"></a><span class="nf">mov</span><span class="w"> </span><span class="no">rax</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="no">rsp</span><span class="err">+</span><span class="mi">80</span><span class="p">]</span><span class="w">           </span><span class="c1">; Cargar puntero</span>
</span><span id="__span-107-5"><a id="__codelineno-107-5" name="__codelineno-107-5" href="#__codelineno-107-5"></a><span class="nf">mov</span><span class="w"> </span><span class="no">edx</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="no">rax</span><span class="err">+</span><span class="mi">82</span><span class="p">]</span><span class="w">           </span><span class="c1">; Leer campo en offset 82</span>
</span></code></pre></div>
<p><strong>Indicador:</strong> Offsets dentro de desreferenciación → Puntero a estructura.</p>
<h3 id="patron-5-llamada-a-funcion-con-puntero">Patrón 5: Llamada a Función con Puntero<a class="headerlink" href="#patron-5-llamada-a-funcion-con-puntero" title="Permanent link">&para;</a></h3>
<div class="language-asm highlight"><pre><span></span><code><span id="__span-108-1"><a id="__codelineno-108-1" name="__codelineno-108-1" href="#__codelineno-108-1"></a><span class="nf">lea</span><span class="w"> </span><span class="no">rax</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="no">rsp</span><span class="err">+</span><span class="mi">28</span><span class="p">]</span><span class="w">           </span><span class="c1">; RAX = &amp;variable</span>
</span><span id="__span-108-2"><a id="__codelineno-108-2" name="__codelineno-108-2" href="#__codelineno-108-2"></a><span class="nf">mov</span><span class="w"> </span><span class="no">rcx</span><span class="p">,</span><span class="w"> </span><span class="no">rax</span><span class="w">                </span><span class="c1">; RCX = puntero (primer parámetro)</span>
</span><span id="__span-108-3"><a id="__codelineno-108-3" name="__codelineno-108-3" href="#__codelineno-108-3"></a><span class="nf">call</span><span class="w"> </span><span class="no">sub_401234</span><span class="w">             </span><span class="c1">; Pasar puntero a función</span>
</span></code></pre></div>
<p><strong>Indicador:</strong> <code>lea</code>, luego <code>mov rcx</code>, luego <code>call</code> → Pasar puntero como parámetro.</p>
<hr />
<h2 id="parte-11-importancia-de-punteros-en-reversing">Parte 11: Importancia de Punteros en Reversing<a class="headerlink" href="#parte-11-importancia-de-punteros-en-reversing" title="Permanent link">&para;</a></h2>
<h3 id="por-que-son-criticos">¿Por Qué Son Críticos?<a class="headerlink" href="#por-que-son-criticos" title="Permanent link">&para;</a></h3>
<p><strong>1. Estructuras Grandes</strong></p>
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-109-1"><a id="__codelineno-109-1" name="__codelineno-109-1" href="#__codelineno-109-1"></a><span class="k">struct</span><span class="w"> </span><span class="nc">MuchisDatos</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-109-2"><a id="__codelineno-109-2" name="__codelineno-109-2" href="#__codelineno-109-2"></a><span class="w">    </span><span class="kt">char</span><span class="w"> </span><span class="n">buffer</span><span class="p">[</span><span class="mi">8000</span><span class="p">];</span>
</span><span id="__span-109-3"><a id="__codelineno-109-3" name="__codelineno-109-3" href="#__codelineno-109-3"></a><span class="p">};</span>
</span><span id="__span-109-4"><a id="__codelineno-109-4" name="__codelineno-109-4" href="#__codelineno-109-4"></a>
</span><span id="__span-109-5"><a id="__codelineno-109-5" name="__codelineno-109-5" href="#__codelineno-109-5"></a><span class="kt">void</span><span class="w"> </span><span class="nf">procesar</span><span class="p">(</span><span class="n">MuchisDatos</span><span class="o">*</span><span class="w"> </span><span class="n">p</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-109-6"><a id="__codelineno-109-6" name="__codelineno-109-6" href="#__codelineno-109-6"></a><span class="w">    </span><span class="n">p</span><span class="o">-&gt;</span><span class="n">buffer</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="sc">&#39;X&#39;</span><span class="p">;</span>
</span><span id="__span-109-7"><a id="__codelineno-109-7" name="__codelineno-109-7" href="#__codelineno-109-7"></a><span class="p">}</span>
</span></code></pre></div>
<p>Sin punteros, sería imposible pasar 8000 bytes eficientemente.</p>
<p><strong>2. Modificación In-Place</strong></p>
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-110-1"><a id="__codelineno-110-1" name="__codelineno-110-1" href="#__codelineno-110-1"></a><span class="kt">void</span><span class="w"> </span><span class="nf">incrementar</span><span class="p">(</span><span class="kt">int</span><span class="o">*</span><span class="w"> </span><span class="n">ptr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-110-2"><a id="__codelineno-110-2" name="__codelineno-110-2" href="#__codelineno-110-2"></a><span class="w">    </span><span class="p">(</span><span class="o">*</span><span class="n">ptr</span><span class="p">)</span><span class="o">++</span><span class="p">;</span>
</span><span id="__span-110-3"><a id="__codelineno-110-3" name="__codelineno-110-3" href="#__codelineno-110-3"></a><span class="p">}</span>
</span><span id="__span-110-4"><a id="__codelineno-110-4" name="__codelineno-110-4" href="#__codelineno-110-4"></a>
</span><span id="__span-110-5"><a id="__codelineno-110-5" name="__codelineno-110-5" href="#__codelineno-110-5"></a><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">10</span><span class="p">;</span>
</span><span id="__span-110-6"><a id="__codelineno-110-6" name="__codelineno-110-6" href="#__codelineno-110-6"></a><span class="n">incrementar</span><span class="p">(</span><span class="o">&amp;</span><span class="n">x</span><span class="p">);</span><span class="w">    </span><span class="c1">// x ahora vale 11</span>
</span></code></pre></div>
<p>El puntero permite modificar la variable original.</p>
<p><strong>3. Arrays Dinámicos</strong></p>
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-111-1"><a id="__codelineno-111-1" name="__codelineno-111-1" href="#__codelineno-111-1"></a><span class="kt">int</span><span class="o">*</span><span class="w"> </span><span class="n">arr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="kt">int</span><span class="p">[</span><span class="mi">1000</span><span class="p">];</span>
</span><span id="__span-111-2"><a id="__codelineno-111-2" name="__codelineno-111-2" href="#__codelineno-111-2"></a><span class="n">arr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">100</span><span class="p">;</span>
</span><span id="__span-111-3"><a id="__codelineno-111-3" name="__codelineno-111-3" href="#__codelineno-111-3"></a><span class="n">arr</span><span class="p">[</span><span class="mi">999</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">200</span><span class="p">;</span>
</span></code></pre></div>
<p>Los arrays dinámicos se manejan completamente con punteros.</p>
<p><strong>4. Listas Enlazadas, Árboles, etc.</strong></p>
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-112-1"><a id="__codelineno-112-1" name="__codelineno-112-1" href="#__codelineno-112-1"></a><span class="k">struct</span><span class="w"> </span><span class="nc">Nodo</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-112-2"><a id="__codelineno-112-2" name="__codelineno-112-2" href="#__codelineno-112-2"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">dato</span><span class="p">;</span>
</span><span id="__span-112-3"><a id="__codelineno-112-3" name="__codelineno-112-3" href="#__codelineno-112-3"></a><span class="w">    </span><span class="n">Nodo</span><span class="o">*</span><span class="w"> </span><span class="n">siguiente</span><span class="p">;</span><span class="w">  </span><span class="c1">// Puntero al siguiente nodo</span>
</span><span id="__span-112-4"><a id="__codelineno-112-4" name="__codelineno-112-4" href="#__codelineno-112-4"></a><span class="p">};</span>
</span></code></pre></div>
<p>Las estructuras recursivas requieren punteros.</p>
<h3 id="en-reversing">En Reversing<a class="headerlink" href="#en-reversing" title="Permanent link">&para;</a></h3>
<p>Cuando ves punteros en ensamblador:</p>
<ul>
<li>Hay transferencia de estructuras entre funciones</li>
<li>Hay modificación de datos desde otra función</li>
<li>Hay operaciones complejas (búsquedas, iteraciones)</li>
<li>El tamaño de datos es significativo</li>
</ul>
<hr />
<h2 id="parte-12-stack-frame-con-punteros">Parte 12: Stack Frame con Punteros<a class="headerlink" href="#parte-12-stack-frame-con-punteros" title="Permanent link">&para;</a></h2>
<h3 id="ejemplo-completo">Ejemplo Completo<a class="headerlink" href="#ejemplo-completo" title="Permanent link">&para;</a></h3>
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-113-1"><a id="__codelineno-113-1" name="__codelineno-113-1" href="#__codelineno-113-1"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-113-2"><a id="__codelineno-113-2" name="__codelineno-113-2" href="#__codelineno-113-2"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">100</span><span class="p">;</span>
</span><span id="__span-113-3"><a id="__codelineno-113-3" name="__codelineno-113-3" href="#__codelineno-113-3"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">200</span><span class="p">;</span>
</span><span id="__span-113-4"><a id="__codelineno-113-4" name="__codelineno-113-4" href="#__codelineno-113-4"></a><span class="w">    </span><span class="kt">int</span><span class="o">*</span><span class="w"> </span><span class="n">pa</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="n">a</span><span class="p">;</span>
</span><span id="__span-113-5"><a id="__codelineno-113-5" name="__codelineno-113-5" href="#__codelineno-113-5"></a><span class="w">    </span><span class="kt">int</span><span class="o">*</span><span class="w"> </span><span class="n">pb</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="n">b</span><span class="p">;</span>
</span><span id="__span-113-6"><a id="__codelineno-113-6" name="__codelineno-113-6" href="#__codelineno-113-6"></a>
</span><span id="__span-113-7"><a id="__codelineno-113-7" name="__codelineno-113-7" href="#__codelineno-113-7"></a><span class="w">    </span><span class="o">*</span><span class="n">pa</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">500</span><span class="p">;</span>
</span><span id="__span-113-8"><a id="__codelineno-113-8" name="__codelineno-113-8" href="#__codelineno-113-8"></a><span class="w">    </span><span class="o">*</span><span class="n">pb</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">600</span><span class="p">;</span>
</span><span id="__span-113-9"><a id="__codelineno-113-9" name="__codelineno-113-9" href="#__codelineno-113-9"></a><span class="p">}</span>
</span></code></pre></div>
<h3 id="stack-layout">Stack Layout<a class="headerlink" href="#stack-layout" title="Permanent link">&para;</a></h3>
<div class="language-text highlight"><pre><span></span><code><span id="__span-114-1"><a id="__codelineno-114-1" name="__codelineno-114-1" href="#__codelineno-114-1"></a>RSP+0x00:  Shadow Space (32 bytes)
</span><span id="__span-114-2"><a id="__codelineno-114-2" name="__codelineno-114-2" href="#__codelineno-114-2"></a>RSP+0x20:  a (int, 4 bytes) = 100 → 500
</span><span id="__span-114-3"><a id="__codelineno-114-3" name="__codelineno-114-3" href="#__codelineno-114-3"></a>RSP+0x24:  b (int, 4 bytes) = 200 → 600
</span><span id="__span-114-4"><a id="__codelineno-114-4" name="__codelineno-114-4" href="#__codelineno-114-4"></a>RSP+0x28:  pa (puntero, 8 bytes) = &amp;a
</span><span id="__span-114-5"><a id="__codelineno-114-5" name="__codelineno-114-5" href="#__codelineno-114-5"></a>RSP+0x30:  pb (puntero, 8 bytes) = &amp;b
</span><span id="__span-114-6"><a id="__codelineno-114-6" name="__codelineno-114-6" href="#__codelineno-114-6"></a>RSP+0x38:  Security Cookie (8 bytes)
</span></code></pre></div>
<h3 id="ensamblador-completo">Ensamblador Completo<a class="headerlink" href="#ensamblador-completo" title="Permanent link">&para;</a></h3>
<div class="language-asm highlight"><pre><span></span><code><span id="__span-115-1"><a id="__codelineno-115-1" name="__codelineno-115-1" href="#__codelineno-115-1"></a><span class="c1">; a = 100</span>
</span><span id="__span-115-2"><a id="__codelineno-115-2" name="__codelineno-115-2" href="#__codelineno-115-2"></a><span class="nf">mov</span><span class="w"> </span><span class="no">dword</span><span class="w"> </span><span class="no">ptr</span><span class="w"> </span><span class="p">[</span><span class="no">rsp</span><span class="err">+</span><span class="mi">20</span><span class="p">],</span><span class="w"> </span><span class="mi">100</span>
</span><span id="__span-115-3"><a id="__codelineno-115-3" name="__codelineno-115-3" href="#__codelineno-115-3"></a>
</span><span id="__span-115-4"><a id="__codelineno-115-4" name="__codelineno-115-4" href="#__codelineno-115-4"></a><span class="c1">; b = 200</span>
</span><span id="__span-115-5"><a id="__codelineno-115-5" name="__codelineno-115-5" href="#__codelineno-115-5"></a><span class="nf">mov</span><span class="w"> </span><span class="no">dword</span><span class="w"> </span><span class="no">ptr</span><span class="w"> </span><span class="p">[</span><span class="no">rsp</span><span class="err">+</span><span class="mi">24</span><span class="p">],</span><span class="w"> </span><span class="mi">200</span>
</span><span id="__span-115-6"><a id="__codelineno-115-6" name="__codelineno-115-6" href="#__codelineno-115-6"></a>
</span><span id="__span-115-7"><a id="__codelineno-115-7" name="__codelineno-115-7" href="#__codelineno-115-7"></a><span class="c1">; pa = &amp;a</span>
</span><span id="__span-115-8"><a id="__codelineno-115-8" name="__codelineno-115-8" href="#__codelineno-115-8"></a><span class="nf">lea</span><span class="w"> </span><span class="no">rax</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="no">rsp</span><span class="err">+</span><span class="mi">20</span><span class="p">]</span>
</span><span id="__span-115-9"><a id="__codelineno-115-9" name="__codelineno-115-9" href="#__codelineno-115-9"></a><span class="nf">mov</span><span class="w"> </span><span class="p">[</span><span class="no">rsp</span><span class="err">+</span><span class="mi">28</span><span class="p">],</span><span class="w"> </span><span class="no">rax</span>
</span><span id="__span-115-10"><a id="__codelineno-115-10" name="__codelineno-115-10" href="#__codelineno-115-10"></a>
</span><span id="__span-115-11"><a id="__codelineno-115-11" name="__codelineno-115-11" href="#__codelineno-115-11"></a><span class="c1">; pb = &amp;b</span>
</span><span id="__span-115-12"><a id="__codelineno-115-12" name="__codelineno-115-12" href="#__codelineno-115-12"></a><span class="nf">lea</span><span class="w"> </span><span class="no">rax</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="no">rsp</span><span class="err">+</span><span class="mi">24</span><span class="p">]</span>
</span><span id="__span-115-13"><a id="__codelineno-115-13" name="__codelineno-115-13" href="#__codelineno-115-13"></a><span class="nf">mov</span><span class="w"> </span><span class="p">[</span><span class="no">rsp</span><span class="err">+</span><span class="mi">30</span><span class="p">],</span><span class="w"> </span><span class="no">rax</span>
</span><span id="__span-115-14"><a id="__codelineno-115-14" name="__codelineno-115-14" href="#__codelineno-115-14"></a>
</span><span id="__span-115-15"><a id="__codelineno-115-15" name="__codelineno-115-15" href="#__codelineno-115-15"></a><span class="c1">; *pa = 500</span>
</span><span id="__span-115-16"><a id="__codelineno-115-16" name="__codelineno-115-16" href="#__codelineno-115-16"></a><span class="nf">mov</span><span class="w"> </span><span class="no">rax</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="no">rsp</span><span class="err">+</span><span class="mi">28</span><span class="p">]</span><span class="w">           </span><span class="c1">; RAX = pa</span>
</span><span id="__span-115-17"><a id="__codelineno-115-17" name="__codelineno-115-17" href="#__codelineno-115-17"></a><span class="nf">mov</span><span class="w"> </span><span class="no">dword</span><span class="w"> </span><span class="no">ptr</span><span class="w"> </span><span class="p">[</span><span class="no">rax</span><span class="p">],</span><span class="w"> </span><span class="mi">500</span><span class="w">    </span><span class="c1">; a ahora vale 500</span>
</span><span id="__span-115-18"><a id="__codelineno-115-18" name="__codelineno-115-18" href="#__codelineno-115-18"></a>
</span><span id="__span-115-19"><a id="__codelineno-115-19" name="__codelineno-115-19" href="#__codelineno-115-19"></a><span class="c1">; *pb = 600</span>
</span><span id="__span-115-20"><a id="__codelineno-115-20" name="__codelineno-115-20" href="#__codelineno-115-20"></a><span class="nf">mov</span><span class="w"> </span><span class="no">rax</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="no">rsp</span><span class="err">+</span><span class="mi">30</span><span class="p">]</span><span class="w">           </span><span class="c1">; RAX = pb</span>
</span><span id="__span-115-21"><a id="__codelineno-115-21" name="__codelineno-115-21" href="#__codelineno-115-21"></a><span class="nf">mov</span><span class="w"> </span><span class="no">dword</span><span class="w"> </span><span class="no">ptr</span><span class="w"> </span><span class="p">[</span><span class="no">rax</span><span class="p">],</span><span class="w"> </span><span class="mi">600</span><span class="w">    </span><span class="c1">; b ahora vale 600</span>
</span></code></pre></div>
<h3 id="estado-final">Estado Final<a class="headerlink" href="#estado-final" title="Permanent link">&para;</a></h3>
<div class="language-text highlight"><pre><span></span><code><span id="__span-116-1"><a id="__codelineno-116-1" name="__codelineno-116-1" href="#__codelineno-116-1"></a>[RSP+0x20] = 500  (a)
</span><span id="__span-116-2"><a id="__codelineno-116-2" name="__codelineno-116-2" href="#__codelineno-116-2"></a>[RSP+0x24] = 600  (b)
</span></code></pre></div>
<hr />
<h2 id="parte-13-errores-comunes-con-punteros">Parte 13: Errores Comunes con Punteros<a class="headerlink" href="#parte-13-errores-comunes-con-punteros" title="Permanent link">&para;</a></h2>
<h3 id="error-1-usar-puntero-nulo">Error 1: Usar Puntero Nulo<a class="headerlink" href="#error-1-usar-puntero-nulo" title="Permanent link">&para;</a></h3>
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-117-1"><a id="__codelineno-117-1" name="__codelineno-117-1" href="#__codelineno-117-1"></a><span class="kt">int</span><span class="o">*</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">;</span>
</span><span id="__span-117-2"><a id="__codelineno-117-2" name="__codelineno-117-2" href="#__codelineno-117-2"></a><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">*</span><span class="n">p</span><span class="p">;</span><span class="w">         </span><span class="c1">// Crash!</span>
</span></code></pre></div>
<p><strong>En reversing:</strong> Si ves <code>mov eax, [0]</code> o similar → Probablemente crash intencional o bug.</p>
<h3 id="error-2-puntero-a-variable-local">Error 2: Puntero a Variable Local<a class="headerlink" href="#error-2-puntero-a-variable-local" title="Permanent link">&para;</a></h3>
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-118-1"><a id="__codelineno-118-1" name="__codelineno-118-1" href="#__codelineno-118-1"></a><span class="kt">int</span><span class="o">*</span><span class="w"> </span><span class="n">puntero_global</span><span class="p">;</span>
</span><span id="__span-118-2"><a id="__codelineno-118-2" name="__codelineno-118-2" href="#__codelineno-118-2"></a>
</span><span id="__span-118-3"><a id="__codelineno-118-3" name="__codelineno-118-3" href="#__codelineno-118-3"></a><span class="kt">void</span><span class="w"> </span><span class="nf">funcion</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-118-4"><a id="__codelineno-118-4" name="__codelineno-118-4" href="#__codelineno-118-4"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">5</span><span class="p">;</span>
</span><span id="__span-118-5"><a id="__codelineno-118-5" name="__codelineno-118-5" href="#__codelineno-118-5"></a><span class="w">    </span><span class="n">puntero_global</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="n">a</span><span class="p">;</span><span class="w">    </span><span class="c1">// ¡Peligro! a se destruye al salir</span>
</span><span id="__span-118-6"><a id="__codelineno-118-6" name="__codelineno-118-6" href="#__codelineno-118-6"></a><span class="p">}</span>
</span><span id="__span-118-7"><a id="__codelineno-118-7" name="__codelineno-118-7" href="#__codelineno-118-7"></a>
</span><span id="__span-118-8"><a id="__codelineno-118-8" name="__codelineno-118-8" href="#__codelineno-118-8"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-118-9"><a id="__codelineno-118-9" name="__codelineno-118-9" href="#__codelineno-118-9"></a><span class="w">    </span><span class="n">funcion</span><span class="p">();</span>
</span><span id="__span-118-10"><a id="__codelineno-118-10" name="__codelineno-118-10" href="#__codelineno-118-10"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">*</span><span class="n">puntero_global</span><span class="p">;</span><span class="w">  </span><span class="c1">// Crash o valor basura</span>
</span><span id="__span-118-11"><a id="__codelineno-118-11" name="__codelineno-118-11" href="#__codelineno-118-11"></a><span class="p">}</span>
</span></code></pre></div>
<p><strong>En reversing:</strong> Punteros que apuntan a stack de funciones ya terminadas → Bug.</p>
<h3 id="error-3-confundir-direccion-con-valor">Error 3: Confundir Dirección con Valor<a class="headerlink" href="#error-3-confundir-direccion-con-valor" title="Permanent link">&para;</a></h3>
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-119-1"><a id="__codelineno-119-1" name="__codelineno-119-1" href="#__codelineno-119-1"></a><span class="kt">int</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">100</span><span class="p">;</span>
</span><span id="__span-119-2"><a id="__codelineno-119-2" name="__codelineno-119-2" href="#__codelineno-119-2"></a><span class="kt">int</span><span class="o">*</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="n">a</span><span class="p">;</span>
</span><span id="__span-119-3"><a id="__codelineno-119-3" name="__codelineno-119-3" href="#__codelineno-119-3"></a><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">endl</span><span class="p">;</span><span class="w">      </span><span class="c1">// Imprime dirección (0x1000)</span>
</span><span id="__span-119-4"><a id="__codelineno-119-4" name="__codelineno-119-4" href="#__codelineno-119-4"></a><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="o">*</span><span class="n">p</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">endl</span><span class="p">;</span><span class="w">     </span><span class="c1">// Imprime valor (100)</span>
</span></code></pre></div>
<h3 id="error-4-olvidar-desreferenciar">Error 4: Olvidar Desreferenciar<a class="headerlink" href="#error-4-olvidar-desreferenciar" title="Permanent link">&para;</a></h3>
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-120-1"><a id="__codelineno-120-1" name="__codelineno-120-1" href="#__codelineno-120-1"></a><span class="kt">int</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">100</span><span class="p">;</span>
</span><span id="__span-120-2"><a id="__codelineno-120-2" name="__codelineno-120-2" href="#__codelineno-120-2"></a><span class="kt">int</span><span class="o">*</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="n">a</span><span class="p">;</span>
</span><span id="__span-120-3"><a id="__codelineno-120-3" name="__codelineno-120-3" href="#__codelineno-120-3"></a>
</span><span id="__span-120-4"><a id="__codelineno-120-4" name="__codelineno-120-4" href="#__codelineno-120-4"></a><span class="kt">int</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">p</span><span class="p">;</span><span class="w">      </span><span class="c1">// Asigna dirección a int (error de tipos)</span>
</span><span id="__span-120-5"><a id="__codelineno-120-5" name="__codelineno-120-5" href="#__codelineno-120-5"></a><span class="kt">int</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">*</span><span class="n">p</span><span class="p">;</span><span class="w">     </span><span class="c1">// Correcto: asigna valor</span>
</span></code></pre></div>
<hr />
<h2 id="checklist-reconocer-punteros-en-ensamblador">Checklist: Reconocer Punteros en Ensamblador<a class="headerlink" href="#checklist-reconocer-punteros-en-ensamblador" title="Permanent link">&para;</a></h2>
<p>Cuando revises una función desconocida:</p>
<ul class="task-list">
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled/><span class="task-list-indicator"></span></label> ¿Hay <code>lea</code> seguido de <code>mov</code> en el stack? → Puntero asignado</li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled/><span class="task-list-indicator"></span></label> ¿Hay <code>mov</code> doble sobre el mismo registro? → Posible desreferenciación</li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled/><span class="task-list-indicator"></span></label> ¿Hay <code>mov dword ptr [registro], valor</code>? → Escritura desreferenciada</li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled/><span class="task-list-indicator"></span></label> ¿Hay offsets dentro de desreferenciación? → Puntero a estructura</li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled/><span class="task-list-indicator"></span></label> ¿Se pasan registros a funciones con <code>lea</code> antes? → Puntero como parámetro</li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled/><span class="task-list-indicator"></span></label> ¿Hay operaciones de suma en punteros? → Aritmética de punteros (arrays)</li>
</ul>
<hr />
<h2 id="parte-14-comparacion-directa-con-ensamblador-del-video">Parte 14: Comparación Directa con Ensamblador del Video<a class="headerlink" href="#parte-14-comparacion-directa-con-ensamblador-del-video" title="Permanent link">&para;</a></h2>
<h3 id="codigo-original-del-video">Código Original (del video)<a class="headerlink" href="#codigo-original-del-video" title="Permanent link">&para;</a></h3>
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-121-1"><a id="__codelineno-121-1" name="__codelineno-121-1" href="#__codelineno-121-1"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-121-2"><a id="__codelineno-121-2" name="__codelineno-121-2" href="#__codelineno-121-2"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">a</span><span class="p">;</span>
</span><span id="__span-121-3"><a id="__codelineno-121-3" name="__codelineno-121-3" href="#__codelineno-121-3"></a><span class="w">    </span><span class="kt">int</span><span class="o">*</span><span class="w"> </span><span class="n">pa</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="n">a</span><span class="p">;</span>
</span><span id="__span-121-4"><a id="__codelineno-121-4" name="__codelineno-121-4" href="#__codelineno-121-4"></a><span class="w">    </span><span class="o">*</span><span class="n">pa</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">5</span><span class="p">;</span>
</span><span id="__span-121-5"><a id="__codelineno-121-5" name="__codelineno-121-5" href="#__codelineno-121-5"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">*</span><span class="n">pa</span><span class="p">;</span>
</span><span id="__span-121-6"><a id="__codelineno-121-6" name="__codelineno-121-6" href="#__codelineno-121-6"></a><span class="w">    </span><span class="o">*</span><span class="n">pa</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">10</span><span class="p">;</span>
</span><span id="__span-121-7"><a id="__codelineno-121-7" name="__codelineno-121-7" href="#__codelineno-121-7"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
</span><span id="__span-121-8"><a id="__codelineno-121-8" name="__codelineno-121-8" href="#__codelineno-121-8"></a><span class="p">}</span>
</span></code></pre></div>
<h3 id="ensamblador-esperado-sin-optimizaciones">Ensamblador Esperado (sin optimizaciones)<a class="headerlink" href="#ensamblador-esperado-sin-optimizaciones" title="Permanent link">&para;</a></h3>
<div class="language-asm highlight"><pre><span></span><code><span id="__span-122-1"><a id="__codelineno-122-1" name="__codelineno-122-1" href="#__codelineno-122-1"></a><span class="err">00401000:</span><span class="w"> </span><span class="nf">push</span><span class="w">    </span><span class="no">rbp</span>
</span><span id="__span-122-2"><a id="__codelineno-122-2" name="__codelineno-122-2" href="#__codelineno-122-2"></a><span class="err">00401001:</span><span class="w"> </span><span class="nf">mov</span><span class="w">     </span><span class="no">rbp</span><span class="p">,</span><span class="w"> </span><span class="no">rsp</span>
</span><span id="__span-122-3"><a id="__codelineno-122-3" name="__codelineno-122-3" href="#__codelineno-122-3"></a><span class="err">00401004:</span><span class="w"> </span><span class="nf">sub</span><span class="w">     </span><span class="no">rsp</span><span class="p">,</span><span class="w"> </span><span class="mi">40</span><span class="no">h</span>
</span><span id="__span-122-4"><a id="__codelineno-122-4" name="__codelineno-122-4" href="#__codelineno-122-4"></a>
</span><span id="__span-122-5"><a id="__codelineno-122-5" name="__codelineno-122-5" href="#__codelineno-122-5"></a><span class="c1">; pa = &amp;a</span>
</span><span id="__span-122-6"><a id="__codelineno-122-6" name="__codelineno-122-6" href="#__codelineno-122-6"></a><span class="err">00401008:</span><span class="w"> </span><span class="nf">lea</span><span class="w">     </span><span class="no">rax</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="no">rsp</span><span class="err">+</span><span class="mi">20</span><span class="no">h</span><span class="p">]</span><span class="w">      </span><span class="c1">; Obtener dirección de a</span>
</span><span id="__span-122-7"><a id="__codelineno-122-7" name="__codelineno-122-7" href="#__codelineno-122-7"></a><span class="err">00401010:</span><span class="w"> </span><span class="nf">mov</span><span class="w">     </span><span class="p">[</span><span class="no">rsp</span><span class="err">+</span><span class="mi">28</span><span class="no">h</span><span class="p">],</span><span class="w"> </span><span class="no">rax</span><span class="w">      </span><span class="c1">; pa = dirección</span>
</span><span id="__span-122-8"><a id="__codelineno-122-8" name="__codelineno-122-8" href="#__codelineno-122-8"></a>
</span><span id="__span-122-9"><a id="__codelineno-122-9" name="__codelineno-122-9" href="#__codelineno-122-9"></a><span class="c1">; *pa = 5</span>
</span><span id="__span-122-10"><a id="__codelineno-122-10" name="__codelineno-122-10" href="#__codelineno-122-10"></a><span class="err">00401018:</span><span class="w"> </span><span class="nf">mov</span><span class="w">     </span><span class="no">rax</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="no">rsp</span><span class="err">+</span><span class="mi">28</span><span class="no">h</span><span class="p">]</span><span class="w">      </span><span class="c1">; Cargar pa</span>
</span><span id="__span-122-11"><a id="__codelineno-122-11" name="__codelineno-122-11" href="#__codelineno-122-11"></a><span class="err">0040101</span><span class="nl">C:</span><span class="w"> </span><span class="nf">mov</span><span class="w">     </span><span class="no">dword</span><span class="w"> </span><span class="no">ptr</span><span class="w"> </span><span class="p">[</span><span class="no">rax</span><span class="p">],</span><span class="w"> </span><span class="mi">5</span><span class="w">  </span><span class="c1">; Escribir 5</span>
</span><span id="__span-122-12"><a id="__codelineno-122-12" name="__codelineno-122-12" href="#__codelineno-122-12"></a>
</span><span id="__span-122-13"><a id="__codelineno-122-13" name="__codelineno-122-13" href="#__codelineno-122-13"></a><span class="c1">; b = *pa</span>
</span><span id="__span-122-14"><a id="__codelineno-122-14" name="__codelineno-122-14" href="#__codelineno-122-14"></a><span class="err">00401024:</span><span class="w"> </span><span class="nf">mov</span><span class="w">     </span><span class="no">rax</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="no">rsp</span><span class="err">+</span><span class="mi">28</span><span class="no">h</span><span class="p">]</span><span class="w">      </span><span class="c1">; Cargar pa</span>
</span><span id="__span-122-15"><a id="__codelineno-122-15" name="__codelineno-122-15" href="#__codelineno-122-15"></a><span class="err">00401028:</span><span class="w"> </span><span class="nf">mov</span><span class="w">     </span><span class="no">edx</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="no">rax</span><span class="p">]</span><span class="w">          </span><span class="c1">; Leer valor (5)</span>
</span><span id="__span-122-16"><a id="__codelineno-122-16" name="__codelineno-122-16" href="#__codelineno-122-16"></a><span class="err">0040102</span><span class="nl">C:</span><span class="w"> </span><span class="nf">mov</span><span class="w">     </span><span class="p">[</span><span class="no">rsp</span><span class="err">+</span><span class="mi">24</span><span class="no">h</span><span class="p">],</span><span class="w"> </span><span class="no">edx</span><span class="w">      </span><span class="c1">; b = 5</span>
</span><span id="__span-122-17"><a id="__codelineno-122-17" name="__codelineno-122-17" href="#__codelineno-122-17"></a>
</span><span id="__span-122-18"><a id="__codelineno-122-18" name="__codelineno-122-18" href="#__codelineno-122-18"></a><span class="c1">; *pa = 10</span>
</span><span id="__span-122-19"><a id="__codelineno-122-19" name="__codelineno-122-19" href="#__codelineno-122-19"></a><span class="err">00401030:</span><span class="w"> </span><span class="nf">mov</span><span class="w">     </span><span class="no">rax</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="no">rsp</span><span class="err">+</span><span class="mi">28</span><span class="no">h</span><span class="p">]</span><span class="w">      </span><span class="c1">; Cargar pa</span>
</span><span id="__span-122-20"><a id="__codelineno-122-20" name="__codelineno-122-20" href="#__codelineno-122-20"></a><span class="err">00401034:</span><span class="w"> </span><span class="nf">mov</span><span class="w">     </span><span class="no">dword</span><span class="w"> </span><span class="no">ptr</span><span class="w"> </span><span class="p">[</span><span class="no">rax</span><span class="p">],</span><span class="w"> </span><span class="mi">10</span><span class="w"> </span><span class="c1">; Escribir 10</span>
</span><span id="__span-122-21"><a id="__codelineno-122-21" name="__codelineno-122-21" href="#__codelineno-122-21"></a>
</span><span id="__span-122-22"><a id="__codelineno-122-22" name="__codelineno-122-22" href="#__codelineno-122-22"></a><span class="c1">; Epilogo</span>
</span><span id="__span-122-23"><a id="__codelineno-122-23" name="__codelineno-122-23" href="#__codelineno-122-23"></a><span class="err">00401038:</span><span class="w"> </span><span class="nf">xor</span><span class="w">     </span><span class="no">eax</span><span class="p">,</span><span class="w"> </span><span class="no">eax</span><span class="w">            </span><span class="c1">; return 0</span>
</span><span id="__span-122-24"><a id="__codelineno-122-24" name="__codelineno-122-24" href="#__codelineno-122-24"></a><span class="err">0040103</span><span class="nl">A:</span><span class="w"> </span><span class="nf">add</span><span class="w">     </span><span class="no">rsp</span><span class="p">,</span><span class="w"> </span><span class="mi">40</span><span class="no">h</span>
</span><span id="__span-122-25"><a id="__codelineno-122-25" name="__codelineno-122-25" href="#__codelineno-122-25"></a><span class="err">00401041:</span><span class="w"> </span><span class="nf">pop</span><span class="w">     </span><span class="no">rbp</span>
</span><span id="__span-122-26"><a id="__codelineno-122-26" name="__codelineno-122-26" href="#__codelineno-122-26"></a><span class="err">00401042:</span><span class="w"> </span><span class="nf">ret</span>
</span></code></pre></div>
<h3 id="analisis-paso-a-paso-en-depuracion">Análisis Paso a Paso en Depuración<a class="headerlink" href="#analisis-paso-a-paso-en-depuracion" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Instrucción</th>
<th>RAX</th>
<th>[RSP+20] (a)</th>
<th>[RSP+28] (pa)</th>
<th>[RSP+24] (b)</th>
</tr>
</thead>
<tbody>
<tr>
<td>Inicial</td>
<td>-</td>
<td>?</td>
<td>-</td>
<td>-</td>
</tr>
<tr>
<td><code>lea rax, [rsp+20]</code></td>
<td>0x...0x20</td>
<td>?</td>
<td>-</td>
<td>-</td>
</tr>
<tr>
<td><code>mov [rsp+28], rax</code></td>
<td>0x...0x20</td>
<td>?</td>
<td>0x...0x20</td>
<td>-</td>
</tr>
<tr>
<td><code>mov rax, [rsp+28]</code></td>
<td>0x...0x20</td>
<td>?</td>
<td>0x...0x20</td>
<td>-</td>
</tr>
<tr>
<td><code>mov [rax], 5</code></td>
<td>0x...0x20</td>
<td>5</td>
<td>0x...0x20</td>
<td>-</td>
</tr>
<tr>
<td><code>mov rax, [rsp+28]</code></td>
<td>0x...0x20</td>
<td>5</td>
<td>0x...0x20</td>
<td>-</td>
</tr>
<tr>
<td><code>mov edx, [rax]</code></td>
<td>0x...0x20</td>
<td>5</td>
<td>0x...0x20</td>
<td>-</td>
</tr>
<tr>
<td><code>mov [rsp+24], edx</code></td>
<td>0x...0x20</td>
<td>5</td>
<td>0x...0x20</td>
<td>5</td>
</tr>
<tr>
<td><code>mov rax, [rsp+28]</code></td>
<td>0x...0x20</td>
<td>5</td>
<td>0x...0x20</td>
<td>5</td>
</tr>
<tr>
<td><code>mov [rax], 10</code></td>
<td>0x...0x20</td>
<td>10</td>
<td>0x...0x20</td>
<td>5</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="resumen-lo-mas-importante">Resumen: Lo Más Importante<a class="headerlink" href="#resumen-lo-mas-importante" title="Permanent link">&para;</a></h2>
<h3 id="conceptos-clave">Conceptos Clave<a class="headerlink" href="#conceptos-clave" title="Permanent link">&para;</a></h3>
<ol>
<li><strong>Puntero = Dirección de memoria</strong></li>
<li>Se obtiene con <code>&amp;variable</code></li>
<li>
<p>Se desreferencia con <code>*puntero</code></p>
</li>
<li>
<p><strong>En ensamblador:</strong></p>
</li>
<li><code>lea</code> obtiene dirección (sin desreferenciar)</li>
<li><code>mov</code> carga/almacena direcciones o valores</li>
<li>
<p><code>[registro]</code> desreferencia el puntero</p>
</li>
<li>
<p><strong>Aritmética de punteros:</strong></p>
</li>
<li><code>puntero++</code> suma el <strong>tamaño del tipo</strong> (no 1 byte)</li>
<li><code>puntero + N</code> suma <code>N * sizeof(tipo)</code></li>
<li>Puntero a <code>int</code>: incrementa de 4 en 4</li>
<li>
<p>Puntero a <code>struct</code> de 8 bytes: incrementa de 8 en 8</p>
</li>
<li>
<p><strong>Notaciones equivalentes:</strong></p>
</li>
<li><code>*(p + N)</code> es igual a <code>p[N]</code></li>
<li>
<p>Pero <code>arr++</code> es ilegal (array fijo), mientras que <code>p++</code> es válido</p>
</li>
<li>
<p><strong>Array bidimensional vs Array de punteros:</strong></p>
</li>
</ol>
<table>
<thead>
<tr>
<th>Característica</th>
<th><code>char arr[][11]</code></th>
<th><code>char* arr[]</code></th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Contenido en stack</strong></td>
<td>Todos los caracteres</td>
<td>Solo punteros (8 bytes c/u)</td>
</tr>
<tr>
<td><strong>Strings en</strong></td>
<td>Stack (contiguos)</td>
<td>Sección .data</td>
</tr>
<tr>
<td><strong>Tamaño</strong></td>
<td>filas × columnas</td>
<td>filas × 8 bytes</td>
</tr>
<tr>
<td><strong>Incrementar elemento</strong></td>
<td>❌ Ilegal</td>
<td>✅ Válido</td>
</tr>
<tr>
<td><strong>Ejemplo</strong></td>
<td>12 × 11 = 132 bytes</td>
<td>12 × 8 = 96 bytes</td>
</tr>
</tbody>
</table>
<ol>
<li><strong>Patrones a reconocer:</strong></li>
<li><code>lea + mov</code> = asignación de puntero</li>
<li><code>mov + mov</code> = desreferenciación</li>
<li><code>mov dword ptr [reg], val</code> = escritura desreferenciada</li>
<li><code>imul eax, 0Bh</code> + <code>add</code> = acceso a array bidimensional (11 = 0Bh)</li>
<li><code>imul eax, 8</code> + doble desreferencia = array de punteros</li>
</ol>
<h3 id="para-reversing">Para Reversing<a class="headerlink" href="#para-reversing" title="Permanent link">&para;</a></h3>
<ul>
<li>Los punteros son <strong>fundamentales</strong> para pasar datos entre funciones</li>
<li>Sin punteros, es imposible trabajar con estructuras grandes</li>
<li>La aritmética de punteros implica multiplicación por el tamaño del tipo</li>
<li>Los punteros dobles (<code>**p</code>) son raros pero aparecen en callbacks y manipulación dinámica</li>
<li><strong>Array bidimensional</strong>: Ves <code>rep movsb</code> y <code>rep stosb</code> para inicializar en stack</li>
<li><strong>Array de punteros</strong>: Ves múltiples <code>lea</code> + <code>mov</code> asignando direcciones</li>
</ul>
<h3 id="consejo-final-de-narvaja">Consejo Final de Narvaja<a class="headerlink" href="#consejo-final-de-narvaja" title="Permanent link">&para;</a></h3>
<blockquote>
<p>El reversing es un proceso iterativo. Muchas veces uno se confunde y después lo arregla.
No se asusten si algo no sale de movida. El trabajo real es equivocarse, corregir, y poco a poco
llegar al resultado correcto. Nadie lo hace perfecto la primera vez.</p>
</blockquote>
<h2 id="parte-15-punteros-en-el-heap">Parte 15: Punteros en el Heap<a class="headerlink" href="#parte-15-punteros-en-el-heap" title="Permanent link">&para;</a></h2>
<h3 id="que-es-el-heap-objetos-dinamicos">Qué es el Heap (objetos dinámicos)<a class="headerlink" href="#que-es-el-heap-objetos-dinamicos" title="Permanent link">&para;</a></h3>
<ul>
<li>Región de memoria dinámica del proceso (ni stack ni .data/.bss).</li>
<li>Las direcciones <strong>cambian en cada ejecución</strong> y el tamaño se decide en runtime.</li>
<li>Se usa para objetos que no conocemos de antemano o que pueden ser grandes.</li>
</ul>
<h3 id="new-vs-malloc-diferencias-clave">New vs malloc (diferencias clave)<a class="headerlink" href="#new-vs-malloc-diferencias-clave" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Aspecto</th>
<th><code>new</code></th>
<th><code>malloc</code></th>
</tr>
</thead>
<tbody>
<tr>
<td>Tipo devuelto</td>
<td>Devuelve puntero tipado (no requiere cast)</td>
<td><code>void*</code> (requiere cast)</td>
</tr>
<tr>
<td>Tamaño</td>
<td>Lo calcula el compilador (<code>new T</code>)</td>
<td>Debes pasar <code>sizeof(T)</code></td>
</tr>
<tr>
<td>En caso de error</td>
<td>Lanza excepción <code>std::bad_alloc</code> (por defecto)</td>
<td>Devuelve <code>NULL</code></td>
</tr>
<tr>
<td>Inicialización</td>
<td>Llama constructor (si lo hay)</td>
<td>No inicializa, solo reserva bytes</td>
</tr>
<tr>
<td>Liberación</td>
<td><code>delete</code> / <code>delete[]</code></td>
<td><code>free</code></td>
</tr>
</tbody>
</table>
<h3 id="codigo-del-ejercicio-heap-alocado-dinamicamente">Código del ejercicio (heap alocado dinámicamente)<a class="headerlink" href="#codigo-del-ejercicio-heap-alocado-dinamicamente" title="Permanent link">&para;</a></h3>
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-123-1"><a id="__codelineno-123-1" name="__codelineno-123-1" href="#__codelineno-123-1"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span>
</span><span id="__span-123-2"><a id="__codelineno-123-2" name="__codelineno-123-2" href="#__codelineno-123-2"></a><span class="k">using</span><span class="w"> </span><span class="k">namespace</span><span class="w"> </span><span class="nn">std</span><span class="p">;</span>
</span><span id="__span-123-3"><a id="__codelineno-123-3" name="__codelineno-123-3" href="#__codelineno-123-3"></a>
</span><span id="__span-123-4"><a id="__codelineno-123-4" name="__codelineno-123-4" href="#__codelineno-123-4"></a><span class="k">struct</span><span class="w"> </span><span class="nc">stComplejo</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-123-5"><a id="__codelineno-123-5" name="__codelineno-123-5" href="#__codelineno-123-5"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">real</span><span class="p">,</span><span class="w"> </span><span class="n">imaginario</span><span class="p">;</span>
</span><span id="__span-123-6"><a id="__codelineno-123-6" name="__codelineno-123-6" href="#__codelineno-123-6"></a><span class="p">};</span>
</span><span id="__span-123-7"><a id="__codelineno-123-7" name="__codelineno-123-7" href="#__codelineno-123-7"></a>
</span><span id="__span-123-8"><a id="__codelineno-123-8" name="__codelineno-123-8" href="#__codelineno-123-8"></a><span class="kt">void</span><span class="w"> </span><span class="nf">imprimir</span><span class="p">(</span><span class="n">stComplejo</span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="n">stComplejo</span><span class="o">*</span><span class="p">);</span>
</span><span id="__span-123-9"><a id="__codelineno-123-9" name="__codelineno-123-9" href="#__codelineno-123-9"></a>
</span><span id="__span-123-10"><a id="__codelineno-123-10" name="__codelineno-123-10" href="#__codelineno-123-10"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-123-11"><a id="__codelineno-123-11" name="__codelineno-123-11" href="#__codelineno-123-11"></a><span class="w">    </span><span class="n">stComplejo</span><span class="o">*</span><span class="w"> </span><span class="n">Complejo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">stComplejo</span><span class="p">;</span><span class="w">                    </span><span class="c1">// Reserva en heap (tipado)</span>
</span><span id="__span-123-12"><a id="__codelineno-123-12" name="__codelineno-123-12" href="#__codelineno-123-12"></a><span class="w">    </span><span class="n">stComplejo</span><span class="o">*</span><span class="w"> </span><span class="n">Complejo2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">stComplejo</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="n">malloc</span><span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="n">stComplejo</span><span class="p">));</span><span class="w"> </span><span class="c1">// Reserva en heap (void*, requiere cast)</span>
</span><span id="__span-123-13"><a id="__codelineno-123-13" name="__codelineno-123-13" href="#__codelineno-123-13"></a>
</span><span id="__span-123-14"><a id="__codelineno-123-14" name="__codelineno-123-14" href="#__codelineno-123-14"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">Complejo2</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nb">NULL</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span><span class="w"> </span><span class="p">}</span><span class="w">                       </span><span class="c1">// malloc puede devolver NULL</span>
</span><span id="__span-123-15"><a id="__codelineno-123-15" name="__codelineno-123-15" href="#__codelineno-123-15"></a>
</span><span id="__span-123-16"><a id="__codelineno-123-16" name="__codelineno-123-16" href="#__codelineno-123-16"></a><span class="w">    </span><span class="n">Complejo</span><span class="o">-&gt;</span><span class="n">real</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w">       </span><span class="n">Complejo</span><span class="o">-&gt;</span><span class="n">imaginario</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span>
</span><span id="__span-123-17"><a id="__codelineno-123-17" name="__codelineno-123-17" href="#__codelineno-123-17"></a><span class="w">    </span><span class="n">Complejo2</span><span class="o">-&gt;</span><span class="n">real</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span><span class="p">;</span><span class="w">      </span><span class="n">Complejo2</span><span class="o">-&gt;</span><span class="n">imaginario</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">4</span><span class="p">;</span>
</span><span id="__span-123-18"><a id="__codelineno-123-18" name="__codelineno-123-18" href="#__codelineno-123-18"></a>
</span><span id="__span-123-19"><a id="__codelineno-123-19" name="__codelineno-123-19" href="#__codelineno-123-19"></a><span class="w">    </span><span class="n">imprimir</span><span class="p">(</span><span class="n">Complejo</span><span class="p">,</span><span class="w"> </span><span class="n">Complejo2</span><span class="p">);</span><span class="w">                            </span><span class="c1">// Pasamos direcciones (punteros)</span>
</span><span id="__span-123-20"><a id="__codelineno-123-20" name="__codelineno-123-20" href="#__codelineno-123-20"></a>
</span><span id="__span-123-21"><a id="__codelineno-123-21" name="__codelineno-123-21" href="#__codelineno-123-21"></a><span class="w">    </span><span class="n">free</span><span class="p">(</span><span class="n">Complejo2</span><span class="p">);</span><span class="w">                                          </span><span class="c1">// Liberar malloc</span>
</span><span id="__span-123-22"><a id="__codelineno-123-22" name="__codelineno-123-22" href="#__codelineno-123-22"></a><span class="w">    </span><span class="k">delete</span><span class="w"> </span><span class="n">Complejo</span><span class="p">;</span><span class="w">                                          </span><span class="c1">// Liberar new</span>
</span><span id="__span-123-23"><a id="__codelineno-123-23" name="__codelineno-123-23" href="#__codelineno-123-23"></a><span class="p">}</span>
</span><span id="__span-123-24"><a id="__codelineno-123-24" name="__codelineno-123-24" href="#__codelineno-123-24"></a>
</span><span id="__span-123-25"><a id="__codelineno-123-25" name="__codelineno-123-25" href="#__codelineno-123-25"></a><span class="kt">void</span><span class="w"> </span><span class="nf">imprimir</span><span class="p">(</span><span class="n">stComplejo</span><span class="o">*</span><span class="w"> </span><span class="n">_Complejo</span><span class="p">,</span><span class="w"> </span><span class="n">stComplejo</span><span class="o">*</span><span class="w"> </span><span class="n">_Complejo2</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-123-26"><a id="__codelineno-123-26" name="__codelineno-123-26" href="#__codelineno-123-26"></a><span class="w">    </span><span class="n">_Complejo</span><span class="o">-&gt;</span><span class="n">real</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
</span><span id="__span-123-27"><a id="__codelineno-123-27" name="__codelineno-123-27" href="#__codelineno-123-27"></a><span class="w">    </span><span class="n">_Complejo</span><span class="o">-&gt;</span><span class="n">imaginario</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span>
</span><span id="__span-123-28"><a id="__codelineno-123-28" name="__codelineno-123-28" href="#__codelineno-123-28"></a><span class="w">    </span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Complejo: &quot;</span><span class="w">  </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">_Complejo</span><span class="o">-&gt;</span><span class="n">real</span><span class="w">  </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot; + &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">_Complejo</span><span class="o">-&gt;</span><span class="n">imaginario</span><span class="w">  </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;i&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">endl</span><span class="p">;</span>
</span><span id="__span-123-29"><a id="__codelineno-123-29" name="__codelineno-123-29" href="#__codelineno-123-29"></a><span class="w">    </span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Complejo2: &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">_Complejo2</span><span class="o">-&gt;</span><span class="n">real</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot; + &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">_Complejo2</span><span class="o">-&gt;</span><span class="n">imaginario</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;i&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">endl</span><span class="p">;</span>
</span><span id="__span-123-30"><a id="__codelineno-123-30" name="__codelineno-123-30" href="#__codelineno-123-30"></a><span class="p">}</span>
</span></code></pre></div>
<h3 id="que-mirar-en-ensamblador">Qué mirar en ensamblador<a class="headerlink" href="#que-mirar-en-ensamblador" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>Llamadas a heap</strong>: <code>call operator new</code> o <code>call malloc</code> → puntero devuelto en <code>RAX</code>.</li>
<li><strong>Chequear NULL</strong> (solo para <code>malloc</code>): comparación del puntero con cero y salto a <code>exit</code>.</li>
<li><strong>Asignaciones a través de punteros</strong>: <code>mov dword ptr [rax], &lt;valor&gt;</code> donde <code>RAX</code> es el puntero devuelto.</li>
<li><strong>Paso por puntero a función</strong>: argumentos en <code>RCX</code> / <code>RDX</code> (Win64); solo viajan 8 bytes por puntero, no toda la estructura.</li>
<li><strong>Liberación</strong>: <code>call free</code> y <code>call operator delete</code> cerca del final.</li>
</ul>
<h3 id="ventajas-de-usar-punteros-en-el-heap">Ventajas de usar punteros en el heap<a class="headerlink" href="#ventajas-de-usar-punteros-en-el-heap" title="Permanent link">&para;</a></h3>
<ul>
<li>Tamaño decidido en runtime (puede depender de entrada del usuario).</li>
<li>Evitas desbordar el stack con estructuras grandes.</li>
<li>Puedes compartir el mismo objeto entre funciones pasando <strong>solo la dirección</strong>.</li>
</ul>
<h3 id="checklist-rapida">Checklist rápida<a class="headerlink" href="#checklist-rapida" title="Permanent link">&para;</a></h3>
<ul>
<li>¿Ves <code>operator new</code> o <code>malloc</code>? → Objeto en heap.</li>
<li>¿Ves <code>free</code>/<code>delete</code> emparejados? → Buen manejo de vida útil.</li>
<li>¿Hay cast <code>(tipo*) malloc(...)</code>? → C indica <code>malloc</code> devolvió <code>void*</code>.</li>
<li>¿Sin cast con <code>new</code>? → C++ lo tipa solo.</li>
</ul>
<hr />
<h3 id="analisis-del-ensamblador-de-main-heap-dinamico">Análisis del ensamblador de <code>main()</code> (heap dinámico)<a class="headerlink" href="#analisis-del-ensamblador-de-main-heap-dinamico" title="Permanent link">&para;</a></h3>
<div class="language-asm highlight"><pre><span></span><code><span id="__span-124-1"><a id="__codelineno-124-1" name="__codelineno-124-1" href="#__codelineno-124-1"></a><span class="c1">; Prototipo: int __fastcall main(int argc, const char **argv, const char **envp)</span>
</span><span id="__span-124-2"><a id="__codelineno-124-2" name="__codelineno-124-2" href="#__codelineno-124-2"></a><span class="nf">sub</span><span class="w">     </span><span class="no">rsp</span><span class="p">,</span><span class="w"> </span><span class="mi">58</span><span class="no">h</span><span class="w">                 </span><span class="c1">; Reserva stack (locals: punteros/estado)</span>
</span><span id="__span-124-3"><a id="__codelineno-124-3" name="__codelineno-124-3" href="#__codelineno-124-3"></a>
</span><span id="__span-124-4"><a id="__codelineno-124-4" name="__codelineno-124-4" href="#__codelineno-124-4"></a><span class="nf">mov</span><span class="w">     </span><span class="no">ecx</span><span class="p">,</span><span class="w"> </span><span class="mi">8</span><span class="w">                   </span><span class="c1">; size = sizeof(stComplejo)</span>
</span><span id="__span-124-5"><a id="__codelineno-124-5" name="__codelineno-124-5" href="#__codelineno-124-5"></a><span class="nf">call</span><span class="w">    </span><span class="no">operator</span><span class="w"> </span><span class="no">new</span><span class="p">(</span><span class="no">unsigned</span><span class="w"> </span><span class="no">__int64</span><span class="p">)</span>
</span><span id="__span-124-6"><a id="__codelineno-124-6" name="__codelineno-124-6" href="#__codelineno-124-6"></a><span class="nf">mov</span><span class="w">     </span><span class="p">[</span><span class="no">rsp</span><span class="err">+</span><span class="no">Complejo</span><span class="p">],</span><span class="w"> </span><span class="no">rax</span><span class="w">      </span><span class="c1">; Complejo = puntero devuelto por new</span>
</span><span id="__span-124-7"><a id="__codelineno-124-7" name="__codelineno-124-7" href="#__codelineno-124-7"></a>
</span><span id="__span-124-8"><a id="__codelineno-124-8" name="__codelineno-124-8" href="#__codelineno-124-8"></a><span class="nf">mov</span><span class="w">     </span><span class="no">ecx</span><span class="p">,</span><span class="w"> </span><span class="mi">8</span><span class="w">                   </span><span class="c1">; size = sizeof(stComplejo)</span>
</span><span id="__span-124-9"><a id="__codelineno-124-9" name="__codelineno-124-9" href="#__codelineno-124-9"></a><span class="nf">call</span><span class="w">    </span><span class="no">__imp_malloc</span><span class="w">             </span><span class="c1">; malloc(8)</span>
</span><span id="__span-124-10"><a id="__codelineno-124-10" name="__codelineno-124-10" href="#__codelineno-124-10"></a><span class="nf">mov</span><span class="w">     </span><span class="p">[</span><span class="no">rsp</span><span class="err">+</span><span class="no">Complejo2</span><span class="p">],</span><span class="w"> </span><span class="no">rax</span><span class="w">     </span><span class="c1">; Complejo2 = puntero devuelto por malloc</span>
</span><span id="__span-124-11"><a id="__codelineno-124-11" name="__codelineno-124-11" href="#__codelineno-124-11"></a>
</span><span id="__span-124-12"><a id="__codelineno-124-12" name="__codelineno-124-12" href="#__codelineno-124-12"></a><span class="nf">cmp</span><span class="w">     </span><span class="p">[</span><span class="no">rsp</span><span class="err">+</span><span class="no">Complejo2</span><span class="p">],</span><span class="w"> </span><span class="mi">0</span><span class="w">       </span><span class="c1">; ¿malloc devolvió NULL?</span>
</span><span id="__span-124-13"><a id="__codelineno-124-13" name="__codelineno-124-13" href="#__codelineno-124-13"></a><span class="nf">jnz</span><span class="w">     </span><span class="no">short</span><span class="w"> </span><span class="no">ok_malloc</span>
</span><span id="__span-124-14"><a id="__codelineno-124-14" name="__codelineno-124-14" href="#__codelineno-124-14"></a><span class="nf">mov</span><span class="w">     </span><span class="no">ecx</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span>
</span><span id="__span-124-15"><a id="__codelineno-124-15" name="__codelineno-124-15" href="#__codelineno-124-15"></a><span class="nf">call</span><span class="w">    </span><span class="no">__imp_exit</span><span class="w">               </span><span class="c1">; exit(1) si falla malloc</span>
</span><span id="__span-124-16"><a id="__codelineno-124-16" name="__codelineno-124-16" href="#__codelineno-124-16"></a>
</span><span id="__span-124-17"><a id="__codelineno-124-17" name="__codelineno-124-17" href="#__codelineno-124-17"></a><span class="nl">ok_malloc:</span>
</span><span id="__span-124-18"><a id="__codelineno-124-18" name="__codelineno-124-18" href="#__codelineno-124-18"></a><span class="nf">mov</span><span class="w">     </span><span class="no">rax</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="no">rsp</span><span class="err">+</span><span class="no">Complejo</span><span class="p">]</span>
</span><span id="__span-124-19"><a id="__codelineno-124-19" name="__codelineno-124-19" href="#__codelineno-124-19"></a><span class="nf">mov</span><span class="w">     </span><span class="no">dword</span><span class="w"> </span><span class="no">ptr</span><span class="w"> </span><span class="p">[</span><span class="no">rax</span><span class="p">],</span><span class="w"> </span><span class="mi">1</span><span class="w">       </span><span class="c1">; Complejo-&gt;real = 1</span>
</span><span id="__span-124-20"><a id="__codelineno-124-20" name="__codelineno-124-20" href="#__codelineno-124-20"></a><span class="nf">mov</span><span class="w">     </span><span class="no">rax</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="no">rsp</span><span class="err">+</span><span class="no">Complejo</span><span class="p">]</span>
</span><span id="__span-124-21"><a id="__codelineno-124-21" name="__codelineno-124-21" href="#__codelineno-124-21"></a><span class="nf">mov</span><span class="w">     </span><span class="no">dword</span><span class="w"> </span><span class="no">ptr</span><span class="w"> </span><span class="p">[</span><span class="no">rax</span><span class="err">+</span><span class="mi">4</span><span class="p">],</span><span class="w"> </span><span class="mi">2</span><span class="w">     </span><span class="c1">; Complejo-&gt;imaginario = 2</span>
</span><span id="__span-124-22"><a id="__codelineno-124-22" name="__codelineno-124-22" href="#__codelineno-124-22"></a>
</span><span id="__span-124-23"><a id="__codelineno-124-23" name="__codelineno-124-23" href="#__codelineno-124-23"></a><span class="nf">mov</span><span class="w">     </span><span class="no">rax</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="no">rsp</span><span class="err">+</span><span class="no">Complejo2</span><span class="p">]</span>
</span><span id="__span-124-24"><a id="__codelineno-124-24" name="__codelineno-124-24" href="#__codelineno-124-24"></a><span class="nf">mov</span><span class="w">     </span><span class="no">dword</span><span class="w"> </span><span class="no">ptr</span><span class="w"> </span><span class="p">[</span><span class="no">rax</span><span class="p">],</span><span class="w"> </span><span class="mi">3</span><span class="w">       </span><span class="c1">; Complejo2-&gt;real = 3</span>
</span><span id="__span-124-25"><a id="__codelineno-124-25" name="__codelineno-124-25" href="#__codelineno-124-25"></a><span class="nf">mov</span><span class="w">     </span><span class="no">rax</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="no">rsp</span><span class="err">+</span><span class="no">Complejo2</span><span class="p">]</span>
</span><span id="__span-124-26"><a id="__codelineno-124-26" name="__codelineno-124-26" href="#__codelineno-124-26"></a><span class="nf">mov</span><span class="w">     </span><span class="no">dword</span><span class="w"> </span><span class="no">ptr</span><span class="w"> </span><span class="p">[</span><span class="no">rax</span><span class="err">+</span><span class="mi">4</span><span class="p">],</span><span class="w"> </span><span class="mi">4</span><span class="w">     </span><span class="c1">; Complejo2-&gt;imaginario = 4</span>
</span><span id="__span-124-27"><a id="__codelineno-124-27" name="__codelineno-124-27" href="#__codelineno-124-27"></a>
</span><span id="__span-124-28"><a id="__codelineno-124-28" name="__codelineno-124-28" href="#__codelineno-124-28"></a><span class="nf">mov</span><span class="w">     </span><span class="no">rdx</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="no">rsp</span><span class="err">+</span><span class="no">Complejo2</span><span class="p">]</span><span class="w">     </span><span class="c1">; 2º parámetro (Win64): _Complejo2</span>
</span><span id="__span-124-29"><a id="__codelineno-124-29" name="__codelineno-124-29" href="#__codelineno-124-29"></a><span class="nf">mov</span><span class="w">     </span><span class="no">rcx</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="no">rsp</span><span class="err">+</span><span class="no">Complejo</span><span class="p">]</span><span class="w">      </span><span class="c1">; 1º parámetro: _Complejo</span>
</span><span id="__span-124-30"><a id="__codelineno-124-30" name="__codelineno-124-30" href="#__codelineno-124-30"></a><span class="nf">call</span><span class="w">    </span><span class="no">imprimir</span><span class="p">(</span><span class="no">stComplejo</span><span class="w"> </span><span class="p">*,</span><span class="w"> </span><span class="no">stComplejo</span><span class="w"> </span><span class="p">*)</span>
</span><span id="__span-124-31"><a id="__codelineno-124-31" name="__codelineno-124-31" href="#__codelineno-124-31"></a>
</span><span id="__span-124-32"><a id="__codelineno-124-32" name="__codelineno-124-32" href="#__codelineno-124-32"></a><span class="nf">mov</span><span class="w">     </span><span class="no">rcx</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="no">rsp</span><span class="err">+</span><span class="no">Complejo2</span><span class="p">]</span>
</span><span id="__span-124-33"><a id="__codelineno-124-33" name="__codelineno-124-33" href="#__codelineno-124-33"></a><span class="nf">call</span><span class="w">    </span><span class="no">__imp_free</span><span class="w">               </span><span class="c1">; free(Complejo2)</span>
</span><span id="__span-124-34"><a id="__codelineno-124-34" name="__codelineno-124-34" href="#__codelineno-124-34"></a>
</span><span id="__span-124-35"><a id="__codelineno-124-35" name="__codelineno-124-35" href="#__codelineno-124-35"></a><span class="nf">mov</span><span class="w">     </span><span class="no">rax</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="no">rsp</span><span class="err">+</span><span class="no">Complejo</span><span class="p">]</span>
</span><span id="__span-124-36"><a id="__codelineno-124-36" name="__codelineno-124-36" href="#__codelineno-124-36"></a><span class="nf">mov</span><span class="w">     </span><span class="p">[</span><span class="no">rsp</span><span class="err">+</span><span class="no">block</span><span class="p">],</span><span class="w"> </span><span class="no">rax</span><span class="w">         </span><span class="c1">; block = Complejo</span>
</span><span id="__span-124-37"><a id="__codelineno-124-37" name="__codelineno-124-37" href="#__codelineno-124-37"></a><span class="nf">mov</span><span class="w">     </span><span class="no">edx</span><span class="p">,</span><span class="w"> </span><span class="mi">8</span><span class="w">                   </span><span class="c1">; tamaño para delete</span>
</span><span id="__span-124-38"><a id="__codelineno-124-38" name="__codelineno-124-38" href="#__codelineno-124-38"></a><span class="nf">mov</span><span class="w">     </span><span class="no">rcx</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="no">rsp</span><span class="err">+</span><span class="no">block</span><span class="p">]</span>
</span><span id="__span-124-39"><a id="__codelineno-124-39" name="__codelineno-124-39" href="#__codelineno-124-39"></a><span class="nf">call</span><span class="w">    </span><span class="no">operator</span><span class="w"> </span><span class="no">delete</span><span class="p">(</span><span class="no">void</span><span class="w"> </span><span class="p">*,</span><span class="w"> </span><span class="no">unsigned</span><span class="w"> </span><span class="no">__int64</span><span class="p">)</span><span class="w"> </span><span class="c1">; delete Complejo, size-aware</span>
</span><span id="__span-124-40"><a id="__codelineno-124-40" name="__codelineno-124-40" href="#__codelineno-124-40"></a>
</span><span id="__span-124-41"><a id="__codelineno-124-41" name="__codelineno-124-41" href="#__codelineno-124-41"></a><span class="nf">cmp</span><span class="w">     </span><span class="p">[</span><span class="no">rsp</span><span class="err">+</span><span class="no">block</span><span class="p">],</span><span class="w"> </span><span class="mi">0</span>
</span><span id="__span-124-42"><a id="__codelineno-124-42" name="__codelineno-124-42" href="#__codelineno-124-42"></a><span class="nf">jnz</span><span class="w">     </span><span class="no">short</span><span class="w"> </span><span class="no">set_status</span><span class="w">         </span><span class="c1">; si había puntero, marca estado</span>
</span><span id="__span-124-43"><a id="__codelineno-124-43" name="__codelineno-124-43" href="#__codelineno-124-43"></a><span class="nf">mov</span><span class="w">     </span><span class="p">[</span><span class="no">rsp</span><span class="err">+</span><span class="no">var_18</span><span class="p">],</span><span class="w"> </span><span class="mi">0</span>
</span><span id="__span-124-44"><a id="__codelineno-124-44" name="__codelineno-124-44" href="#__codelineno-124-44"></a><span class="nf">jmp</span><span class="w">     </span><span class="no">short</span><span class="w"> </span><span class="no">end_status</span>
</span><span id="__span-124-45"><a id="__codelineno-124-45" name="__codelineno-124-45" href="#__codelineno-124-45"></a>
</span><span id="__span-124-46"><a id="__codelineno-124-46" name="__codelineno-124-46" href="#__codelineno-124-46"></a><span class="nl">set_status:</span>
</span><span id="__span-124-47"><a id="__codelineno-124-47" name="__codelineno-124-47" href="#__codelineno-124-47"></a><span class="nf">mov</span><span class="w">     </span><span class="p">[</span><span class="no">rsp</span><span class="err">+</span><span class="no">Complejo</span><span class="p">],</span><span class="w"> </span><span class="mi">8123</span><span class="no">h</span><span class="w">    </span><span class="c1">; patrón/estado (diagnóstico)</span>
</span><span id="__span-124-48"><a id="__codelineno-124-48" name="__codelineno-124-48" href="#__codelineno-124-48"></a><span class="nf">mov</span><span class="w">     </span><span class="no">rax</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="no">rsp</span><span class="err">+</span><span class="no">Complejo</span><span class="p">]</span>
</span><span id="__span-124-49"><a id="__codelineno-124-49" name="__codelineno-124-49" href="#__codelineno-124-49"></a><span class="nf">mov</span><span class="w">     </span><span class="p">[</span><span class="no">rsp</span><span class="err">+</span><span class="no">var_18</span><span class="p">],</span><span class="w"> </span><span class="no">rax</span><span class="w">        </span><span class="c1">; guarda 0x8123 como estado</span>
</span><span id="__span-124-50"><a id="__codelineno-124-50" name="__codelineno-124-50" href="#__codelineno-124-50"></a>
</span><span id="__span-124-51"><a id="__codelineno-124-51" name="__codelineno-124-51" href="#__codelineno-124-51"></a><span class="nl">end_status:</span>
</span><span id="__span-124-52"><a id="__codelineno-124-52" name="__codelineno-124-52" href="#__codelineno-124-52"></a><span class="nf">xor</span><span class="w">     </span><span class="no">eax</span><span class="p">,</span><span class="w"> </span><span class="no">eax</span><span class="w">                 </span><span class="c1">; return 0</span>
</span><span id="__span-124-53"><a id="__codelineno-124-53" name="__codelineno-124-53" href="#__codelineno-124-53"></a><span class="nf">add</span><span class="w">     </span><span class="no">rsp</span><span class="p">,</span><span class="w"> </span><span class="mi">58</span><span class="no">h</span>
</span><span id="__span-124-54"><a id="__codelineno-124-54" name="__codelineno-124-54" href="#__codelineno-124-54"></a><span class="nf">retn</span>
</span></code></pre></div>
<p>Puntos clave de reconocimiento:
- <code>operator new</code> y <code>malloc</code> para reservar en heap; puntero en <code>RAX</code>.
- Chequeo de <code>NULL</code> y <code>exit(1)</code> solo para <code>malloc</code>.
- Escrituras a través de puntero (<code>[rax]</code>, <code>[rax+4]</code>) para campos <code>real</code> e <code>imaginario</code>.
- Paso de parámetros en Win64: <code>RCX</code> primer puntero, <code>RDX</code> segundo puntero.
- Liberación emparejada: <code>free</code> para <code>malloc</code>, <code>operator delete</code> para <code>new</code>.
- Bloque de “estado” (<code>8123h</code>) tras <code>delete</code>: relleno/diagnóstico del compilador; no afecta la lógica.</p>
<h3 id="funcion-imprimir-parametros-escrituras-y-cout">Función <code>imprimir()</code> (parámetros, escrituras y cout)<a class="headerlink" href="#funcion-imprimir-parametros-escrituras-y-cout" title="Permanent link">&para;</a></h3>
<div class="language-asm highlight"><pre><span></span><code><span id="__span-125-1"><a id="__codelineno-125-1" name="__codelineno-125-1" href="#__codelineno-125-1"></a><span class="c1">; Firma: void __fastcall imprimir(stComplejo* _Complejo, stComplejo* _Complejo2)</span>
</span><span id="__span-125-2"><a id="__codelineno-125-2" name="__codelineno-125-2" href="#__codelineno-125-2"></a><span class="c1">; Prologue: guarda parámetros en stack y reserva espacio</span>
</span><span id="__span-125-3"><a id="__codelineno-125-3" name="__codelineno-125-3" href="#__codelineno-125-3"></a><span class="nf">mov</span><span class="w">     </span><span class="p">[</span><span class="no">rsp</span><span class="err">+</span><span class="no">_Complejo2</span><span class="p">],</span><span class="w"> </span><span class="no">rdx</span>
</span><span id="__span-125-4"><a id="__codelineno-125-4" name="__codelineno-125-4" href="#__codelineno-125-4"></a><span class="nf">mov</span><span class="w">     </span><span class="p">[</span><span class="no">rsp</span><span class="err">+</span><span class="no">_Complejo</span><span class="p">],</span><span class="w"> </span><span class="no">rcx</span>
</span><span id="__span-125-5"><a id="__codelineno-125-5" name="__codelineno-125-5" href="#__codelineno-125-5"></a><span class="nf">sub</span><span class="w">     </span><span class="no">rsp</span><span class="p">,</span><span class="w"> </span><span class="mi">68</span><span class="no">h</span>
</span><span id="__span-125-6"><a id="__codelineno-125-6" name="__codelineno-125-6" href="#__codelineno-125-6"></a>
</span><span id="__span-125-7"><a id="__codelineno-125-7" name="__codelineno-125-7" href="#__codelineno-125-7"></a><span class="c1">; Escrituras: _Complejo-&gt;real = 1; _Complejo-&gt;imaginario = 2</span>
</span><span id="__span-125-8"><a id="__codelineno-125-8" name="__codelineno-125-8" href="#__codelineno-125-8"></a><span class="nf">mov</span><span class="w">     </span><span class="no">rax</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="no">rsp</span><span class="err">+</span><span class="mi">68</span><span class="no">h</span><span class="err">+</span><span class="no">_Complejo</span><span class="p">]</span>
</span><span id="__span-125-9"><a id="__codelineno-125-9" name="__codelineno-125-9" href="#__codelineno-125-9"></a><span class="nf">mov</span><span class="w">     </span><span class="no">dword</span><span class="w"> </span><span class="no">ptr</span><span class="w"> </span><span class="p">[</span><span class="no">rax</span><span class="p">],</span><span class="w"> </span><span class="mi">1</span>
</span><span id="__span-125-10"><a id="__codelineno-125-10" name="__codelineno-125-10" href="#__codelineno-125-10"></a><span class="nf">mov</span><span class="w">     </span><span class="no">rax</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="no">rsp</span><span class="err">+</span><span class="mi">68</span><span class="no">h</span><span class="err">+</span><span class="no">_Complejo</span><span class="p">]</span>
</span><span id="__span-125-11"><a id="__codelineno-125-11" name="__codelineno-125-11" href="#__codelineno-125-11"></a><span class="nf">mov</span><span class="w">     </span><span class="no">dword</span><span class="w"> </span><span class="no">ptr</span><span class="w"> </span><span class="p">[</span><span class="no">rax</span><span class="err">+</span><span class="mi">4</span><span class="p">],</span><span class="w"> </span><span class="mi">2</span>
</span><span id="__span-125-12"><a id="__codelineno-125-12" name="__codelineno-125-12" href="#__codelineno-125-12"></a>
</span><span id="__span-125-13"><a id="__codelineno-125-13" name="__codelineno-125-13" href="#__codelineno-125-13"></a><span class="c1">; cout &lt;&lt; &quot;Complejo: &quot;</span>
</span><span id="__span-125-14"><a id="__codelineno-125-14" name="__codelineno-125-14" href="#__codelineno-125-14"></a><span class="nf">lea</span><span class="w">     </span><span class="no">rdx</span><span class="p">,</span><span class="w"> </span><span class="no">_Val</span><span class="w">                         </span><span class="c1">; puntero a literal</span>
</span><span id="__span-125-15"><a id="__codelineno-125-15" name="__codelineno-125-15" href="#__codelineno-125-15"></a><span class="nf">mov</span><span class="w">     </span><span class="no">rcx</span><span class="p">,</span><span class="w"> </span><span class="no">cs</span><span class="p">:</span><span class="no">std</span><span class="p">::</span><span class="no">cout</span><span class="w">                 </span><span class="c1">; ostream</span>
</span><span id="__span-125-16"><a id="__codelineno-125-16" name="__codelineno-125-16" href="#__codelineno-125-16"></a><span class="nf">call</span><span class="w">    </span><span class="no">std</span><span class="p">::</span><span class="no">operator</span><span class="err">&lt;&lt;&lt;</span><span class="no">...</span><span class="err">&gt;</span><span class="p">(</span><span class="no">std</span><span class="p">::</span><span class="no">ostream</span><span class="err">&amp;</span><span class="p">,</span><span class="w"> </span><span class="no">char</span><span class="w"> </span><span class="no">const</span><span class="p">*)</span>
</span><span id="__span-125-17"><a id="__codelineno-125-17" name="__codelineno-125-17" href="#__codelineno-125-17"></a><span class="nf">mov</span><span class="w">     </span><span class="p">[</span><span class="no">rsp</span><span class="err">+</span><span class="mi">68</span><span class="no">h</span><span class="err">+</span><span class="no">var_38</span><span class="p">],</span><span class="w"> </span><span class="no">rax</span><span class="w">             </span><span class="c1">; guardar ostream</span>
</span><span id="__span-125-18"><a id="__codelineno-125-18" name="__codelineno-125-18" href="#__codelineno-125-18"></a>
</span><span id="__span-125-19"><a id="__codelineno-125-19" name="__codelineno-125-19" href="#__codelineno-125-19"></a><span class="c1">; cout &lt;&lt; _Complejo-&gt;real</span>
</span><span id="__span-125-20"><a id="__codelineno-125-20" name="__codelineno-125-20" href="#__codelineno-125-20"></a><span class="nf">mov</span><span class="w">     </span><span class="no">rax</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="no">rsp</span><span class="err">+</span><span class="mi">68</span><span class="no">h</span><span class="err">+</span><span class="no">_Complejo</span><span class="p">]</span>
</span><span id="__span-125-21"><a id="__codelineno-125-21" name="__codelineno-125-21" href="#__codelineno-125-21"></a><span class="nf">mov</span><span class="w">     </span><span class="no">eax</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="no">rax</span><span class="p">]</span><span class="w">                        </span><span class="c1">; cargar real</span>
</span><span id="__span-125-22"><a id="__codelineno-125-22" name="__codelineno-125-22" href="#__codelineno-125-22"></a><span class="nf">mov</span><span class="w">     </span><span class="p">[</span><span class="no">rsp</span><span class="err">+</span><span class="mi">68</span><span class="no">h</span><span class="err">+</span><span class="no">var_48</span><span class="p">],</span><span class="w"> </span><span class="no">eax</span>
</span><span id="__span-125-23"><a id="__codelineno-125-23" name="__codelineno-125-23" href="#__codelineno-125-23"></a><span class="nf">mov</span><span class="w">     </span><span class="no">edx</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="no">rsp</span><span class="err">+</span><span class="mi">68</span><span class="no">h</span><span class="err">+</span><span class="no">var_48</span><span class="p">]</span>
</span><span id="__span-125-24"><a id="__codelineno-125-24" name="__codelineno-125-24" href="#__codelineno-125-24"></a><span class="nf">mov</span><span class="w">     </span><span class="no">rcx</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="no">rsp</span><span class="err">+</span><span class="mi">68</span><span class="no">h</span><span class="err">+</span><span class="no">var_38</span><span class="p">]</span>
</span><span id="__span-125-25"><a id="__codelineno-125-25" name="__codelineno-125-25" href="#__codelineno-125-25"></a><span class="nf">call</span><span class="w">    </span><span class="no">std</span><span class="p">::</span><span class="no">ostream</span><span class="p">::</span><span class="no">operator</span><span class="err">&lt;&lt;</span><span class="p">(</span><span class="no">int</span><span class="p">)</span>
</span><span id="__span-125-26"><a id="__codelineno-125-26" name="__codelineno-125-26" href="#__codelineno-125-26"></a>
</span><span id="__span-125-27"><a id="__codelineno-125-27" name="__codelineno-125-27" href="#__codelineno-125-27"></a><span class="c1">; cout &lt;&lt; &quot; + &quot;</span>
</span><span id="__span-125-28"><a id="__codelineno-125-28" name="__codelineno-125-28" href="#__codelineno-125-28"></a><span class="nf">lea</span><span class="w">     </span><span class="no">rdx</span><span class="p">,</span><span class="w"> </span><span class="no">asc_1400032C4</span>
</span><span id="__span-125-29"><a id="__codelineno-125-29" name="__codelineno-125-29" href="#__codelineno-125-29"></a><span class="nf">mov</span><span class="w">     </span><span class="no">rcx</span><span class="p">,</span><span class="w"> </span><span class="no">rax</span>
</span><span id="__span-125-30"><a id="__codelineno-125-30" name="__codelineno-125-30" href="#__codelineno-125-30"></a><span class="nf">call</span><span class="w">    </span><span class="no">std</span><span class="p">::</span><span class="no">operator</span><span class="err">&lt;&lt;&lt;</span><span class="no">...</span><span class="err">&gt;</span><span class="p">(</span><span class="no">std</span><span class="p">::</span><span class="no">ostream</span><span class="err">&amp;</span><span class="p">,</span><span class="w"> </span><span class="no">char</span><span class="w"> </span><span class="no">const</span><span class="p">*)</span>
</span><span id="__span-125-31"><a id="__codelineno-125-31" name="__codelineno-125-31" href="#__codelineno-125-31"></a><span class="nf">mov</span><span class="w">     </span><span class="p">[</span><span class="no">rsp</span><span class="err">+</span><span class="mi">68</span><span class="no">h</span><span class="err">+</span><span class="no">var_30</span><span class="p">],</span><span class="w"> </span><span class="no">rax</span>
</span><span id="__span-125-32"><a id="__codelineno-125-32" name="__codelineno-125-32" href="#__codelineno-125-32"></a>
</span><span id="__span-125-33"><a id="__codelineno-125-33" name="__codelineno-125-33" href="#__codelineno-125-33"></a><span class="c1">; cout &lt;&lt; _Complejo-&gt;imaginario</span>
</span><span id="__span-125-34"><a id="__codelineno-125-34" name="__codelineno-125-34" href="#__codelineno-125-34"></a><span class="nf">mov</span><span class="w">     </span><span class="no">rax</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="no">rsp</span><span class="err">+</span><span class="mi">68</span><span class="no">h</span><span class="err">+</span><span class="no">_Complejo</span><span class="p">]</span>
</span><span id="__span-125-35"><a id="__codelineno-125-35" name="__codelineno-125-35" href="#__codelineno-125-35"></a><span class="nf">mov</span><span class="w">     </span><span class="no">eax</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="no">rax</span><span class="err">+</span><span class="mi">4</span><span class="p">]</span>
</span><span id="__span-125-36"><a id="__codelineno-125-36" name="__codelineno-125-36" href="#__codelineno-125-36"></a><span class="nf">mov</span><span class="w">     </span><span class="p">[</span><span class="no">rsp</span><span class="err">+</span><span class="mi">68</span><span class="no">h</span><span class="err">+</span><span class="no">var_44</span><span class="p">],</span><span class="w"> </span><span class="no">eax</span>
</span><span id="__span-125-37"><a id="__codelineno-125-37" name="__codelineno-125-37" href="#__codelineno-125-37"></a><span class="nf">mov</span><span class="w">     </span><span class="no">edx</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="no">rsp</span><span class="err">+</span><span class="mi">68</span><span class="no">h</span><span class="err">+</span><span class="no">var_44</span><span class="p">]</span>
</span><span id="__span-125-38"><a id="__codelineno-125-38" name="__codelineno-125-38" href="#__codelineno-125-38"></a><span class="nf">mov</span><span class="w">     </span><span class="no">rcx</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="no">rsp</span><span class="err">+</span><span class="mi">68</span><span class="no">h</span><span class="err">+</span><span class="no">var_30</span><span class="p">]</span>
</span><span id="__span-125-39"><a id="__codelineno-125-39" name="__codelineno-125-39" href="#__codelineno-125-39"></a><span class="nf">call</span><span class="w">    </span><span class="no">std</span><span class="p">::</span><span class="no">ostream</span><span class="p">::</span><span class="no">operator</span><span class="err">&lt;&lt;</span><span class="p">(</span><span class="no">int</span><span class="p">)</span>
</span><span id="__span-125-40"><a id="__codelineno-125-40" name="__codelineno-125-40" href="#__codelineno-125-40"></a>
</span><span id="__span-125-41"><a id="__codelineno-125-41" name="__codelineno-125-41" href="#__codelineno-125-41"></a><span class="c1">; cout &lt;&lt; &quot;i&quot; &lt;&lt; std::endl</span>
</span><span id="__span-125-42"><a id="__codelineno-125-42" name="__codelineno-125-42" href="#__codelineno-125-42"></a><span class="nf">lea</span><span class="w">     </span><span class="no">rdx</span><span class="p">,</span><span class="w"> </span><span class="no">aI_0</span>
</span><span id="__span-125-43"><a id="__codelineno-125-43" name="__codelineno-125-43" href="#__codelineno-125-43"></a><span class="nf">mov</span><span class="w">     </span><span class="no">rcx</span><span class="p">,</span><span class="w"> </span><span class="no">rax</span>
</span><span id="__span-125-44"><a id="__codelineno-125-44" name="__codelineno-125-44" href="#__codelineno-125-44"></a><span class="nf">call</span><span class="w">    </span><span class="no">std</span><span class="p">::</span><span class="no">operator</span><span class="err">&lt;&lt;&lt;</span><span class="no">...</span><span class="err">&gt;</span><span class="p">(</span><span class="no">std</span><span class="p">::</span><span class="no">ostream</span><span class="err">&amp;</span><span class="p">,</span><span class="w"> </span><span class="no">char</span><span class="w"> </span><span class="no">const</span><span class="p">*)</span>
</span><span id="__span-125-45"><a id="__codelineno-125-45" name="__codelineno-125-45" href="#__codelineno-125-45"></a><span class="nf">mov</span><span class="w">     </span><span class="p">[</span><span class="no">rsp</span><span class="err">+</span><span class="mi">68</span><span class="no">h</span><span class="err">+</span><span class="no">var_28</span><span class="p">],</span><span class="w"> </span><span class="no">rax</span>
</span><span id="__span-125-46"><a id="__codelineno-125-46" name="__codelineno-125-46" href="#__codelineno-125-46"></a><span class="nf">lea</span><span class="w">     </span><span class="no">rdx</span><span class="p">,</span><span class="w"> </span><span class="no">std</span><span class="p">::</span><span class="no">endl</span><span class="err">&lt;</span><span class="no">char</span><span class="p">,</span><span class="no">std</span><span class="p">::</span><span class="no">char_traits</span><span class="err">&lt;</span><span class="no">char</span><span class="err">&gt;&gt;</span><span class="p">(</span><span class="no">std</span><span class="p">::</span><span class="no">ostream</span><span class="w"> </span><span class="err">&amp;</span><span class="p">)</span>
</span><span id="__span-125-47"><a id="__codelineno-125-47" name="__codelineno-125-47" href="#__codelineno-125-47"></a><span class="nf">mov</span><span class="w">     </span><span class="no">rcx</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="no">rsp</span><span class="err">+</span><span class="mi">68</span><span class="no">h</span><span class="err">+</span><span class="no">var_28</span><span class="p">]</span>
</span><span id="__span-125-48"><a id="__codelineno-125-48" name="__codelineno-125-48" href="#__codelineno-125-48"></a><span class="nf">call</span><span class="w">    </span><span class="no">std</span><span class="p">::</span><span class="no">ostream</span><span class="p">::</span><span class="no">operator</span><span class="err">&lt;&lt;</span><span class="p">(</span><span class="no">std</span><span class="p">::</span><span class="no">ostream</span><span class="err">&amp;</span><span class="w"> </span><span class="p">(*)(</span><span class="no">std</span><span class="p">::</span><span class="no">ostream</span><span class="err">&amp;</span><span class="p">))</span>
</span><span id="__span-125-49"><a id="__codelineno-125-49" name="__codelineno-125-49" href="#__codelineno-125-49"></a>
</span><span id="__span-125-50"><a id="__codelineno-125-50" name="__codelineno-125-50" href="#__codelineno-125-50"></a><span class="c1">; Repite patrón para _Complejo2</span>
</span><span id="__span-125-51"><a id="__codelineno-125-51" name="__codelineno-125-51" href="#__codelineno-125-51"></a><span class="nf">lea</span><span class="w">     </span><span class="no">rdx</span><span class="p">,</span><span class="w"> </span><span class="no">aComplejo2</span>
</span><span id="__span-125-52"><a id="__codelineno-125-52" name="__codelineno-125-52" href="#__codelineno-125-52"></a><span class="nf">mov</span><span class="w">     </span><span class="no">rcx</span><span class="p">,</span><span class="w"> </span><span class="no">cs</span><span class="p">:</span><span class="no">std</span><span class="p">::</span><span class="no">cout</span>
</span><span id="__span-125-53"><a id="__codelineno-125-53" name="__codelineno-125-53" href="#__codelineno-125-53"></a><span class="nf">call</span><span class="w">    </span><span class="no">std</span><span class="p">::</span><span class="no">operator</span><span class="err">&lt;&lt;&lt;</span><span class="no">...</span><span class="err">&gt;</span><span class="p">(</span><span class="no">std</span><span class="p">::</span><span class="no">ostream</span><span class="err">&amp;</span><span class="p">,</span><span class="w"> </span><span class="no">char</span><span class="w"> </span><span class="no">const</span><span class="p">*)</span>
</span><span id="__span-125-54"><a id="__codelineno-125-54" name="__codelineno-125-54" href="#__codelineno-125-54"></a><span class="nf">mov</span><span class="w">     </span><span class="p">[</span><span class="no">rsp</span><span class="err">+</span><span class="mi">68</span><span class="no">h</span><span class="err">+</span><span class="no">var_20</span><span class="p">],</span><span class="w"> </span><span class="no">rax</span>
</span><span id="__span-125-55"><a id="__codelineno-125-55" name="__codelineno-125-55" href="#__codelineno-125-55"></a><span class="nf">mov</span><span class="w">     </span><span class="no">rax</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="no">rsp</span><span class="err">+</span><span class="mi">68</span><span class="no">h</span><span class="err">+</span><span class="no">_Complejo2</span><span class="p">]</span>
</span><span id="__span-125-56"><a id="__codelineno-125-56" name="__codelineno-125-56" href="#__codelineno-125-56"></a><span class="nf">mov</span><span class="w">     </span><span class="no">eax</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="no">rax</span><span class="p">]</span>
</span><span id="__span-125-57"><a id="__codelineno-125-57" name="__codelineno-125-57" href="#__codelineno-125-57"></a><span class="nf">mov</span><span class="w">     </span><span class="p">[</span><span class="no">rsp</span><span class="err">+</span><span class="mi">68</span><span class="no">h</span><span class="err">+</span><span class="no">var_40</span><span class="p">],</span><span class="w"> </span><span class="no">eax</span>
</span><span id="__span-125-58"><a id="__codelineno-125-58" name="__codelineno-125-58" href="#__codelineno-125-58"></a><span class="nf">mov</span><span class="w">     </span><span class="no">edx</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="no">rsp</span><span class="err">+</span><span class="mi">68</span><span class="no">h</span><span class="err">+</span><span class="no">var_40</span><span class="p">]</span>
</span><span id="__span-125-59"><a id="__codelineno-125-59" name="__codelineno-125-59" href="#__codelineno-125-59"></a><span class="nf">mov</span><span class="w">     </span><span class="no">rcx</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="no">rsp</span><span class="err">+</span><span class="mi">68</span><span class="no">h</span><span class="err">+</span><span class="no">var_20</span><span class="p">]</span>
</span><span id="__span-125-60"><a id="__codelineno-125-60" name="__codelineno-125-60" href="#__codelineno-125-60"></a><span class="nf">call</span><span class="w">    </span><span class="no">std</span><span class="p">::</span><span class="no">ostream</span><span class="p">::</span><span class="no">operator</span><span class="err">&lt;&lt;</span><span class="p">(</span><span class="no">int</span><span class="p">)</span>
</span><span id="__span-125-61"><a id="__codelineno-125-61" name="__codelineno-125-61" href="#__codelineno-125-61"></a><span class="nf">lea</span><span class="w">     </span><span class="no">rdx</span><span class="p">,</span><span class="w"> </span><span class="no">asc_1400032D8</span>
</span><span id="__span-125-62"><a id="__codelineno-125-62" name="__codelineno-125-62" href="#__codelineno-125-62"></a><span class="nf">mov</span><span class="w">     </span><span class="no">rcx</span><span class="p">,</span><span class="w"> </span><span class="no">rax</span>
</span><span id="__span-125-63"><a id="__codelineno-125-63" name="__codelineno-125-63" href="#__codelineno-125-63"></a><span class="nf">call</span><span class="w">    </span><span class="no">std</span><span class="p">::</span><span class="no">operator</span><span class="err">&lt;&lt;&lt;</span><span class="no">...</span><span class="err">&gt;</span><span class="p">(</span><span class="no">std</span><span class="p">::</span><span class="no">ostream</span><span class="err">&amp;</span><span class="p">,</span><span class="w"> </span><span class="no">char</span><span class="w"> </span><span class="no">const</span><span class="p">*)</span>
</span><span id="__span-125-64"><a id="__codelineno-125-64" name="__codelineno-125-64" href="#__codelineno-125-64"></a><span class="nf">mov</span><span class="w">     </span><span class="p">[</span><span class="no">rsp</span><span class="err">+</span><span class="mi">68</span><span class="no">h</span><span class="err">+</span><span class="no">var_18</span><span class="p">],</span><span class="w"> </span><span class="no">rax</span>
</span><span id="__span-125-65"><a id="__codelineno-125-65" name="__codelineno-125-65" href="#__codelineno-125-65"></a><span class="nf">mov</span><span class="w">     </span><span class="no">rax</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="no">rsp</span><span class="err">+</span><span class="mi">68</span><span class="no">h</span><span class="err">+</span><span class="no">_Complejo2</span><span class="p">]</span>
</span><span id="__span-125-66"><a id="__codelineno-125-66" name="__codelineno-125-66" href="#__codelineno-125-66"></a><span class="nf">mov</span><span class="w">     </span><span class="no">eax</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="no">rax</span><span class="err">+</span><span class="mi">4</span><span class="p">]</span>
</span><span id="__span-125-67"><a id="__codelineno-125-67" name="__codelineno-125-67" href="#__codelineno-125-67"></a><span class="nf">mov</span><span class="w">     </span><span class="p">[</span><span class="no">rsp</span><span class="err">+</span><span class="mi">68</span><span class="no">h</span><span class="err">+</span><span class="no">var_3C</span><span class="p">],</span><span class="w"> </span><span class="no">eax</span>
</span><span id="__span-125-68"><a id="__codelineno-125-68" name="__codelineno-125-68" href="#__codelineno-125-68"></a><span class="nf">mov</span><span class="w">     </span><span class="no">edx</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="no">rsp</span><span class="err">+</span><span class="mi">68</span><span class="no">h</span><span class="err">+</span><span class="no">var_3C</span><span class="p">]</span>
</span><span id="__span-125-69"><a id="__codelineno-125-69" name="__codelineno-125-69" href="#__codelineno-125-69"></a><span class="nf">mov</span><span class="w">     </span><span class="no">rcx</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="no">rsp</span><span class="err">+</span><span class="mi">68</span><span class="no">h</span><span class="err">+</span><span class="no">var_18</span><span class="p">]</span>
</span><span id="__span-125-70"><a id="__codelineno-125-70" name="__codelineno-125-70" href="#__codelineno-125-70"></a><span class="nf">call</span><span class="w">    </span><span class="no">std</span><span class="p">::</span><span class="no">ostream</span><span class="p">::</span><span class="no">operator</span><span class="err">&lt;&lt;</span><span class="p">(</span><span class="no">int</span><span class="p">)</span>
</span><span id="__span-125-71"><a id="__codelineno-125-71" name="__codelineno-125-71" href="#__codelineno-125-71"></a><span class="nf">lea</span><span class="w">     </span><span class="no">rdx</span><span class="p">,</span><span class="w"> </span><span class="no">aI</span>
</span><span id="__span-125-72"><a id="__codelineno-125-72" name="__codelineno-125-72" href="#__codelineno-125-72"></a><span class="nf">mov</span><span class="w">     </span><span class="no">rcx</span><span class="p">,</span><span class="w"> </span><span class="no">rax</span>
</span><span id="__span-125-73"><a id="__codelineno-125-73" name="__codelineno-125-73" href="#__codelineno-125-73"></a><span class="nf">call</span><span class="w">    </span><span class="no">std</span><span class="p">::</span><span class="no">operator</span><span class="err">&lt;&lt;&lt;</span><span class="no">...</span><span class="err">&gt;</span><span class="p">(</span><span class="no">std</span><span class="p">::</span><span class="no">ostream</span><span class="err">&amp;</span><span class="p">,</span><span class="w"> </span><span class="no">char</span><span class="w"> </span><span class="no">const</span><span class="p">*)</span>
</span><span id="__span-125-74"><a id="__codelineno-125-74" name="__codelineno-125-74" href="#__codelineno-125-74"></a><span class="nf">mov</span><span class="w">     </span><span class="p">[</span><span class="no">rsp</span><span class="err">+</span><span class="mi">68</span><span class="no">h</span><span class="err">+</span><span class="no">var_10</span><span class="p">],</span><span class="w"> </span><span class="no">rax</span>
</span><span id="__span-125-75"><a id="__codelineno-125-75" name="__codelineno-125-75" href="#__codelineno-125-75"></a><span class="nf">lea</span><span class="w">     </span><span class="no">rdx</span><span class="p">,</span><span class="w"> </span><span class="no">std</span><span class="p">::</span><span class="no">endl</span><span class="err">&lt;</span><span class="no">char</span><span class="p">,</span><span class="no">std</span><span class="p">::</span><span class="no">char_traits</span><span class="err">&lt;</span><span class="no">char</span><span class="err">&gt;&gt;</span><span class="p">(</span><span class="no">std</span><span class="p">::</span><span class="no">ostream</span><span class="w"> </span><span class="err">&amp;</span><span class="p">)</span>
</span><span id="__span-125-76"><a id="__codelineno-125-76" name="__codelineno-125-76" href="#__codelineno-125-76"></a><span class="nf">mov</span><span class="w">     </span><span class="no">rcx</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="no">rsp</span><span class="err">+</span><span class="mi">68</span><span class="no">h</span><span class="err">+</span><span class="no">var_10</span><span class="p">]</span>
</span><span id="__span-125-77"><a id="__codelineno-125-77" name="__codelineno-125-77" href="#__codelineno-125-77"></a><span class="nf">call</span><span class="w">    </span><span class="no">std</span><span class="p">::</span><span class="no">ostream</span><span class="p">::</span><span class="no">operator</span><span class="err">&lt;&lt;</span><span class="p">(</span><span class="no">std</span><span class="p">::</span><span class="no">ostream</span><span class="err">&amp;</span><span class="w"> </span><span class="p">(*)(</span><span class="no">std</span><span class="p">::</span><span class="no">ostream</span><span class="err">&amp;</span><span class="p">))</span>
</span><span id="__span-125-78"><a id="__codelineno-125-78" name="__codelineno-125-78" href="#__codelineno-125-78"></a>
</span><span id="__span-125-79"><a id="__codelineno-125-79" name="__codelineno-125-79" href="#__codelineno-125-79"></a><span class="nf">add</span><span class="w">     </span><span class="no">rsp</span><span class="p">,</span><span class="w"> </span><span class="mi">68</span><span class="no">h</span>
</span><span id="__span-125-80"><a id="__codelineno-125-80" name="__codelineno-125-80" href="#__codelineno-125-80"></a><span class="nf">retn</span>
</span></code></pre></div>
<p>Claves:</p>
<ul>
<li>Prologue guarda <code>RCX/RDX</code> en el stack y reserva 0x68 bytes (temporales para ostream y valores).</li>
<li>Escrituras a <code>_Complejo</code>: <code>[rax]</code> y <code>[rax+4]</code> son <code>real</code> e <code>imaginario</code> (struct <code>int,int</code>).</li>
<li>Secuencia típica de <code>cout</code>: literal → entero → literal → entero → literal → <code>endl</code>.</li>
<li>Para <code>_Complejo2</code>, se repite el mismo patrón con <code>RDX</code> como base.</li>
</ul>
<h3 id="notas-practicas-en-ida-simbolos-optimizaciones-y-tecla-t">Notas prácticas en IDA (símbolos, optimizaciones y tecla T)<a class="headerlink" href="#notas-practicas-en-ida-simbolos-optimizaciones-y-tecla-t" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>Sin optimizaciones</strong>: mantenemos <code>/Od</code> y símbolos para que el código se parezca al C++. Con <code>/O2</code>, el compilador puede <em>inlinear</em> <code>imprimir()</code> dentro de <code>main()</code> y mover variables a registros (ni siquiera verás el stack slot temporal). Para enseñar es mejor empezar sin optimizaciones; luego podrás comparar y ver cómo desaparecen funciones o se convierten en registros.</li>
<li><strong><code>new</code> vs <code>malloc</code> en binario</strong>: <code>new</code> ya incluye chequeo/reintento (llama al <code>new_handler</code> o lanza <code>std::bad_alloc</code>), por eso no ves <code>if (ptr==0)</code> tras <code>new</code>. Con <code>malloc</code> el chequeo es manual (aquí el <code>if (Complejo2 == NULL) exit(1);</code>).</li>
<li><strong>Temporales no optimizados</strong>: notarás variables intermedias inútiles (guardar en <code>[rsp+var]</code> y reescribir). Son artefactos de código no optimizado; en build optimizado desaparecerán.</li>
<li><strong>Tecla <code>T</code> en IDA</strong>: selecciona un puntero y pulsa <code>T</code> para aplicar el tipo de estructura; así los accesos <code>[rax]</code>/<code>[rax+4]</code> muestran <code>real</code>/<code>imaginario</code> en vez de offsets crudos.</li>
<li><strong>Distinguir instancias</strong>: cuando dos punteros apuntan al mismo tipo (<code>Complejo</code> y <code>Complejo2</code>), duplica el tipo (<code>Copy struct type</code>) y renombra las instancias. Luego, con <code>T</code>, eliges <code>Complejo</code> o <code>Complejo2</code> y ves los campos correctos en cada uso, evitando confundir qué objeto está tocando cada <code>mov</code>.</li>
<li><strong>Detectar estructuras sin símbolos</strong>: si ves un puntero y accesos con desplazamientos constantes (<code>[reg]</code>, <code>[reg+4]</code>, etc.), asume estructura/objeto. Aunque no veas el <code>malloc/new</code> cercano, el patrón “puntero + offset = campo” es la pista clave.</li>
</ul>
<hr />
<h2 id="apendice-a-smart-pointers-punteros-inteligentes">Apéndice A: Smart Pointers (Punteros Inteligentes)<a class="headerlink" href="#apendice-a-smart-pointers-punteros-inteligentes" title="Permanent link">&para;</a></h2>
<h3 id="introduccion-a-smart-pointers">Introducción a Smart Pointers<a class="headerlink" href="#introduccion-a-smart-pointers" title="Permanent link">&para;</a></h3>
<p>Los <strong>smart pointers</strong> son objetos que actúan como punteros pero manejan automáticamente la memoria. En C++11 y posteriores, encontrarás tres tipos principales en <code>&lt;memory&gt;</code>:</p>
<ol>
<li><strong><code>unique_ptr</code></strong> - Propiedad exclusiva</li>
<li><strong><code>shared_ptr</code></strong> - Propiedad compartida</li>
<li><strong><code>weak_ptr</code></strong> - Referencia débil a <code>shared_ptr</code></li>
</ol>
<h3 id="por-que-son-importantes-en-reversing">¿Por Qué Son Importantes en Reversing?<a class="headerlink" href="#por-que-son-importantes-en-reversing" title="Permanent link">&para;</a></h3>
<p><strong>En binarios compilados con C++11+</strong>, verás:</p>
<ul>
<li>Más llamadas a funciones de destrucción automática</li>
<li>Contadores de referencias (<code>refcount</code>)</li>
<li>Deletores personalizados</li>
<li>Patrones de inicialización más complejos</li>
</ul>
<h3 id="unique_ptr-propiedad-unica">unique_ptr: Propiedad Única<a class="headerlink" href="#unique_ptr-propiedad-unica" title="Permanent link">&para;</a></h3>
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-126-1"><a id="__codelineno-126-1" name="__codelineno-126-1" href="#__codelineno-126-1"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;memory&gt;</span>
</span><span id="__span-126-2"><a id="__codelineno-126-2" name="__codelineno-126-2" href="#__codelineno-126-2"></a><span class="k">using</span><span class="w"> </span><span class="k">namespace</span><span class="w"> </span><span class="nn">std</span><span class="p">;</span>
</span><span id="__span-126-3"><a id="__codelineno-126-3" name="__codelineno-126-3" href="#__codelineno-126-3"></a>
</span><span id="__span-126-4"><a id="__codelineno-126-4" name="__codelineno-126-4" href="#__codelineno-126-4"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-126-5"><a id="__codelineno-126-5" name="__codelineno-126-5" href="#__codelineno-126-5"></a><span class="w">    </span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="w"> </span><span class="n">ptr</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="kt">int</span><span class="p">(</span><span class="mi">42</span><span class="p">));</span>
</span><span id="__span-126-6"><a id="__codelineno-126-6" name="__codelineno-126-6" href="#__codelineno-126-6"></a><span class="w">    </span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="o">*</span><span class="n">ptr</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">endl</span><span class="p">;</span><span class="w">           </span><span class="c1">// 42</span>
</span><span id="__span-126-7"><a id="__codelineno-126-7" name="__codelineno-126-7" href="#__codelineno-126-7"></a><span class="w">    </span><span class="c1">// ptr se destruye automáticamente al salir del scope</span>
</span><span id="__span-126-8"><a id="__codelineno-126-8" name="__codelineno-126-8" href="#__codelineno-126-8"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
</span><span id="__span-126-9"><a id="__codelineno-126-9" name="__codelineno-126-9" href="#__codelineno-126-9"></a><span class="p">}</span>
</span></code></pre></div>
<p><strong>Características:</strong></p>
<ul>
<li>Solo un propietario</li>
<li>No se puede copiar (se mueve)</li>
<li>Automáticamente destruido al salir del scope</li>
<li>Sin overhead de conteo de referencias</li>
</ul>
<p><strong>En ensamblador:</strong></p>
<div class="language-asm highlight"><pre><span></span><code><span id="__span-127-1"><a id="__codelineno-127-1" name="__codelineno-127-1" href="#__codelineno-127-1"></a><span class="c1">; Creación: unique_ptr&lt;int&gt; ptr(new int(42));</span>
</span><span id="__span-127-2"><a id="__codelineno-127-2" name="__codelineno-127-2" href="#__codelineno-127-2"></a><span class="nf">mov</span><span class="w"> </span><span class="no">ecx</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="w">              </span><span class="c1">; size = 4</span>
</span><span id="__span-127-3"><a id="__codelineno-127-3" name="__codelineno-127-3" href="#__codelineno-127-3"></a><span class="nf">call</span><span class="w"> </span><span class="no">operator</span><span class="w"> </span><span class="no">new</span><span class="w">       </span><span class="c1">; RAX = puntero a memoria</span>
</span><span id="__span-127-4"><a id="__codelineno-127-4" name="__codelineno-127-4" href="#__codelineno-127-4"></a><span class="nf">mov</span><span class="w"> </span><span class="no">edx</span><span class="p">,</span><span class="w"> </span><span class="mi">42</span>
</span><span id="__span-127-5"><a id="__codelineno-127-5" name="__codelineno-127-5" href="#__codelineno-127-5"></a><span class="nf">mov</span><span class="w"> </span><span class="p">[</span><span class="no">rax</span><span class="p">],</span><span class="w"> </span><span class="no">edx</span><span class="w">          </span><span class="c1">; Escribir valor</span>
</span><span id="__span-127-6"><a id="__codelineno-127-6" name="__codelineno-127-6" href="#__codelineno-127-6"></a><span class="nf">mov</span><span class="w"> </span><span class="p">[</span><span class="no">rsp</span><span class="err">+</span><span class="mi">28</span><span class="p">],</span><span class="w"> </span><span class="no">rax</span><span class="w">       </span><span class="c1">; ptr = RAX (almacenar puntero)</span>
</span><span id="__span-127-7"><a id="__codelineno-127-7" name="__codelineno-127-7" href="#__codelineno-127-7"></a>
</span><span id="__span-127-8"><a id="__codelineno-127-8" name="__codelineno-127-8" href="#__codelineno-127-8"></a><span class="c1">; Destrucción automática (cuando sale del scope):</span>
</span><span id="__span-127-9"><a id="__codelineno-127-9" name="__codelineno-127-9" href="#__codelineno-127-9"></a><span class="nf">mov</span><span class="w"> </span><span class="no">rcx</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="no">rsp</span><span class="err">+</span><span class="mi">28</span><span class="p">]</span><span class="w">       </span><span class="c1">; RCX = ptr</span>
</span><span id="__span-127-10"><a id="__codelineno-127-10" name="__codelineno-127-10" href="#__codelineno-127-10"></a><span class="nf">cmp</span><span class="w"> </span><span class="no">rcx</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span>
</span><span id="__span-127-11"><a id="__codelineno-127-11" name="__codelineno-127-11" href="#__codelineno-127-11"></a><span class="nf">je</span><span class="w"> </span><span class="no">skip_delete</span>
</span><span id="__span-127-12"><a id="__codelineno-127-12" name="__codelineno-127-12" href="#__codelineno-127-12"></a><span class="nf">call</span><span class="w"> </span><span class="no">operator</span><span class="w"> </span><span class="no">delete</span><span class="w">    </span><span class="c1">; Liberar memoria</span>
</span><span id="__span-127-13"><a id="__codelineno-127-13" name="__codelineno-127-13" href="#__codelineno-127-13"></a><span class="nl">skip_delete:</span>
</span></code></pre></div>
<p><strong>Indicadores en IDA:</strong></p>
<ul>
<li>Llamadas a <code>operator new</code> y <code>operator delete</code></li>
<li>Destructor registrado (probablemente en tabla de funciones)</li>
<li>Un único puntero de propiedad</li>
</ul>
<h3 id="shared_ptr-propiedad-compartida">shared_ptr: Propiedad Compartida<a class="headerlink" href="#shared_ptr-propiedad-compartida" title="Permanent link">&para;</a></h3>
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-128-1"><a id="__codelineno-128-1" name="__codelineno-128-1" href="#__codelineno-128-1"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-128-2"><a id="__codelineno-128-2" name="__codelineno-128-2" href="#__codelineno-128-2"></a><span class="w">    </span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="w"> </span><span class="n">ptr1</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="kt">int</span><span class="p">(</span><span class="mi">100</span><span class="p">));</span>
</span><span id="__span-128-3"><a id="__codelineno-128-3" name="__codelineno-128-3" href="#__codelineno-128-3"></a><span class="w">    </span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="w"> </span><span class="n">ptr2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ptr1</span><span class="p">;</span><span class="w">     </span><span class="c1">// Compartir propiedad</span>
</span><span id="__span-128-4"><a id="__codelineno-128-4" name="__codelineno-128-4" href="#__codelineno-128-4"></a>
</span><span id="__span-128-5"><a id="__codelineno-128-5" name="__codelineno-128-5" href="#__codelineno-128-5"></a><span class="w">    </span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">ptr1</span><span class="p">.</span><span class="n">use_count</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">endl</span><span class="p">;</span><span class="w"> </span><span class="c1">// 2</span>
</span><span id="__span-128-6"><a id="__codelineno-128-6" name="__codelineno-128-6" href="#__codelineno-128-6"></a>
</span><span id="__span-128-7"><a id="__codelineno-128-7" name="__codelineno-128-7" href="#__codelineno-128-7"></a><span class="w">    </span><span class="c1">// Ambos se destruyen automáticamente</span>
</span><span id="__span-128-8"><a id="__codelineno-128-8" name="__codelineno-128-8" href="#__codelineno-128-8"></a><span class="w">    </span><span class="c1">// Memoria liberada cuando último shared_ptr se destruye</span>
</span><span id="__span-128-9"><a id="__codelineno-128-9" name="__codelineno-128-9" href="#__codelineno-128-9"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
</span><span id="__span-128-10"><a id="__codelineno-128-10" name="__codelineno-128-10" href="#__codelineno-128-10"></a><span class="p">}</span>
</span></code></pre></div>
<p><strong>Características:</strong></p>
<ul>
<li>Múltiples propietarios</li>
<li>Conteo de referencias interno</li>
<li>Memoria liberada cuando refcount llega a cero</li>
<li>Overhead de sincronización en ambientes multi-thread</li>
</ul>
<p><strong>Estructura interna:</strong></p>
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-129-1"><a id="__codelineno-129-1" name="__codelineno-129-1" href="#__codelineno-129-1"></a><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span><span class="w"> </span><span class="nc">T</span><span class="o">&gt;</span>
</span><span id="__span-129-2"><a id="__codelineno-129-2" name="__codelineno-129-2" href="#__codelineno-129-2"></a><span class="k">class</span><span class="w"> </span><span class="nc">shared_ptr</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-129-3"><a id="__codelineno-129-3" name="__codelineno-129-3" href="#__codelineno-129-3"></a><span class="w">    </span><span class="n">T</span><span class="o">*</span><span class="w"> </span><span class="n">ptr</span><span class="p">;</span><span class="w">                    </span><span class="c1">// Puntero a datos</span>
</span><span id="__span-129-4"><a id="__codelineno-129-4" name="__codelineno-129-4" href="#__codelineno-129-4"></a><span class="w">    </span><span class="n">control_block</span><span class="o">*</span><span class="w"> </span><span class="n">control</span><span class="p">;</span><span class="w">    </span><span class="c1">// Bloque de control (refcount, deletor)</span>
</span><span id="__span-129-5"><a id="__codelineno-129-5" name="__codelineno-129-5" href="#__codelineno-129-5"></a><span class="p">};</span>
</span><span id="__span-129-6"><a id="__codelineno-129-6" name="__codelineno-129-6" href="#__codelineno-129-6"></a>
</span><span id="__span-129-7"><a id="__codelineno-129-7" name="__codelineno-129-7" href="#__codelineno-129-7"></a><span class="k">struct</span><span class="w"> </span><span class="nc">control_block</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-129-8"><a id="__codelineno-129-8" name="__codelineno-129-8" href="#__codelineno-129-8"></a><span class="w">    </span><span class="kt">long</span><span class="w"> </span><span class="n">refcount</span><span class="p">;</span><span class="w">             </span><span class="c1">// Contadores de referencias</span>
</span><span id="__span-129-9"><a id="__codelineno-129-9" name="__codelineno-129-9" href="#__codelineno-129-9"></a><span class="w">    </span><span class="n">T</span><span class="o">*</span><span class="w"> </span><span class="n">ptr</span><span class="p">;</span><span class="w">                    </span><span class="c1">// Puntero a objeto</span>
</span><span id="__span-129-10"><a id="__codelineno-129-10" name="__codelineno-129-10" href="#__codelineno-129-10"></a><span class="w">    </span><span class="n">deletor</span><span class="w"> </span><span class="n">del</span><span class="p">;</span><span class="w">               </span><span class="c1">// Función de destrucción personalizada</span>
</span><span id="__span-129-11"><a id="__codelineno-129-11" name="__codelineno-129-11" href="#__codelineno-129-11"></a><span class="p">};</span>
</span></code></pre></div>
<p><strong>En ensamblador:</strong></p>
<div class="language-asm highlight"><pre><span></span><code><span id="__span-130-1"><a id="__codelineno-130-1" name="__codelineno-130-1" href="#__codelineno-130-1"></a><span class="c1">; Creación: shared_ptr&lt;int&gt; ptr1(new int(100));</span>
</span><span id="__span-130-2"><a id="__codelineno-130-2" name="__codelineno-130-2" href="#__codelineno-130-2"></a><span class="nf">mov</span><span class="w"> </span><span class="no">ecx</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span>
</span><span id="__span-130-3"><a id="__codelineno-130-3" name="__codelineno-130-3" href="#__codelineno-130-3"></a><span class="nf">call</span><span class="w"> </span><span class="no">operator</span><span class="w"> </span><span class="no">new</span><span class="w">           </span><span class="c1">; RAX = puntero a datos (0x1000)</span>
</span><span id="__span-130-4"><a id="__codelineno-130-4" name="__codelineno-130-4" href="#__codelineno-130-4"></a>
</span><span id="__span-130-5"><a id="__codelineno-130-5" name="__codelineno-130-5" href="#__codelineno-130-5"></a><span class="c1">; Crear control_block</span>
</span><span id="__span-130-6"><a id="__codelineno-130-6" name="__codelineno-130-6" href="#__codelineno-130-6"></a><span class="nf">mov</span><span class="w"> </span><span class="no">ecx</span><span class="p">,</span><span class="w"> </span><span class="no">size_control_block</span>
</span><span id="__span-130-7"><a id="__codelineno-130-7" name="__codelineno-130-7" href="#__codelineno-130-7"></a><span class="nf">call</span><span class="w"> </span><span class="no">operator</span><span class="w"> </span><span class="no">new</span><span class="w">           </span><span class="c1">; RBX = puntero a control_block (0x2000)</span>
</span><span id="__span-130-8"><a id="__codelineno-130-8" name="__codelineno-130-8" href="#__codelineno-130-8"></a>
</span><span id="__span-130-9"><a id="__codelineno-130-9" name="__codelineno-130-9" href="#__codelineno-130-9"></a><span class="nf">mov</span><span class="w"> </span><span class="p">[</span><span class="no">rbx</span><span class="p">],</span><span class="w"> </span><span class="mi">1</span><span class="w">                </span><span class="c1">; control_block.refcount = 1</span>
</span><span id="__span-130-10"><a id="__codelineno-130-10" name="__codelineno-130-10" href="#__codelineno-130-10"></a><span class="nf">mov</span><span class="w"> </span><span class="p">[</span><span class="no">rbx</span><span class="err">+</span><span class="mi">8</span><span class="p">],</span><span class="w"> </span><span class="no">rax</span><span class="w">            </span><span class="c1">; control_block.ptr = datos</span>
</span><span id="__span-130-11"><a id="__codelineno-130-11" name="__codelineno-130-11" href="#__codelineno-130-11"></a><span class="nf">mov</span><span class="w"> </span><span class="p">[</span><span class="no">rbx</span><span class="err">+</span><span class="mi">16</span><span class="p">],</span><span class="w"> </span><span class="no">del_func</span><span class="w">      </span><span class="c1">; control_block.deletor</span>
</span><span id="__span-130-12"><a id="__codelineno-130-12" name="__codelineno-130-12" href="#__codelineno-130-12"></a>
</span><span id="__span-130-13"><a id="__codelineno-130-13" name="__codelineno-130-13" href="#__codelineno-130-13"></a><span class="c1">; Almacenar en shared_ptr</span>
</span><span id="__span-130-14"><a id="__codelineno-130-14" name="__codelineno-130-14" href="#__codelineno-130-14"></a><span class="nf">mov</span><span class="w"> </span><span class="p">[</span><span class="no">rsp</span><span class="err">+</span><span class="mi">28</span><span class="p">],</span><span class="w"> </span><span class="no">rax</span><span class="w">           </span><span class="c1">; shared_ptr.ptr = 0x1000</span>
</span><span id="__span-130-15"><a id="__codelineno-130-15" name="__codelineno-130-15" href="#__codelineno-130-15"></a><span class="nf">mov</span><span class="w"> </span><span class="p">[</span><span class="no">rsp</span><span class="err">+</span><span class="mi">36</span><span class="p">],</span><span class="w"> </span><span class="no">rbx</span><span class="w">           </span><span class="c1">; shared_ptr.control = 0x2000</span>
</span><span id="__span-130-16"><a id="__codelineno-130-16" name="__codelineno-130-16" href="#__codelineno-130-16"></a>
</span><span id="__span-130-17"><a id="__codelineno-130-17" name="__codelineno-130-17" href="#__codelineno-130-17"></a><span class="c1">; Asignación: shared_ptr&lt;int&gt; ptr2 = ptr1;</span>
</span><span id="__span-130-18"><a id="__codelineno-130-18" name="__codelineno-130-18" href="#__codelineno-130-18"></a><span class="nf">mov</span><span class="w"> </span><span class="no">rax</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="no">rsp</span><span class="err">+</span><span class="mi">28</span><span class="p">]</span><span class="w">           </span><span class="c1">; ptr2.ptr = ptr1.ptr</span>
</span><span id="__span-130-19"><a id="__codelineno-130-19" name="__codelineno-130-19" href="#__codelineno-130-19"></a><span class="nf">mov</span><span class="w"> </span><span class="no">rbx</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="no">rsp</span><span class="err">+</span><span class="mi">36</span><span class="p">]</span><span class="w">           </span><span class="c1">; ptr2.control = ptr1.control</span>
</span><span id="__span-130-20"><a id="__codelineno-130-20" name="__codelineno-130-20" href="#__codelineno-130-20"></a><span class="nf">mov</span><span class="w"> </span><span class="p">[</span><span class="no">rsp</span><span class="err">+</span><span class="mi">44</span><span class="p">],</span><span class="w"> </span><span class="no">rax</span><span class="w">           </span><span class="c1">; Guardar ptr2.ptr</span>
</span><span id="__span-130-21"><a id="__codelineno-130-21" name="__codelineno-130-21" href="#__codelineno-130-21"></a><span class="nf">mov</span><span class="w"> </span><span class="p">[</span><span class="no">rsp</span><span class="err">+</span><span class="mi">52</span><span class="p">],</span><span class="w"> </span><span class="no">rbx</span><span class="w">           </span><span class="c1">; Guardar ptr2.control</span>
</span><span id="__span-130-22"><a id="__codelineno-130-22" name="__codelineno-130-22" href="#__codelineno-130-22"></a>
</span><span id="__span-130-23"><a id="__codelineno-130-23" name="__codelineno-130-23" href="#__codelineno-130-23"></a><span class="c1">; Incrementar refcount</span>
</span><span id="__span-130-24"><a id="__codelineno-130-24" name="__codelineno-130-24" href="#__codelineno-130-24"></a><span class="nf">mov</span><span class="w"> </span><span class="no">rax</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="no">rbx</span><span class="p">]</span><span class="w">              </span><span class="c1">; RAX = refcount</span>
</span><span id="__span-130-25"><a id="__codelineno-130-25" name="__codelineno-130-25" href="#__codelineno-130-25"></a><span class="nf">inc</span><span class="w"> </span><span class="no">rax</span>
</span><span id="__span-130-26"><a id="__codelineno-130-26" name="__codelineno-130-26" href="#__codelineno-130-26"></a><span class="nf">mov</span><span class="w"> </span><span class="p">[</span><span class="no">rbx</span><span class="p">],</span><span class="w"> </span><span class="no">rax</span><span class="w">              </span><span class="c1">; refcount = 2</span>
</span><span id="__span-130-27"><a id="__codelineno-130-27" name="__codelineno-130-27" href="#__codelineno-130-27"></a>
</span><span id="__span-130-28"><a id="__codelineno-130-28" name="__codelineno-130-28" href="#__codelineno-130-28"></a><span class="c1">; Destrucción: cuando ptr1 sale del scope</span>
</span><span id="__span-130-29"><a id="__codelineno-130-29" name="__codelineno-130-29" href="#__codelineno-130-29"></a><span class="nf">mov</span><span class="w"> </span><span class="no">rbx</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="no">rsp</span><span class="err">+</span><span class="mi">36</span><span class="p">]</span><span class="w">           </span><span class="c1">; RBX = control_block</span>
</span><span id="__span-130-30"><a id="__codelineno-130-30" name="__codelineno-130-30" href="#__codelineno-130-30"></a><span class="nf">mov</span><span class="w"> </span><span class="no">rax</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="no">rbx</span><span class="p">]</span><span class="w">              </span><span class="c1">; RAX = refcount</span>
</span><span id="__span-130-31"><a id="__codelineno-130-31" name="__codelineno-130-31" href="#__codelineno-130-31"></a><span class="nf">dec</span><span class="w"> </span><span class="no">rax</span>
</span><span id="__span-130-32"><a id="__codelineno-130-32" name="__codelineno-130-32" href="#__codelineno-130-32"></a><span class="nf">mov</span><span class="w"> </span><span class="p">[</span><span class="no">rbx</span><span class="p">],</span><span class="w"> </span><span class="no">rax</span><span class="w">              </span><span class="c1">; refcount--</span>
</span><span id="__span-130-33"><a id="__codelineno-130-33" name="__codelineno-130-33" href="#__codelineno-130-33"></a>
</span><span id="__span-130-34"><a id="__codelineno-130-34" name="__codelineno-130-34" href="#__codelineno-130-34"></a><span class="nf">cmp</span><span class="w"> </span><span class="no">rax</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span>
</span><span id="__span-130-35"><a id="__codelineno-130-35" name="__codelineno-130-35" href="#__codelineno-130-35"></a><span class="nf">jne</span><span class="w"> </span><span class="no">skip_destroy</span><span class="w">            </span><span class="c1">; Si refcount &gt; 0, no destruir</span>
</span><span id="__span-130-36"><a id="__codelineno-130-36" name="__codelineno-130-36" href="#__codelineno-130-36"></a><span class="nf">mov</span><span class="w"> </span><span class="no">rcx</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="no">rbx</span><span class="err">+</span><span class="mi">8</span><span class="p">]</span><span class="w">            </span><span class="c1">; RCX = ptr a datos</span>
</span><span id="__span-130-37"><a id="__codelineno-130-37" name="__codelineno-130-37" href="#__codelineno-130-37"></a><span class="nf">mov</span><span class="w"> </span><span class="no">rax</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="no">rbx</span><span class="err">+</span><span class="mi">16</span><span class="p">]</span><span class="w">           </span><span class="c1">; RAX = deletor</span>
</span><span id="__span-130-38"><a id="__codelineno-130-38" name="__codelineno-130-38" href="#__codelineno-130-38"></a><span class="nf">call</span><span class="w"> </span><span class="no">rax</span><span class="w">                    </span><span class="c1">; Llamar deletor</span>
</span><span id="__span-130-39"><a id="__codelineno-130-39" name="__codelineno-130-39" href="#__codelineno-130-39"></a><span class="nf">mov</span><span class="w"> </span><span class="no">rcx</span><span class="p">,</span><span class="w"> </span><span class="no">rbx</span><span class="w">                </span><span class="c1">; RCX = control_block</span>
</span><span id="__span-130-40"><a id="__codelineno-130-40" name="__codelineno-130-40" href="#__codelineno-130-40"></a><span class="nf">call</span><span class="w"> </span><span class="no">operator</span><span class="w"> </span><span class="no">delete</span><span class="w">        </span><span class="c1">; Liberar control_block</span>
</span><span id="__span-130-41"><a id="__codelineno-130-41" name="__codelineno-130-41" href="#__codelineno-130-41"></a><span class="nl">skip_destroy:</span>
</span></code></pre></div>
<p><strong>Indicadores en IDA:</strong></p>
<ul>
<li>Dos asignaciones de puntero (ptr + control_block)</li>
<li>Incremento de contador (<code>inc [memoria]</code>)</li>
<li>Decremento de contador (<code>dec [memoria]</code>)</li>
<li>Saltos condicionales basados en refcount</li>
<li>Múltiples llamadas a <code>operator delete</code></li>
</ul>
<h3 id="weak_ptr-referencia-debil">weak_ptr: Referencia Débil<a class="headerlink" href="#weak_ptr-referencia-debil" title="Permanent link">&para;</a></h3>
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-131-1"><a id="__codelineno-131-1" name="__codelineno-131-1" href="#__codelineno-131-1"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-131-2"><a id="__codelineno-131-2" name="__codelineno-131-2" href="#__codelineno-131-2"></a><span class="w">    </span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="w"> </span><span class="n">sptr</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="kt">int</span><span class="p">(</span><span class="mi">50</span><span class="p">));</span>
</span><span id="__span-131-3"><a id="__codelineno-131-3" name="__codelineno-131-3" href="#__codelineno-131-3"></a><span class="w">    </span><span class="n">weak_ptr</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="w"> </span><span class="n">wptr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sptr</span><span class="p">;</span><span class="w">       </span><span class="c1">// Referencia débil</span>
</span><span id="__span-131-4"><a id="__codelineno-131-4" name="__codelineno-131-4" href="#__codelineno-131-4"></a>
</span><span id="__span-131-5"><a id="__codelineno-131-5" name="__codelineno-131-5" href="#__codelineno-131-5"></a><span class="w">    </span><span class="c1">// wptr NO incrementa el refcount</span>
</span><span id="__span-131-6"><a id="__codelineno-131-6" name="__codelineno-131-6" href="#__codelineno-131-6"></a><span class="w">    </span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">sptr</span><span class="p">.</span><span class="n">use_count</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">endl</span><span class="p">;</span><span class="w"> </span><span class="c1">// 1 (no contado)</span>
</span><span id="__span-131-7"><a id="__codelineno-131-7" name="__codelineno-131-7" href="#__codelineno-131-7"></a>
</span><span id="__span-131-8"><a id="__codelineno-131-8" name="__codelineno-131-8" href="#__codelineno-131-8"></a><span class="w">    </span><span class="c1">// Para usar weak_ptr, convertir a shared_ptr:</span>
</span><span id="__span-131-9"><a id="__codelineno-131-9" name="__codelineno-131-9" href="#__codelineno-131-9"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">auto</span><span class="w"> </span><span class="n">locked</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">wptr</span><span class="p">.</span><span class="n">lock</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-131-10"><a id="__codelineno-131-10" name="__codelineno-131-10" href="#__codelineno-131-10"></a><span class="w">        </span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="o">*</span><span class="n">locked</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">endl</span><span class="p">;</span><span class="w">      </span><span class="c1">// 50</span>
</span><span id="__span-131-11"><a id="__codelineno-131-11" name="__codelineno-131-11" href="#__codelineno-131-11"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-131-12"><a id="__codelineno-131-12" name="__codelineno-131-12" href="#__codelineno-131-12"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
</span><span id="__span-131-13"><a id="__codelineno-131-13" name="__codelineno-131-13" href="#__codelineno-131-13"></a><span class="p">}</span>
</span></code></pre></div>
<p><strong>Uso común:</strong> Evitar ciclos de referencias que prevengan destrucción automática.</p>
<p><strong>En ensamblador:</strong></p>
<div class="language-asm highlight"><pre><span></span><code><span id="__span-132-1"><a id="__codelineno-132-1" name="__codelineno-132-1" href="#__codelineno-132-1"></a><span class="c1">; weak_ptr = shared_ptr (NO incrementa refcount)</span>
</span><span id="__span-132-2"><a id="__codelineno-132-2" name="__codelineno-132-2" href="#__codelineno-132-2"></a><span class="nf">mov</span><span class="w"> </span><span class="no">rax</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="no">rsp</span><span class="err">+</span><span class="mi">28</span><span class="p">]</span><span class="w">           </span><span class="c1">; RAX = ptr1.ptr</span>
</span><span id="__span-132-3"><a id="__codelineno-132-3" name="__codelineno-132-3" href="#__codelineno-132-3"></a><span class="nf">mov</span><span class="w"> </span><span class="no">rbx</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="no">rsp</span><span class="err">+</span><span class="mi">36</span><span class="p">]</span><span class="w">           </span><span class="c1">; RBX = ptr1.control</span>
</span><span id="__span-132-4"><a id="__codelineno-132-4" name="__codelineno-132-4" href="#__codelineno-132-4"></a><span class="nf">mov</span><span class="w"> </span><span class="p">[</span><span class="no">rsp</span><span class="err">+</span><span class="mi">44</span><span class="p">],</span><span class="w"> </span><span class="no">rax</span><span class="w">           </span><span class="c1">; wptr.ptr = ptr1.ptr</span>
</span><span id="__span-132-5"><a id="__codelineno-132-5" name="__codelineno-132-5" href="#__codelineno-132-5"></a><span class="nf">mov</span><span class="w"> </span><span class="p">[</span><span class="no">rsp</span><span class="err">+</span><span class="mi">52</span><span class="p">],</span><span class="w"> </span><span class="no">rbx</span><span class="w">           </span><span class="c1">; wptr.control = ptr1.control</span>
</span><span id="__span-132-6"><a id="__codelineno-132-6" name="__codelineno-132-6" href="#__codelineno-132-6"></a><span class="c1">; Nota: NO hay incremento de refcount</span>
</span><span id="__span-132-7"><a id="__codelineno-132-7" name="__codelineno-132-7" href="#__codelineno-132-7"></a>
</span><span id="__span-132-8"><a id="__codelineno-132-8" name="__codelineno-132-8" href="#__codelineno-132-8"></a><span class="c1">; weak_ptr::lock() - convertir a shared_ptr</span>
</span><span id="__span-132-9"><a id="__codelineno-132-9" name="__codelineno-132-9" href="#__codelineno-132-9"></a><span class="nf">mov</span><span class="w"> </span><span class="no">rbx</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="no">rsp</span><span class="err">+</span><span class="mi">52</span><span class="p">]</span><span class="w">           </span><span class="c1">; RBX = control_block</span>
</span><span id="__span-132-10"><a id="__codelineno-132-10" name="__codelineno-132-10" href="#__codelineno-132-10"></a><span class="nf">mov</span><span class="w"> </span><span class="no">rax</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="no">rbx</span><span class="p">]</span><span class="w">              </span><span class="c1">; RAX = refcount</span>
</span><span id="__span-132-11"><a id="__codelineno-132-11" name="__codelineno-132-11" href="#__codelineno-132-11"></a><span class="nf">test</span><span class="w"> </span><span class="no">rax</span><span class="p">,</span><span class="w"> </span><span class="no">rax</span>
</span><span id="__span-132-12"><a id="__codelineno-132-12" name="__codelineno-132-12" href="#__codelineno-132-12"></a><span class="nf">jz</span><span class="w"> </span><span class="no">lock_failed</span><span class="w">              </span><span class="c1">; Si refcount == 0, objeto ya destruido</span>
</span><span id="__span-132-13"><a id="__codelineno-132-13" name="__codelineno-132-13" href="#__codelineno-132-13"></a>
</span><span id="__span-132-14"><a id="__codelineno-132-14" name="__codelineno-132-14" href="#__codelineno-132-14"></a><span class="c1">; Incrementar refcount (ahora es un shared_ptr)</span>
</span><span id="__span-132-15"><a id="__codelineno-132-15" name="__codelineno-132-15" href="#__codelineno-132-15"></a><span class="nf">inc</span><span class="w"> </span><span class="p">[</span><span class="no">rbx</span><span class="p">]</span>
</span><span id="__span-132-16"><a id="__codelineno-132-16" name="__codelineno-132-16" href="#__codelineno-132-16"></a>
</span><span id="__span-132-17"><a id="__codelineno-132-17" name="__codelineno-132-17" href="#__codelineno-132-17"></a><span class="nf">mov</span><span class="w"> </span><span class="no">rax</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="no">rsp</span><span class="err">+</span><span class="mi">44</span><span class="p">]</span><span class="w">           </span><span class="c1">; RAX = ptr a datos</span>
</span><span id="__span-132-18"><a id="__codelineno-132-18" name="__codelineno-132-18" href="#__codelineno-132-18"></a><span class="c1">; ... resultado: shared_ptr válido</span>
</span><span id="__span-132-19"><a id="__codelineno-132-19" name="__codelineno-132-19" href="#__codelineno-132-19"></a>
</span><span id="__span-132-20"><a id="__codelineno-132-20" name="__codelineno-132-20" href="#__codelineno-132-20"></a><span class="nf">jmp</span><span class="w"> </span><span class="no">lock_success</span>
</span><span id="__span-132-21"><a id="__codelineno-132-21" name="__codelineno-132-21" href="#__codelineno-132-21"></a><span class="nl">lock_failed:</span>
</span><span id="__span-132-22"><a id="__codelineno-132-22" name="__codelineno-132-22" href="#__codelineno-132-22"></a><span class="c1">; ... resultado: nullptr</span>
</span><span id="__span-132-23"><a id="__codelineno-132-23" name="__codelineno-132-23" href="#__codelineno-132-23"></a><span class="nl">lock_success:</span>
</span></code></pre></div>
<h3 id="comparacion-raw-pointer-vs-smart-pointers">Comparación: Raw Pointer vs Smart Pointers<a class="headerlink" href="#comparacion-raw-pointer-vs-smart-pointers" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Operación</th>
<th>Raw <code>int*</code></th>
<th><code>unique_ptr&lt;int&gt;</code></th>
<th><code>shared_ptr&lt;int&gt;</code></th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Creación</strong></td>
<td><code>int* p = new int(5);</code></td>
<td><code>unique_ptr&lt;int&gt; p(new int(5));</code></td>
<td><code>shared_ptr&lt;int&gt; p(new int(5));</code></td>
</tr>
<tr>
<td><strong>Copia</strong></td>
<td><code>int* q = p;</code> (comparte propiedad)</td>
<td>❌ Compilación falla</td>
<td><code>shared_ptr&lt;int&gt; q = p;</code> (refcount++)</td>
</tr>
<tr>
<td><strong>Movimiento</strong></td>
<td>N/A</td>
<td><code>unique_ptr&lt;int&gt; q = move(p);</code></td>
<td>N/A</td>
</tr>
<tr>
<td><strong>Destrucción</strong></td>
<td>Manual <code>delete p;</code></td>
<td>Automática (scope)</td>
<td>Automática (refcount == 0)</td>
</tr>
<tr>
<td><strong>Bytes en stack</strong></td>
<td>8 bytes (x64)</td>
<td>8 bytes (x64)</td>
<td>16 bytes (ptr + control)</td>
</tr>
<tr>
<td><strong>Overhead</strong></td>
<td>Ninguno</td>
<td>Ninguno</td>
<td>1 <code>long</code> (refcount)</td>
</tr>
</tbody>
</table>
<h3 id="reconocimiento-en-ida-pro">Reconocimiento en IDA Pro<a class="headerlink" href="#reconocimiento-en-ida-pro" title="Permanent link">&para;</a></h3>
<p><strong>Patrones de unique_ptr:</strong></p>
<div class="language-asm highlight"><pre><span></span><code><span id="__span-133-1"><a id="__codelineno-133-1" name="__codelineno-133-1" href="#__codelineno-133-1"></a><span class="c1">; Creación</span>
</span><span id="__span-133-2"><a id="__codelineno-133-2" name="__codelineno-133-2" href="#__codelineno-133-2"></a><span class="nf">call</span><span class="w"> </span><span class="no">operator</span><span class="w"> </span><span class="no">new</span>
</span><span id="__span-133-3"><a id="__codelineno-133-3" name="__codelineno-133-3" href="#__codelineno-133-3"></a><span class="nf">mov</span><span class="w"> </span><span class="p">[</span><span class="no">rsp</span><span class="err">+</span><span class="mi">28</span><span class="p">],</span><span class="w"> </span><span class="no">rax</span><span class="w">           </span><span class="c1">; Guardar único puntero</span>
</span><span id="__span-133-4"><a id="__codelineno-133-4" name="__codelineno-133-4" href="#__codelineno-133-4"></a>
</span><span id="__span-133-5"><a id="__codelineno-133-5" name="__codelineno-133-5" href="#__codelineno-133-5"></a><span class="c1">; Destrucción (al salir)</span>
</span><span id="__span-133-6"><a id="__codelineno-133-6" name="__codelineno-133-6" href="#__codelineno-133-6"></a><span class="nf">mov</span><span class="w"> </span><span class="no">rcx</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="no">rsp</span><span class="err">+</span><span class="mi">28</span><span class="p">]</span>
</span><span id="__span-133-7"><a id="__codelineno-133-7" name="__codelineno-133-7" href="#__codelineno-133-7"></a><span class="nf">call</span><span class="w"> </span><span class="no">operator</span><span class="w"> </span><span class="no">delete</span>
</span></code></pre></div>
<p><strong>Indicador:</strong> Un solo puntero, sin operaciones de refcount.</p>
<p><strong>Patrones de shared_ptr:</strong></p>
<div class="language-asm highlight"><pre><span></span><code><span id="__span-134-1"><a id="__codelineno-134-1" name="__codelineno-134-1" href="#__codelineno-134-1"></a><span class="c1">; Creación (dos asignaciones)</span>
</span><span id="__span-134-2"><a id="__codelineno-134-2" name="__codelineno-134-2" href="#__codelineno-134-2"></a><span class="nf">call</span><span class="w"> </span><span class="no">operator</span><span class="w"> </span><span class="no">new</span><span class="w">           </span><span class="c1">; RAX = datos</span>
</span><span id="__span-134-3"><a id="__codelineno-134-3" name="__codelineno-134-3" href="#__codelineno-134-3"></a><span class="nf">call</span><span class="w"> </span><span class="no">operator</span><span class="w"> </span><span class="no">new</span><span class="w">           </span><span class="c1">; RBX = control_block</span>
</span><span id="__span-134-4"><a id="__codelineno-134-4" name="__codelineno-134-4" href="#__codelineno-134-4"></a><span class="nf">mov</span><span class="w"> </span><span class="p">[</span><span class="no">rsp</span><span class="err">+</span><span class="mi">28</span><span class="p">],</span><span class="w"> </span><span class="no">rax</span><span class="w">           </span><span class="c1">; ptr a datos</span>
</span><span id="__span-134-5"><a id="__codelineno-134-5" name="__codelineno-134-5" href="#__codelineno-134-5"></a><span class="nf">mov</span><span class="w"> </span><span class="p">[</span><span class="no">rsp</span><span class="err">+</span><span class="mi">36</span><span class="p">],</span><span class="w"> </span><span class="no">rbx</span><span class="w">           </span><span class="c1">; ptr a control</span>
</span><span id="__span-134-6"><a id="__codelineno-134-6" name="__codelineno-134-6" href="#__codelineno-134-6"></a>
</span><span id="__span-134-7"><a id="__codelineno-134-7" name="__codelineno-134-7" href="#__codelineno-134-7"></a><span class="c1">; Incremento de refcount (para copias)</span>
</span><span id="__span-134-8"><a id="__codelineno-134-8" name="__codelineno-134-8" href="#__codelineno-134-8"></a><span class="nf">mov</span><span class="w"> </span><span class="no">rax</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="no">rsp</span><span class="err">+</span><span class="mi">36</span><span class="p">]</span><span class="w">           </span><span class="c1">; RAX = control_block</span>
</span><span id="__span-134-9"><a id="__codelineno-134-9" name="__codelineno-134-9" href="#__codelineno-134-9"></a><span class="nf">inc</span><span class="w"> </span><span class="p">[</span><span class="no">rax</span><span class="p">]</span><span class="w">                   </span><span class="c1">; Incrementar refcount</span>
</span><span id="__span-134-10"><a id="__codelineno-134-10" name="__codelineno-134-10" href="#__codelineno-134-10"></a>
</span><span id="__span-134-11"><a id="__codelineno-134-11" name="__codelineno-134-11" href="#__codelineno-134-11"></a><span class="c1">; Decremento y verificación (destrucción)</span>
</span><span id="__span-134-12"><a id="__codelineno-134-12" name="__codelineno-134-12" href="#__codelineno-134-12"></a><span class="nf">dec</span><span class="w"> </span><span class="p">[</span><span class="no">rax</span><span class="p">]</span>
</span><span id="__span-134-13"><a id="__codelineno-134-13" name="__codelineno-134-13" href="#__codelineno-134-13"></a><span class="nf">cmp</span><span class="w"> </span><span class="p">[</span><span class="no">rax</span><span class="p">],</span><span class="w"> </span><span class="mi">0</span>
</span><span id="__span-134-14"><a id="__codelineno-134-14" name="__codelineno-134-14" href="#__codelineno-134-14"></a><span class="nf">jne</span><span class="w"> </span><span class="no">skip_delete</span>
</span></code></pre></div>
<p><strong>Indicador:</strong> Dos punteros, operaciones <code>inc</code>/<code>dec</code> en memoria, saltos condicionales.</p>
<h3 id="stack-frame-ejemplo-completo-con-shared_ptr">Stack Frame: Ejemplo Completo con shared_ptr<a class="headerlink" href="#stack-frame-ejemplo-completo-con-shared_ptr" title="Permanent link">&para;</a></h3>
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-135-1"><a id="__codelineno-135-1" name="__codelineno-135-1" href="#__codelineno-135-1"></a><span class="kt">void</span><span class="w"> </span><span class="nf">procesar_datos</span><span class="p">(</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">datos</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-135-2"><a id="__codelineno-135-2" name="__codelineno-135-2" href="#__codelineno-135-2"></a><span class="w">    </span><span class="n">datos</span><span class="o">-&gt;</span><span class="n">push_back</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span>
</span><span id="__span-135-3"><a id="__codelineno-135-3" name="__codelineno-135-3" href="#__codelineno-135-3"></a><span class="p">}</span>
</span><span id="__span-135-4"><a id="__codelineno-135-4" name="__codelineno-135-4" href="#__codelineno-135-4"></a>
</span><span id="__span-135-5"><a id="__codelineno-135-5" name="__codelineno-135-5" href="#__codelineno-135-5"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-135-6"><a id="__codelineno-135-6" name="__codelineno-135-6" href="#__codelineno-135-6"></a><span class="w">    </span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">vec</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">());</span>
</span><span id="__span-135-7"><a id="__codelineno-135-7" name="__codelineno-135-7" href="#__codelineno-135-7"></a><span class="w">    </span><span class="n">procesar_datos</span><span class="p">(</span><span class="n">vec</span><span class="p">);</span>
</span><span id="__span-135-8"><a id="__codelineno-135-8" name="__codelineno-135-8" href="#__codelineno-135-8"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
</span><span id="__span-135-9"><a id="__codelineno-135-9" name="__codelineno-135-9" href="#__codelineno-135-9"></a><span class="p">}</span>
</span></code></pre></div>
<p><strong>Stack layout en main():</strong></p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-136-1"><a id="__codelineno-136-1" name="__codelineno-136-1" href="#__codelineno-136-1"></a>RSP+0x00:  Shadow Space (32 bytes)
</span><span id="__span-136-2"><a id="__codelineno-136-2" name="__codelineno-136-2" href="#__codelineno-136-2"></a>RSP+0x20:  vec.ptr (8 bytes)
</span><span id="__span-136-3"><a id="__codelineno-136-3" name="__codelineno-136-3" href="#__codelineno-136-3"></a>RSP+0x28:  vec.control (8 bytes)
</span><span id="__span-136-4"><a id="__codelineno-136-4" name="__codelineno-136-4" href="#__codelineno-136-4"></a>RSP+0x30:  Padding
</span><span id="__span-136-5"><a id="__codelineno-136-5" name="__codelineno-136-5" href="#__codelineno-136-5"></a>RSP+0x38:  Security Cookie
</span></code></pre></div>
<p><strong>En procesar_datos():</strong></p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-137-1"><a id="__codelineno-137-1" name="__codelineno-137-1" href="#__codelineno-137-1"></a>RCX:  datos.ptr (parámetro 1)
</span><span id="__span-137-2"><a id="__codelineno-137-2" name="__codelineno-137-2" href="#__codelineno-137-2"></a>RDX:  datos.control (parámetro 2)
</span></code></pre></div>
<p><strong>En ensamblador:</strong></p>
<div class="language-asm highlight"><pre><span></span><code><span id="__span-138-1"><a id="__codelineno-138-1" name="__codelineno-138-1" href="#__codelineno-138-1"></a><span class="c1">; Paso de shared_ptr a función</span>
</span><span id="__span-138-2"><a id="__codelineno-138-2" name="__codelineno-138-2" href="#__codelineno-138-2"></a><span class="nf">lea</span><span class="w"> </span><span class="no">rax</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="no">rsp</span><span class="err">+</span><span class="mi">20</span><span class="p">]</span><span class="w">           </span><span class="c1">; RAX = &amp;vec.ptr</span>
</span><span id="__span-138-3"><a id="__codelineno-138-3" name="__codelineno-138-3" href="#__codelineno-138-3"></a><span class="nf">mov</span><span class="w"> </span><span class="no">rcx</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="no">rax</span><span class="p">]</span><span class="w">              </span><span class="c1">; RCX = vec.ptr (parámetro 1)</span>
</span><span id="__span-138-4"><a id="__codelineno-138-4" name="__codelineno-138-4" href="#__codelineno-138-4"></a><span class="nf">lea</span><span class="w"> </span><span class="no">rbx</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="no">rsp</span><span class="err">+</span><span class="mi">28</span><span class="p">]</span><span class="w">           </span><span class="c1">; RBX = &amp;vec.control</span>
</span><span id="__span-138-5"><a id="__codelineno-138-5" name="__codelineno-138-5" href="#__codelineno-138-5"></a><span class="nf">mov</span><span class="w"> </span><span class="no">rdx</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="no">rbx</span><span class="p">]</span><span class="w">              </span><span class="c1">; RDX = vec.control (parámetro 2)</span>
</span><span id="__span-138-6"><a id="__codelineno-138-6" name="__codelineno-138-6" href="#__codelineno-138-6"></a><span class="nf">call</span><span class="w"> </span><span class="no">procesar_datos</span><span class="w">         </span><span class="c1">; Llamar función</span>
</span><span id="__span-138-7"><a id="__codelineno-138-7" name="__codelineno-138-7" href="#__codelineno-138-7"></a>
</span><span id="__span-138-8"><a id="__codelineno-138-8" name="__codelineno-138-8" href="#__codelineno-138-8"></a><span class="c1">; Dentro de procesar_datos:</span>
</span><span id="__span-138-9"><a id="__codelineno-138-9" name="__codelineno-138-9" href="#__codelineno-138-9"></a><span class="nf">procesar_datos</span><span class="w"> </span><span class="no">proc</span><span class="w"> </span><span class="no">near</span><span class="p">:</span>
</span><span id="__span-138-10"><a id="__codelineno-138-10" name="__codelineno-138-10" href="#__codelineno-138-10"></a><span class="w">    </span><span class="c1">; RCX = datos.ptr</span>
</span><span id="__span-138-11"><a id="__codelineno-138-11" name="__codelineno-138-11" href="#__codelineno-138-11"></a><span class="w">    </span><span class="c1">; RDX = datos.control</span>
</span><span id="__span-138-12"><a id="__codelineno-138-12" name="__codelineno-138-12" href="#__codelineno-138-12"></a>
</span><span id="__span-138-13"><a id="__codelineno-138-13" name="__codelineno-138-13" href="#__codelineno-138-13"></a><span class="w">    </span><span class="c1">; Incrementar refcount (copia para parámetro)</span>
</span><span id="__span-138-14"><a id="__codelineno-138-14" name="__codelineno-138-14" href="#__codelineno-138-14"></a><span class="w">    </span><span class="nf">inc</span><span class="w"> </span><span class="p">[</span><span class="no">rdx</span><span class="p">]</span>
</span><span id="__span-138-15"><a id="__codelineno-138-15" name="__codelineno-138-15" href="#__codelineno-138-15"></a>
</span><span id="__span-138-16"><a id="__codelineno-138-16" name="__codelineno-138-16" href="#__codelineno-138-16"></a><span class="w">    </span><span class="c1">; ... usar datos ...</span>
</span><span id="__span-138-17"><a id="__codelineno-138-17" name="__codelineno-138-17" href="#__codelineno-138-17"></a>
</span><span id="__span-138-18"><a id="__codelineno-138-18" name="__codelineno-138-18" href="#__codelineno-138-18"></a><span class="w">    </span><span class="c1">; Decrementar refcount (al salir)</span>
</span><span id="__span-138-19"><a id="__codelineno-138-19" name="__codelineno-138-19" href="#__codelineno-138-19"></a><span class="w">    </span><span class="nf">dec</span><span class="w"> </span><span class="p">[</span><span class="no">rdx</span><span class="p">]</span>
</span><span id="__span-138-20"><a id="__codelineno-138-20" name="__codelineno-138-20" href="#__codelineno-138-20"></a><span class="w">    </span><span class="nf">cmp</span><span class="w"> </span><span class="p">[</span><span class="no">rdx</span><span class="p">],</span><span class="w"> </span><span class="mi">0</span>
</span><span id="__span-138-21"><a id="__codelineno-138-21" name="__codelineno-138-21" href="#__codelineno-138-21"></a><span class="w">    </span><span class="nf">jne</span><span class="w"> </span><span class="no">ret_func</span>
</span><span id="__span-138-22"><a id="__codelineno-138-22" name="__codelineno-138-22" href="#__codelineno-138-22"></a>
</span><span id="__span-138-23"><a id="__codelineno-138-23" name="__codelineno-138-23" href="#__codelineno-138-23"></a><span class="w">    </span><span class="c1">; Liberar memoria</span>
</span><span id="__span-138-24"><a id="__codelineno-138-24" name="__codelineno-138-24" href="#__codelineno-138-24"></a><span class="w">    </span><span class="nf">call</span><span class="w"> </span><span class="no">delete_vector</span>
</span><span id="__span-138-25"><a id="__codelineno-138-25" name="__codelineno-138-25" href="#__codelineno-138-25"></a><span class="w">    </span><span class="nf">call</span><span class="w"> </span><span class="no">operator</span><span class="w"> </span><span class="no">delete</span><span class="w">    </span><span class="c1">; Liberar control_block</span>
</span><span id="__span-138-26"><a id="__codelineno-138-26" name="__codelineno-138-26" href="#__codelineno-138-26"></a><span class="nl">ret_func:</span>
</span><span id="__span-138-27"><a id="__codelineno-138-27" name="__codelineno-138-27" href="#__codelineno-138-27"></a><span class="w">    </span><span class="nf">ret</span>
</span></code></pre></div>
<h3 id="impacto-en-reversing">Impacto en Reversing<a class="headerlink" href="#impacto-en-reversing" title="Permanent link">&para;</a></h3>
<p><strong>Cuando veas smart pointers:</strong></p>
<ul>
<li>El código es probablemente <strong>C++11 o posterior</strong></li>
<li>Hay automatización de memoria (más seguro)</li>
<li>Las operaciones de refcount aparecen como <code>inc [memoria]</code> / <code>dec [memoria]</code></li>
<li>Destructores pueden ser complejos (deletores personalizados)</li>
<li>Es más difícil de debuggear (abstracciones adicionales)</li>
</ul>
<p><strong>Ventaja de reversing:</strong> Si ves refcount == 0 → memoria se libera automáticamente → potencial fuga de información u use-after-free.</p>
<h3 id="vulnerabilidades-comunes">Vulnerabilidades Comunes<a class="headerlink" href="#vulnerabilidades-comunes" title="Permanent link">&para;</a></h3>
<p><strong>1. Use-After-Free:</strong></p>
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-139-1"><a id="__codelineno-139-1" name="__codelineno-139-1" href="#__codelineno-139-1"></a><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="w"> </span><span class="n">ptr1</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="kt">int</span><span class="p">(</span><span class="mi">100</span><span class="p">));</span>
</span><span id="__span-139-2"><a id="__codelineno-139-2" name="__codelineno-139-2" href="#__codelineno-139-2"></a><span class="n">weak_ptr</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="w"> </span><span class="n">wptr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ptr1</span><span class="p">;</span>
</span><span id="__span-139-3"><a id="__codelineno-139-3" name="__codelineno-139-3" href="#__codelineno-139-3"></a><span class="n">ptr1</span><span class="p">.</span><span class="n">reset</span><span class="p">();</span><span class="w">  </span><span class="c1">// Libera la memoria</span>
</span><span id="__span-139-4"><a id="__codelineno-139-4" name="__codelineno-139-4" href="#__codelineno-139-4"></a>
</span><span id="__span-139-5"><a id="__codelineno-139-5" name="__codelineno-139-5" href="#__codelineno-139-5"></a><span class="k">auto</span><span class="w"> </span><span class="n">locked</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">wptr</span><span class="p">.</span><span class="n">lock</span><span class="p">();</span>
</span><span id="__span-139-6"><a id="__codelineno-139-6" name="__codelineno-139-6" href="#__codelineno-139-6"></a><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">locked</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-139-7"><a id="__codelineno-139-7" name="__codelineno-139-7" href="#__codelineno-139-7"></a><span class="w">    </span><span class="o">*</span><span class="n">locked</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">200</span><span class="p">;</span><span class="w">  </span><span class="c1">// ❌ Use-after-free!</span>
</span><span id="__span-139-8"><a id="__codelineno-139-8" name="__codelineno-139-8" href="#__codelineno-139-8"></a><span class="p">}</span>
</span></code></pre></div>
<p><strong>2. Ciclo de Referencias:</strong></p>
<div class="language-cpp highlight"><pre><span></span><code><span id="__span-140-1"><a id="__codelineno-140-1" name="__codelineno-140-1" href="#__codelineno-140-1"></a><span class="k">struct</span><span class="w"> </span><span class="nc">Nodo</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-140-2"><a id="__codelineno-140-2" name="__codelineno-140-2" href="#__codelineno-140-2"></a><span class="w">    </span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">Nodo</span><span class="o">&gt;</span><span class="w"> </span><span class="n">siguiente</span><span class="p">;</span>
</span><span id="__span-140-3"><a id="__codelineno-140-3" name="__codelineno-140-3" href="#__codelineno-140-3"></a><span class="w">    </span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">Nodo</span><span class="o">&gt;</span><span class="w"> </span><span class="n">anterior</span><span class="p">;</span>
</span><span id="__span-140-4"><a id="__codelineno-140-4" name="__codelineno-140-4" href="#__codelineno-140-4"></a><span class="p">};</span>
</span><span id="__span-140-5"><a id="__codelineno-140-5" name="__codelineno-140-5" href="#__codelineno-140-5"></a>
</span><span id="__span-140-6"><a id="__codelineno-140-6" name="__codelineno-140-6" href="#__codelineno-140-6"></a><span class="n">Nodo</span><span class="w"> </span><span class="n">n1</span><span class="p">,</span><span class="w"> </span><span class="n">n2</span><span class="p">;</span>
</span><span id="__span-140-7"><a id="__codelineno-140-7" name="__codelineno-140-7" href="#__codelineno-140-7"></a><span class="n">n1</span><span class="p">.</span><span class="n">siguiente</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="n">n2</span><span class="p">;</span>
</span><span id="__span-140-8"><a id="__codelineno-140-8" name="__codelineno-140-8" href="#__codelineno-140-8"></a><span class="n">n2</span><span class="p">.</span><span class="n">anterior</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">&amp;</span><span class="n">n1</span><span class="p">;</span>
</span><span id="__span-140-9"><a id="__codelineno-140-9" name="__codelineno-140-9" href="#__codelineno-140-9"></a><span class="c1">// ❌ Ambos nunca se destruyen (refcount nunca llega a cero)</span>
</span></code></pre></div>
<p><strong>Solución:</strong> Usar <code>weak_ptr</code> para referencias hacia atrás.</p>












                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Volver al principio
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        
<div class="md-social">
  
    
    
    
    
    <a href="https://github.com/G4sp4rCS" target="_blank" rel="noopener" title="GitHub" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
      <div class="md-progress" data-md-component="progress" role="progressbar"></div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "../../../..", "features": ["navigation.instant", "navigation.instant.progress", "navigation.sections", "navigation.top", "navigation.tracking", "navigation.indexes", "toc.integrate", "content.code.copy", "content.action.edit", "content.tabs.link"], "search": "../../../../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "Copiado al portapapeles", "clipboard.copy": "Copiar al portapapeles", "search.result.more.one": "1 m\u00e1s en esta p\u00e1gina", "search.result.more.other": "# m\u00e1s en esta p\u00e1gina", "search.result.none": "No se encontraron documentos", "search.result.one": "1 documento encontrado", "search.result.other": "# documentos encontrados", "search.result.placeholder": "Teclee para comenzar b\u00fasqueda", "search.result.term.missing": "Falta", "select.version": "Seleccionar versi\u00f3n"}, "version": null}</script>
    
    
      <script src="../../../../assets/javascripts/bundle.79ae519e.min.js"></script>
      
    
  </body>
</html>